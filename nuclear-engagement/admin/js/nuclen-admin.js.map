{"version":3,"file":"nuclen-admin.js","sources":["../../../src/shared/constants.ts","../../../src/admin/ts/generation/api.ts","../../../src/admin/ts/generation/polling.ts","../../../src/admin/ts/utils/displayError.ts","../../../src/admin/ts/generation/results.ts","../../../src/admin/ts/single/single-generation-utils.ts","../../../src/admin/ts/single/single-generation-handlers.ts","../../../src/admin/ts/nuclen-admin-single-generation.ts","../../../src/admin/ts/generate/elements.ts","../../../src/admin/ts/generate/generate-page-utils.ts","../../../src/admin/ts/generate/filters.ts","../../../src/admin/ts/generate/step1.ts","../../../src/admin/ts/utils/displaySuccess.ts","../../../src/admin/ts/generate/step2.ts","../../../src/admin/ts/generate/navigation.ts","../../../src/admin/ts/generate/generate-page-handlers.ts","../../../src/admin/ts/nuclen-admin-generate-page.ts","../../../src/admin/ts/nuclen-admin-ui.ts","../../../src/admin/ts/nuclen-admin-onboarding.ts","../../../src/admin/ts/blocks/nuclen-editor-blocks.ts"],"sourcesContent":["// API Configuration\nexport const API_CONFIG = {\n\tRETRY_COUNT: 3,\n\tINITIAL_DELAY_MS: 500,\n\tPOLLING_INTERVAL_MS: 10000,\n\tMAX_BACKOFF_MS: 30000,\n\t// Progressive polling configuration\n\tPOLLING_INTERVALS: [\n\t\t// First 1 minute: 10 second intervals (6 polls)\n\t\t{ duration: 60000, interval: 10000 },\n\t\t// Next 4 minutes: 30 second intervals (8 polls)\n\t\t{ duration: 240000, interval: 30000 },\n\t\t// Remaining time: 60 second intervals\n\t\t{ duration: Infinity, interval: 60000 }\n\t],\n\tMAX_POLLING_ATTEMPTS: 240, // Increased from 120\n\tMAX_POLLING_TIMEOUT_MS: 1800000, // 30 minutes\n} as const;\n\n// Action Names\nexport const ACTIONS = {\n\tTRIGGER_GENERATION: 'nuclen_trigger_generation',\n\tGET_POSTS_COUNT: 'nuclen_get_posts_count',\n\tUPDATE_POINTER: 'nuclen_update_pointer',\n\tEXPORT_OPTIN: 'nuclen_export_optin',\n} as const;\n\n// CSS Class Names\nexport const CSS_CLASSES = {\n\tADMIN: {\n\t\tCONTAINER: 'nuclen-admin-container',\n\t\tLOADING: 'nuclen-loading',\n\t\tERROR: 'nuclen-error',\n\t\tSUCCESS: 'nuclen-success',\n\t},\n\tQUIZ: {\n\t\tCONTAINER: 'nuclen-quiz-container',\n\t\tQUESTION: 'nuclen-quiz-question',\n\t\tANSWER: 'nuclen-quiz-answer',\n\t\tPROGRESS: 'nuclen-quiz-progress',\n\t},\n\tTOC: {\n\t\tCONTAINER: 'nuclen-toc-container',\n\t\tSTICKY: 'nuclen-toc-sticky',\n\t\tACTIVE: 'nuclen-toc-active',\n\t},\n} as const;\n\n// Scroll Configuration\nexport const SCROLL_CONFIG = {\n\tTOC_ROOT_MARGIN: '0px 0px -60%',\n\tSMOOTH_SCROLL_DURATION: 300,\n} as const;\n\n// Local Storage Keys\nexport const STORAGE_KEYS = {\n\tQUIZ_PROGRESS: 'nuclen_quiz_progress',\n\tUSER_PREFERENCES: 'nuclen_user_prefs',\n} as const;","import * as logger from '../utils/logger';\nimport { API_CONFIG } from '../../../shared/constants';\n\nexport interface NuclenFetchResult<T> {\n\tok: boolean;\n\tstatus: number;\n\tdata: T | null;\n\terror?: string;\n}\n\nexport async function nuclenFetchWithRetry<T = unknown>(\n\turl: string,\n\toptions: RequestInit,\n\tretries = API_CONFIG.RETRY_COUNT,\n\tinitialDelayMs = API_CONFIG.INITIAL_DELAY_MS,\n\ttimeoutMs = 30000 // 30 second default timeout\n): Promise<NuclenFetchResult<T>> {\n\tlet attempt = 0;\n\tlet delay: number = initialDelayMs;\n\tlet lastError: Error | undefined;\n\n\twhile (attempt <= retries) {\n\t\ttry {\n\t\t\t// Create AbortController for timeout\n\t\t\tconst controller = new window.AbortController();\n\t\t\tconst timeoutId = setTimeout(() => controller.abort(), timeoutMs);\n\t\t\t\n\t\t\tconst response = await fetch(url, {\n\t\t\t\t...options,\n\t\t\t\tsignal: controller.signal\n\t\t\t});\n\t\t\t\n\t\t\tclearTimeout(timeoutId);\n\t\t\tconst { status, ok } = response;\n\t\t\tconst bodyText = await response.text().catch(() => '');\n\t\t\tlet data: T | null = null;\n\t\t\tif (bodyText) {\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(bodyText) as T;\n\t\t\t\t} catch {\n\t\t\t\t\t// body is not JSON\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (ok) {\n\t\t\t\tconst success: NuclenFetchResult<T> = {\n\t\t\t\t\tok: true,\n\t\t\t\t\tstatus: status,\n\t\t\t\t\tdata: data,\n\t\t\t\t};\n\t\t\t\treturn success;\n\t\t\t}\n\n\t\t\tconst fail: NuclenFetchResult<T> = {\n\t\t\t\tok: false,\n\t\t\t\tstatus: status,\n\t\t\t\tdata: data,\n\t\t\t\terror: bodyText,\n\t\t\t};\n\t\t\treturn fail;\n\t\t} catch (error: unknown) {\n\t\t\tlastError = error as Error;\n\t\t\t\n\t\t\t// Check if it's an abort error\n\t\t\tif (lastError.name === 'AbortError') {\n\t\t\t\tlastError = new Error(`Request timeout after ${timeoutMs}ms`);\n\t\t\t}\n\t\t\t\n\t\t\tif (attempt === retries) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tlogger.warn(\n\t\t\t\t`[RETRY] API request | URL: ${url} | Method: ${options.method || 'GET'} | Attempts left: ${retries - attempt} | Error: ${lastError.message}`\n\t\t\t);\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\n\t\t\tdelay = Math.min(delay * 2, API_CONFIG.MAX_BACKOFF_MS || 30000) as number;\n\t\t}\n\t\tattempt += 1;\n\t}\n\n\tlogger.error(\n\t\t`[ERROR] Max retries exhausted | URL: ${url} | Method: ${options.method || 'GET'} | Error: ${lastError?.message || 'Unknown error'}`\n\t);\n\tthrow lastError;\n}\n\nexport interface PollingUpdateData {\n\tprocessed: number;\n\ttotal: number;\n\tsuccessCount?: number;\n\tfailCount?: number;\n\tfinalReport?: { message?: string };\n\tresults?: Record<string, unknown>;\n\tworkflow: string;\n}\n\nexport interface PollingUpdateResponse {\n\tsuccess: boolean;\n\tmessage?: string;\n\tdata: PollingUpdateData;\n}\n\nexport interface StartGenerationResponse {\n\tsuccess: boolean;\n\tmessage?: string;\n\tgeneration_id?: string;\n\tdata?: {\n\t\tgeneration_id?: string;\n\t\tresults?: any[];\n\t\tsuccess?: boolean;\n\t\terror?: string;\n\t\terror_code?: string;\n\t\tstatus_code?: number;\n\t\tmessage?: string;\n\t\ttotal_posts?: number;\n\t\ttotal_batches?: number;\n\t\t[key: string]: unknown;\n\t};\n}\n\nexport async function nuclenFetchUpdates(\n\tgenerationId?: string\n): Promise<PollingUpdateResponse> {\n\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url || !window.nuclenAjax.fetch_action) {\n\t\tconst error = new Error('[ERROR] Missing configuration | Required: nuclenAjax.ajax_url and nuclenAjax.fetch_action');\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('action', window.nuclenAjax.fetch_action);\n\n\tif (window.nuclenAjax.nonce) {\n\t\tformData.append('security', window.nuclenAjax.nonce);\n\t}\n\n\tif (generationId) {\n\t\tformData.append('generation_id', generationId);\n\t}\n\t\n\tconst result = await nuclenFetchWithRetry<PollingUpdateResponse>(\n\t\twindow.nuclenAjax.ajax_url,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t\tcredentials: 'same-origin',\n\t\t},\n\t\tAPI_CONFIG.RETRY_COUNT,\n\t\tAPI_CONFIG.INITIAL_DELAY_MS,\n\t\t30000 // 30 second timeout for polling\n\t);\n\n\tif (!result.ok) {\n\t\t// Check if the error message indicates polling limit reached\n\t\tconst errorMessage = result.error || 'Unknown error';\n\t\tif (errorMessage.includes('Polling failed after') && errorMessage.includes('attempts')) {\n\t\t\t// Return a special response structure for polling limit errors\n\t\t\t// Don't log this as an error since it's a normal flow\n\t\t\tlogger.warn(`[WARNING] API polling limit reached | GenID: ${generationId} | Message: ${errorMessage}`);\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\tmessage: errorMessage,\n\t\t\t\tdata: {\n\t\t\t\t\tprocessed: 0,\n\t\t\t\t\ttotal: 0,\n\t\t\t\t\tworkflow: 'unknown'\n\t\t\t\t}\n\t\t\t} as PollingUpdateResponse;\n\t\t}\n\t\t\n\t\tconst error = new Error(`[ERROR] Fetch updates failed | Status: ${result.status} | Error: ${errorMessage}`);\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\n\tconst response = result.data as PollingUpdateResponse;\n\tlogger.log(`[DEBUG] nuclenFetchUpdates response | GenID: ${generationId} | Success: ${response.success} | Has data: ${!!response.data} | Has results: ${response.data?.results ? Object.keys(response.data.results).length : 0}`);\n\treturn response;\n}\n\nexport async function NuclenStartGeneration(\n\tdataToSend: Record<string, unknown>\n): Promise<StartGenerationResponse> {\n\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url) {\n\t\tconst error = new Error('[ERROR] Missing configuration | Required: nuclenAjax.ajax_url');\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\n\tconst formData = new FormData();\n\tformData.append('action', 'nuclen_trigger_generation');\n\tformData.append('payload', JSON.stringify(dataToSend));\n\tif (!window.nuclenAjax?.nonce) {\n\t\tconst error = new Error('[ERROR] Security check failed | Missing nonce');\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\tformData.append('security', window.nuclenAjax.nonce);\n\n\tconst result = await nuclenFetchWithRetry<StartGenerationResponse>(\n\t\twindow.nuclenAjax.ajax_url,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t\tcredentials: 'same-origin',\n\t\t},\n\t\tAPI_CONFIG.RETRY_COUNT,\n\t\tAPI_CONFIG.INITIAL_DELAY_MS,\n\t\t60000 // 60 second timeout for generation start\n\t);\n\n\tif (!result.ok) {\n\t\tconst error = new Error(`[ERROR] Generation start failed | Status: ${result.status} | Error: ${result.error || 'Unknown error'}`);\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\n\t// Validate response structure before casting\n\tconst rawData = result.data;\n\tif (!rawData || typeof rawData !== 'object') {\n\t\tconst error = new Error('[ERROR] Invalid response | Expected object, received: ' + typeof rawData);\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\t\n\t// WordPress wp_send_json_success returns { success: true, data: {...} }\n\t// We need to return the full structure, not just the inner data\n\tlet response: StartGenerationResponse;\n\t\n\tif ('success' in rawData && typeof rawData.success === 'boolean') {\n\t\t// This is already the WordPress response structure we want\n\t\tresponse = rawData as StartGenerationResponse;\n\t} else {\n\t\t// Wrap it in expected structure\n\t\tresponse = {\n\t\t\tsuccess: true,\n\t\t\tdata: rawData as any\n\t\t};\n\t}\n\t\n\t// Validate success\n\tif (!response.success) {\n\t\tlet errMsg = 'Unknown error';\n\t\t\n\t\tif (response.message) {\n\t\t\terrMsg = response.message;\n\t\t} else if (response.data && typeof response.data === 'object' && response.data.message) {\n\t\t\terrMsg = response.data.message;\n\t\t}\n\t\t\n\t\tconst error = new Error(`[ERROR] Generation start failed | Error: ${errMsg}`);\n\t\tlogger.error(error.message);\n\t\tthrow error;\n\t}\n\n\treturn response;\n}\n","import { nuclenFetchUpdates } from './api';\nimport type { PollingUpdateData, PollingUpdateResponse } from './api';\nimport { API_CONFIG } from '../../../shared/constants';\nimport * as logger from '../utils/logger';\nimport { createStreamingClient } from './streaming';\n\nexport function NuclenPollAndPullUpdates({\n\tintervalMs = API_CONFIG.POLLING_INTERVAL_MS,\n\tgenerationId,\n\tonProgress = (() => {}) as (processed: number, total: number, data?: any) => void,\n\tonComplete = () => {},\n\tonError = () => {},\n\tmaxAttempts = API_CONFIG.MAX_POLLING_ATTEMPTS,\n\ttimeoutMs = API_CONFIG.MAX_POLLING_TIMEOUT_MS,\n\tuseExponentialBackoff = false, // Disabled in favor of progressive intervals\n\tmaxIntervalMs = 60000, // Maximum interval between polls (60 seconds)\n\tuseProgressiveIntervals = true, // Use progressive polling intervals\n}: {\n\tintervalMs?: number;\n\tgenerationId: string;\n\tonProgress?: (processed: number, total: number, data?: any) => void;\n\tonComplete?: (finalData: PollingUpdateData) => void;\n\tonError?: (errMsg: string) => void;\n\tmaxAttempts?: number;\n\ttimeoutMs?: number;\n\tuseExponentialBackoff?: boolean;\n\tmaxIntervalMs?: number;\n\tuseProgressiveIntervals?: boolean;\n}) {\n\t// Validate generation ID\n\tif (!generationId || generationId.trim() === '') {\n\t\tlogger.error('[ERROR] Polling failed | Missing generation ID');\n\t\tonError('No generation ID provided for polling');\n\t\treturn () => {}; // Return empty cleanup function\n\t}\n\t\n\tlet attemptCount = 0;\n\tconst startTime = Date.now();\n\tlet currentInterval = intervalMs;\n\tlet consecutiveErrors = 0;\n\tlet timeoutId: ReturnType<typeof setTimeout> | null = null;\n\tlet streamingClient: ReturnType<typeof createStreamingClient> | null = null;\n\t\n\t// Disable SSE streaming for now as it's not compatible with batch processing\n\t// TODO: Fix SSE to properly handle batch-based generation\n\tstreamingClient = null;\n\t\n\t// // Try to use streaming first\n\t// streamingClient = createStreamingClient(generationId, {\n\t// \tonProgress: (data: StreamProgressData) => {\n\t// \t\t// Convert streaming data to polling format\n\t// \t\tonProgress(data.processed, data.total, {\n\t// \t\t\tresults: data.results,\n\t// \t\t\tprogress: data.progress,\n\t// \t\t\tstatus: data.status\n\t// \t\t});\n\t// \t},\n\t// \tonComplete: (status: string) => {\n\t// \t\t// Streaming completed, fetch final results\n\t// \t\tnuclenFetchUpdates(generationId).then(response => {\n\t// \t\t\tif (response.success && response.data) {\n\t// \t\t\t\tlogger.log(`[DEBUG] Streaming complete, fetched final results | GenID: ${generationId} | Has results: ${!!response.data.results}`);\n\t// \t\t\t\tonComplete(response.data);\n\t// \t\t\t}\n\t// \t\t}).catch(error => {\n\t// \t\t\tlogger.error(`[ERROR] Failed to fetch final results after streaming | GenID: ${generationId}`, error);\n\t// \t\t});\n\t// \t},\n\t// \tonError: (error: string) => {\n\t// \t\tlogger.warn('Streaming failed, falling back to polling', error);\n\t// \t\tstreamingClient = null;\n\t// \t\t// Start polling as fallback\n\t// \t\tschedulePoll();\n\t// \t}\n\t// });\n\t// \n\t// // If streaming is available, start it\n\t// if (streamingClient) {\n\t// \tlogger.log('Using SSE streaming for progress updates');\n\t// \tstreamingClient.start();\n\t// }\n\t\n\t// Calculate current interval based on elapsed time for progressive intervals\n\tconst getProgressiveInterval = (elapsed: number): number => {\n\t\tif (!useProgressiveIntervals) return intervalMs;\n\t\t\n\t\tlet accumulatedDuration = 0;\n\t\tfor (const stage of API_CONFIG.POLLING_INTERVALS) {\n\t\t\tif (elapsed < accumulatedDuration + stage.duration) {\n\t\t\t\treturn stage.interval;\n\t\t\t}\n\t\t\taccumulatedDuration += stage.duration;\n\t\t}\n\t\t\n\t\t// Return the last interval for anything beyond defined stages\n\t\treturn API_CONFIG.POLLING_INTERVALS[API_CONFIG.POLLING_INTERVALS.length - 1].interval;\n\t};\n\t\n\tconst schedulePoll = () => {\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t}\n\t\t\n\t\tconst elapsed = Date.now() - startTime;\n\t\t\n\t\t// Use progressive intervals if enabled\n\t\tif (useProgressiveIntervals) {\n\t\t\tcurrentInterval = getProgressiveInterval(elapsed);\n\t\t}\n\t\t// Apply exponential backoff if enabled and there are errors\n\t\telse if (useExponentialBackoff && consecutiveErrors > 0) {\n\t\t\tcurrentInterval = Math.min(\n\t\t\t\tintervalMs * Math.pow(1.5, consecutiveErrors),\n\t\t\t\tmaxIntervalMs\n\t\t\t);\n\t\t}\n\t\t\n\t\ttimeoutId = setTimeout(poll, currentInterval);\n\t};\n\t\n\tconst poll = async () => {\n\t\tattemptCount++;\n\t\tconst elapsed = Date.now() - startTime;\n\t\t\n\t\t// Check for timeout conditions\n\t\tif (attemptCount > maxAttempts) {\n\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\tlogger.warn(`[WARNING] Polling timeout | GenID: ${generationId} | Attempts: ${attemptCount}/${maxAttempts}`);\n\t\t\tonError(`polling-timeout:${generationId}`);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (elapsed > timeoutMs) {\n\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\tlogger.warn(`[WARNING] Polling timeout | GenID: ${generationId} | Elapsed: ${elapsed}ms/${timeoutMs}ms`);\n\t\t\tonError(`polling-timeout:${generationId}`);\n\t\t\treturn;\n\t\t}\n\t\t\n\t\ttry {\n\t\t\tconst pollResults: PollingUpdateResponse = await nuclenFetchUpdates(generationId);\n\t\t\tif (!pollResults.success) {\n\t\t\t\tconst errMsg = pollResults.message || 'Failed to fetch updates. The task may have been cancelled, or there has been an error. Please see the log file on the setup page or contact support.';\n\t\t\t\t\n\t\t\t\t// Check if task has been cancelled\n\t\t\t\tif (errMsg.includes('Task has been cancelled') || errMsg.includes('cancelled')) {\n\t\t\t\t\t// Task was cancelled - stop polling gracefully\n\t\t\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\t\t\tlogger.log(`[INFO] Task cancelled | GenID: ${generationId}`);\n\t\t\t\t\tonError(`task-cancelled:${generationId}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Check if this is a \"Polling failed after X attempts\" error from the API\n\t\t\t\tif (errMsg.includes('Polling failed after') && errMsg.includes('attempts')) {\n\t\t\t\t\t// This is a terminal error from the API - trigger redirect\n\t\t\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\t\t\t// This is expected behavior - don't throw an error\n\t\t\t\t\tonError(`polling-timeout:${generationId}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Only log as error if it's not an expected polling limit\n\t\t\t\tlogger.error(`[ERROR] Poll failed | GenID: ${generationId} | Error: ${errMsg}`);\n\t\t\t\tthrow new Error(errMsg);\n\t\t\t}\n\t\t\t\n\t\t\t// Reset error count on successful response\n\t\t\tconsecutiveErrors = 0;\n\t\t\tcurrentInterval = intervalMs;\n\n\t\t\tconst {\n\t\t\t\tprocessed,\n\t\t\t\ttotal,\n\t\t\t\tsuccessCount = processed,\n\t\t\t\tfailCount,\n\t\t\t\tfinalReport,\n\t\t\t\tresults,\n\t\t\t\tworkflow,\n\t\t\t} = pollResults.data;\n\n\t\t\tlogger.log(`[DEBUG] Poll progress | GenID: ${generationId} | Progress: ${processed}/${total} | Success: ${successCount} | Failed: ${failCount || 0}`);\n\t\t\tlogger.log(`[DEBUG] Poll data | GenID: ${generationId} | Has results: ${!!results} | Results count: ${results ? Object.keys(results).length : 0} | Workflow: ${workflow || 'undefined'}`);\n\t\t\tonProgress(processed, total, pollResults.data);\n\n\t\t\tif (processed >= total) {\n\t\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\t\tlogger.log(`[SUCCESS] Polling complete | GenID: ${generationId} | Total: ${total} | Success: ${successCount} | Failed: ${failCount || 0}`);\n\t\t\t\tlogger.log(`[DEBUG] Passing to onComplete | GenID: ${generationId} | Results: ${JSON.stringify(results)} | Workflow: ${workflow}`);\n\t\t\t\tonComplete({\n\t\t\t\t\tprocessed,\n\t\t\t\t\ttotal,\n\t\t\t\t\tsuccessCount,\n\t\t\t\t\tfailCount,\n\t\t\t\t\tfinalReport,\n\t\t\t\t\tresults,\n\t\t\t\t\tworkflow,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// Schedule next poll\n\t\t\t\tschedulePoll();\n\t\t\t}\n\t\t} catch (err: unknown) {\n\t\t\tconsecutiveErrors++;\n\t\t\t\n\t\t\t// Check if we should continue retrying\n\t\t\tif (consecutiveErrors >= 3) {\n\t\t\t\tif (timeoutId) clearTimeout(timeoutId);\n\t\t\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\n\t\t\t\tlogger.error(`[ERROR] Polling failed | GenID: ${generationId} | Attempts: ${attemptCount} | Consecutive errors: ${consecutiveErrors} | Error: ${message}`);\n\t\t\t\tonError(`polling-error:${generationId}`);\n\t\t\t} else {\n\t\t\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\n\t\t\t\tlogger.warn(`[RETRY] Polling error | GenID: ${generationId} | Consecutive errors: ${consecutiveErrors}/3 | Error: ${message}`);\n\t\t\t\t// Continue polling with backoff\n\t\t\t\tschedulePoll();\n\t\t\t}\n\t\t}\n\t};\n\t\n\t// Start polling only if not streaming\n\tif (!streamingClient) {\n\t\tlogger.log(`[INFO] Starting polling | GenID: ${generationId} | Initial interval: ${currentInterval}ms | Max attempts: ${maxAttempts} | Progressive: ${useProgressiveIntervals}`);\n\t\tpoll();\n\t}\n\n\t// Return a cleanup function to allow manual cancellation\n\treturn () => {\n\t\tif (timeoutId) {\n\t\t\tclearTimeout(timeoutId);\n\t\t}\n\t\t// Streaming is currently disabled, so no need to stop it\n\t\t// When re-enabling streaming, uncomment the following:\n\t\t// if (streamingClient && streamingClient !== null) {\n\t\t// \tstreamingClient.stop();\n\t\t// }\n\t};\n}\n","import * as logger from './logger';\n\nexport function displayError(message: string, _context?: Record<string, any>): void {\n\t// Log error with context\n\tlogger.error(`[ERROR] UI Error | ${message}`);\n\t\n\t// Create toast notification\n\tconst toast = document.createElement('div');\n\ttoast.className = 'nuclen-error-toast';\n\ttoast.innerHTML = message;\n\tdocument.body.appendChild(toast);\n\t\n\t// Remove toast after 5 seconds\n\tsetTimeout(() => {\n\t\tif (toast.parentNode) {\n\t\t\ttoast.remove();\n\t\t}\n\t}, 5000);\n}\n","export const REST_ENDPOINT =\n\twindow.nuclenAdminVars?.rest_receive_content ||\n\t'/wp-json/nuclear-engagement/v1/receive-content';\n\nexport const REST_NONCE = window.nuclenAdminVars?.rest_nonce || '';\nimport { displayError } from '../utils/displayError';\nimport * as logger from '../utils/logger';\n\nexport function nuclenAlertApiError(errMsg: string): void {\n\tconst cleanMsg = errMsg.replace(/<[^>]+>/g, '');\n\t\n\t// Handle task cancelled gracefully\n\tif (cleanMsg.includes('task-cancelled:') || cleanMsg.includes('Task has been cancelled')) {\n\t\t// Extract generation ID if present in the error message\n\t\t// let generationId = '';\n\t\t// if (errMsg.includes('task-cancelled:')) {\n\t\t// \tconst parts = errMsg.split(':');\n\t\t// \tif (parts.length > 1) {\n\t\t// \t\tgenerationId = parts[1];\n\t\t// \t}\n\t\t// }\n\t\t\n\t\t// Show a notice and redirect to tasks page\n\t\tlogger.log('Task cancelled - redirecting to tasks page');\n\t\tdisplayError('Task has been cancelled. Redirecting to tasks page...');\n\t\tsetTimeout(() => {\n\t\t\tconst tasksUrl = `${window.nuclenAdminVars?.admin_url || '/wp-admin/'}admin.php?page=nuclear-engagement-tasks`;\n\t\t\twindow.location.href = tasksUrl;\n\t\t}, 2000);\n\t\treturn;\n\t}\n\t\n\t// Handle polling timeout gracefully - check for various patterns\n\tif (cleanMsg.includes('Polling failed after') || \n\t    cleanMsg.includes('Polling error') || \n\t\tcleanMsg.includes('Failed to fetch updates') || \n\t    cleanMsg.includes('polling-timeout:') || \n\t    cleanMsg.includes('polling-error:')) {\n\t\t\n\t\t// Extract generation ID if present in the error message\n\t\t// let generationId = '';\n\t\t// if (errMsg.includes('polling-timeout:') || errMsg.includes('polling-error:')) {\n\t\t// \tconst parts = errMsg.split(':');\n\t\t// \tif (parts.length > 1) {\n\t\t// \t\tgenerationId = parts[1];\n\t\t// \t}\n\t\t// }\n\t\t\n\t\t// Instead of showing a notice, redirect directly to tasks page\n\t\tlogger.log('Polling timeout/error detected - redirecting to tasks page');\n\t\tconst tasksUrl = `${window.nuclenAdminVars?.admin_url || '/wp-admin/'}admin.php?page=nuclear-engagement-tasks`;\n\t\twindow.location.href = tasksUrl;\n\t\treturn;\n\t}\n\t\n\t// Handle other errors as before\n\tif (cleanMsg.includes('Invalid API key')) {\n\t\tdisplayError('Your API key is invalid. Please go to the Setup page and enter a new one.');\n\t} else if (cleanMsg.includes('Invalid WP App Password')) {\n\t\tdisplayError('Your WP App Password is invalid. Please re-generate it on the Setup page.');\n\t} else if (cleanMsg.includes('Not enough credits')) {\n\t\tdisplayError('Not enough credits. Please top up your account or reduce the number of posts.');\n\t} else {\n\t\tdisplayError(`Error: ${cleanMsg}`);\n\t}\n}\n\nexport async function nuclenStoreGenerationResults(workflow: string, results: unknown, generationId?: string) {\n\tconst payload: { workflow: string; results: unknown; generation_id?: string } = { workflow, results };\n\tif (generationId) {\n\t\tpayload.generation_id = generationId;\n\t}\n\tlet resp: Response;\n\ttry {\n\t\tresp = await fetch(REST_ENDPOINT, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t'X-WP-Nonce': REST_NONCE,\n\t\t\t},\n\t\t\tcredentials: 'include',\n\t\t\tbody: JSON.stringify(payload),\n\t\t});\n\t} catch (err) {\n\t\tlogger.error('Fetch failed in nuclenStoreGenerationResults:', err);\n\t\tdisplayError('Network error');\n\t\treturn { ok: false, data: { message: 'Network error' } };\n\t}\n\tlet data: unknown = null;\n\tif (resp.ok) {\n\t\ttry {\n\t\t\tdata = await resp.json();\n\t\t} catch {\n\t\t\treturn { ok: false, data: { message: 'Invalid JSON' } };\n\t\t}\n\t}\n\treturn { ok: resp.ok, data };\n}\n","export {\n\tnuclenAlertApiError as alertApiError,\n\tnuclenStoreGenerationResults as storeGenerationResults,\n} from '../generation/results';\n\nexport interface PostResult {\n\tdate?: string;\n\tsummary?: string;\n\tquestions?: Array<{\n\tquestion?: string;\n\tanswers?: string[];\n\texplanation?: string;\n\t}>;\n\t[key: string]: unknown;\n}\n\nexport function populateQuizMetaBox(\n\tpostResult: PostResult,\n\tfinalDate?: string\n): void {\n\tconst { date, questions } = postResult;\n\tconst newDate = finalDate || date;\n\tconst dateField = document.querySelector<HTMLInputElement>('input[name=\"nuclen_quiz_data[date]\"]');\n\tif (dateField) {\n\t\tdateField.readOnly = false;\n\t\tdateField.value = newDate || '';\n\t\tdateField.readOnly = true;\n\t}\n\n\tif (Array.isArray(questions)) {\n\t\tquestions.forEach((q, qIndex) => {\n\t\t\tconst questionSelector = `input[name=\"nuclen_quiz_data[questions][${qIndex}][question]\"]`;\n\t\t\tconst questionInput = document.querySelector<HTMLInputElement>(questionSelector);\n\t\t\tif (questionInput) {\n\t\t\t\tquestionInput.value = q.question || '';\n\t\t\t}\n\n\t\t\tif (Array.isArray(q.answers)) {\n\t\t\t\tq.answers.forEach((ans: string, aIndex: number) => {\n\t\t\t\t\tconst ansSelector = `input[name=\"nuclen_quiz_data[questions][${qIndex}][answers][${aIndex}]\"]`;\n\t\t\t\t\tconst ansInput = document.querySelector<HTMLInputElement>(ansSelector);\n\t\t\t\t\tif (ansInput) {\n\t\t\t\t\t\tansInput.value = ans;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst explanationSelector = `textarea[name=\"nuclen_quiz_data[questions][${qIndex}][explanation]\"]`;\n\t\t\tconst explanationTextarea = document.querySelector<HTMLTextAreaElement>(explanationSelector);\n\t\t\tif (explanationTextarea) {\n\t\t\t\texplanationTextarea.value = q.explanation || '';\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function populateSummaryMetaBox(\n\tpostResult: PostResult,\n\tfinalDate?: string\n): void {\n\tconst { date, summary } = postResult;\n\tconst newDate = finalDate || date;\n\tconst dateField = document.querySelector<HTMLInputElement>('input[name=\"nuclen_summary_data[date]\"]');\n\tif (dateField) {\n\t\tdateField.readOnly = false;\n\t\tdateField.value = newDate || '';\n\t\tdateField.readOnly = true;\n\t}\n\n\t// Update the textarea value\n\tconst summaryField = document.querySelector<HTMLTextAreaElement>('textarea[name=\"nuclen_summary_data[summary]\"]');\n\tif (summaryField) {\n\t\tsummaryField.value = summary || '';\n\t\t\n\t\t// WordPress TinyMCE will automatically sync from the textarea value\n\t\t// when switching between Visual/Text tabs, so we don't need to\n\t\t// trigger any events or directly update TinyMCE\n\t}\n}\n\n","import {\n\talertApiError,\n\tpopulateQuizMetaBox,\n\tpopulateSummaryMetaBox,\n\tstoreGenerationResults,\n\ttype PostResult,\n} from './single-generation-utils';\nimport {\n\tNuclenStartGeneration,\n\tNuclenPollAndPullUpdates,\n} from '../nuclen-admin-generate';\nimport type { StartGenerationResponse, PollingUpdateData } from '../generation/api';\nimport { displayError } from '../utils/displayError';\nimport * as logger from '../utils/logger';\n\n// Store active polling cleanup functions\nconst activePollingCleanups = new Map<string, () => void>();\n\nexport function initSingleGenerationButtons(): void {\n\t// Use passive listener for better scroll performance\n\tdocument.addEventListener('click', async (event: MouseEvent) => {\n\t\tconst target = event.target;\n\t\tif (!(target instanceof HTMLElement)) return;\n\t\tif (!target.classList.contains('nuclen-generate-single')) return;\n\n\t\tconst btn = target as HTMLButtonElement;\n\t\tconst postId = btn.dataset.postId;\n\t\tconst workflow = btn.dataset.workflow;\n\t\tif (!postId || !workflow) {\n\t\t\tdisplayError('Missing data attributes: postId or workflow not found.');\n\t\t\treturn;\n\t\t}\n\n\t\t// Clean up any existing polling for this button\n\t\tconst buttonKey = `${postId}-${workflow}`;\n\t\tconst existingCleanup = activePollingCleanups.get(buttonKey);\n\t\tif (existingCleanup) {\n\t\t\texistingCleanup();\n\t\t\tactivePollingCleanups.delete(buttonKey);\n\t\t}\n\n\t\tbtn.disabled = true;\n\t\tbtn.textContent = 'Generating...';\n\n\t\t// Prepare the payload\n\t\tconst payload: Record<string, string> = {\n\t\t\tnuclen_selected_post_ids: JSON.stringify([postId]),\n\t\t\tnuclen_selected_generate_workflow: workflow,\n\t\t\tsource: 'single',\n\t\t};\n\n\t\t// If generating summary, include format options\n\t\tif (workflow === 'summary') {\n\t\t\tconst formatSelect = document.getElementById('nuclen_summary_data_format') as HTMLSelectElement;\n\t\t\tconst lengthSelect = document.getElementById('nuclen_summary_data_length') as HTMLSelectElement;\n\t\t\tconst itemsSelect = document.getElementById('nuclen_summary_data_number_of_items') as HTMLSelectElement;\n\n\t\t\tif (formatSelect) {\n\t\t\t\tpayload.nuclen_selected_summary_format = formatSelect.value;\n\t\t\t}\n\t\t\tif (lengthSelect && formatSelect?.value === 'paragraph') {\n\t\t\t\tpayload.nuclen_selected_summary_length = lengthSelect.value;\n\t\t\t}\n\t\t\tif (itemsSelect && formatSelect?.value === 'bullet_list') {\n\t\t\t\tpayload.nuclen_selected_summary_number_of_items = itemsSelect.value;\n\t\t\t}\n\t\t}\n\n\t\ttry {\n\t\t\tconst startResp: StartGenerationResponse | {\n\t\tok: boolean;\n\t\tstatus: number;\n\t\terror?: string;\n\t\tdata?: { generation_id?: string; [key: string]: unknown };\n\t\tgeneration_id?: string;\n\t\t} = await NuclenStartGeneration(payload);\n\n\t\t\tif ('ok' in startResp && !startResp.ok) {\n\t\t\t\talertApiError((startResp as { error?: string }).error || 'Generation failed');\n\t\t\t\tbtn.textContent = 'Generate';\n\t\t\t\tbtn.disabled = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst generationId =\n\t\tstartResp.data?.generation_id ||\n\t\tstartResp.generation_id ||\n\t\t'gen_' + Math.random().toString(36).substring(2);\n\n\t\t\tconst cleanupPolling = NuclenPollAndPullUpdates({\n\t\t\t\tintervalMs: 5000,\n\t\t\t\tgenerationId,\n\t\t\t\tonProgress() {\n\t\t\t\t\tbtn.textContent = 'Generating...';\n\t\t\t\t},\n\t\t\t\tasync onComplete({ results, workflow: wf }: PollingUpdateData) {\n\t\t\t\t\t// Remove cleanup function since polling completed\n\t\t\t\t\tactivePollingCleanups.delete(buttonKey);\n\t\t\t\t\tlogger.log(`[DEBUG] onComplete called | PostID: ${postId} | Workflow: ${wf} | Has results: ${!!results} | Results type: ${typeof results}`);\n\t\t\t\t\tif (results) {\n\t\t\t\t\t\tlogger.log(`[DEBUG] Results content: ${JSON.stringify(results)}`);\n\t\t\t\t\t}\n\t\t\t\t\tif (results && typeof results === 'object') {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst { ok, data } = await storeGenerationResults(wf, results, generationId);\n\t\t\t\t\t\t\tconst respData = data as Record<string, unknown>;\n\t\t\t\t\t\t\tif (ok && !('code' in respData)) {\n\t\t\t\t\t\t\t\tconst postResult = results[postId] as PostResult;\n\t\t\t\t\t\t\t\tlogger.log(`[DEBUG] Post result for ${postId}: ${JSON.stringify(postResult)}`);\n\t\t\t\t\t\t\t\tconst finalDate = respData.finalDate && typeof respData.finalDate === 'string' ? (respData.finalDate as string) : undefined;\n\t\t\t\t\t\t\t\tif (postResult) {\n\t\t\t\t\t\t\t\t\tif (wf === 'quiz') {\n\t\t\t\t\t\t\t\t\t\tpopulateQuizMetaBox(postResult, finalDate);\n\t\t\t\t\t\t\t\t\t} else if (wf === 'summary') {\n\t\t\t\t\t\t\t\t\t\tpopulateSummaryMetaBox(postResult, finalDate);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbtn.textContent = 'Stored!';\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tlogger.warn(`[WARNING] No result found for post ${postId} in results object`);\n\t\t\t\t\t\t\t\t\tbtn.textContent = 'Done (no data for this post)!';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlogger.error('Error storing single-generation results in WP:', respData);\n\t\t\t\t\t\t\t\tbtn.textContent = 'Generation failed!';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\tlogger.error('Fetch error calling /receive-content endpoint:', err);\n\t\t\t\t\t\t\tbtn.textContent = 'Generation failed!';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlogger.warn(`[WARNING] No results received | PostID: ${postId} | Results: ${results}`);\n\t\t\t\t\t\tbtn.textContent = 'Done (no data)!';\n\t\t\t\t\t}\n\t\t\t\t\tbtn.disabled = false;\n\t\t\t\t},\n\t\t\t\tonError(errMsg) {\n\t\t\t\t\t// Remove cleanup function since polling errored\n\t\t\t\t\tactivePollingCleanups.delete(buttonKey);\n\t\t\t\t\t\n\t\t\t\t\t// Check if this is a polling timeout or error\n\t\t\t\t\tif (errMsg.startsWith('polling-timeout:') || errMsg.startsWith('polling-error:')) {\n\t\t\t\t\t\t// const generationId = errMsg.split(':')[1];\n\t\t\t\t\t\t// Redirect to tasks page\n\t\t\t\t\t\twindow.location.href = `${window.nuclenAdminVars?.admin_url || '/wp-admin/'}admin.php?page=nuclear-engagement-tasks`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\talertApiError(errMsg);\n\t\t\t\t\t\tbtn.textContent = 'Generate';\n\t\t\t\t\t\tbtn.disabled = false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\t\n\t\t\t// Store the cleanup function\n\t\t\tactivePollingCleanups.set(buttonKey, cleanupPolling);\n\t\t} catch (err: unknown) {\n\t\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\n\t\t\talertApiError(message);\n\t\t\tbtn.textContent = 'Generate';\n\t\t\tbtn.disabled = false;\n\t\t}\n\t});\n\t\n\t// Clean up all active polling when page unloads\n\twindow.addEventListener('beforeunload', () => {\n\t\tactivePollingCleanups.forEach(cleanup => cleanup());\n\t\tactivePollingCleanups.clear();\n\t});\n}\n","import { initSingleGenerationButtons } from './single/single-generation-handlers';\n\n// Initialize summary format field toggling for metabox\nfunction initSummaryFormatToggle(): void {\n\tconst formatSelect = document.getElementById('nuclen_summary_data_format') as HTMLSelectElement;\n\tif (!formatSelect) return;\n\n\tconst paragraphOptions = document.querySelector('.nuclen-summary-paragraph-options') as HTMLElement;\n\tconst bulletOptions = document.querySelector('.nuclen-summary-bullet-options') as HTMLElement;\n\n\tfunction toggleFormatFields(): void {\n\t\tif (!paragraphOptions || !bulletOptions) return;\n\n\t\tif (formatSelect.value === 'paragraph') {\n\t\t\tparagraphOptions.style.display = 'block';\n\t\t\tbulletOptions.style.display = 'none';\n\t\t} else {\n\t\t\tparagraphOptions.style.display = 'none';\n\t\t\tbulletOptions.style.display = 'block';\n\t\t}\n\t}\n\n\t// Initial toggle\n\ttoggleFormatFields();\n\n\t// Listen for changes\n\tformatSelect.addEventListener('change', toggleFormatFields);\n}\n\n// Initialize everything when DOM is ready\nfunction initAll(): void {\n\tinitSummaryFormatToggle();\n\tinitSingleGenerationButtons();\n}\n\nif (document.readyState === 'loading') {\n\tdocument.addEventListener('DOMContentLoaded', initAll);\n} else {\n\t// Defer initialization to next tick to ensure WordPress has finished its setup\n\tsetTimeout(initAll, 0);\n}\n","export interface GeneratePageElements {\n\tstep1: HTMLDivElement | null;\n\tstep2: HTMLDivElement | null;\n\tupdatesSection: HTMLDivElement | null;\n\tupdatesContent: HTMLDivElement | null;\n\trestartBtn: HTMLButtonElement | null;\n\tgetPostsBtn: HTMLButtonElement | null;\n\tgoBackBtn: HTMLButtonElement | null;\n\tgenerateForm: HTMLFormElement | null;\n\tsubmitBtn: HTMLButtonElement | null;\n\tpostsCountEl: HTMLSpanElement | null;\n\tstepBar1: HTMLElement | null;\n\tstepBar2: HTMLElement | null;\n\t// Removed stepBar3 and stepBar4 - no longer needed\n\tcreditsInfoEl: HTMLParagraphElement | null;\n}\n\nexport function getGeneratePageElements(): GeneratePageElements {\n\treturn {\n\t\tstep1: document.getElementById('nuclen-step-1') as HTMLDivElement | null,\n\t\tstep2: document.getElementById('nuclen-step-2') as HTMLDivElement | null,\n\t\tupdatesSection: document.getElementById('nuclen-updates-section') as HTMLDivElement | null,\n\t\tupdatesContent: document.getElementById('nuclen-updates-content') as HTMLDivElement | null,\n\t\trestartBtn: document.getElementById('nuclen-restart-btn') as HTMLButtonElement | null,\n\t\tgetPostsBtn: document.getElementById('nuclen-get-posts-btn') as HTMLButtonElement | null,\n\t\tgoBackBtn: document.getElementById('nuclen-go-back-btn') as HTMLButtonElement | null,\n\t\tgenerateForm: document.getElementById('nuclen-generate-form') as HTMLFormElement | null,\n\t\tsubmitBtn: document.getElementById('nuclen-submit-btn') as HTMLButtonElement | null,\n\t\tpostsCountEl: document.getElementById('nuclen-posts-count') as HTMLSpanElement | null,\n\t\tstepBar1: document.getElementById('nuclen-step-bar-1'),\n\t\tstepBar2: document.getElementById('nuclen-step-bar-2'),\n\t\t// Removed stepBar3 and stepBar4 - no longer needed\n\t\tcreditsInfoEl: document.getElementById('nuclen-credits-info') as HTMLParagraphElement | null,\n\t};\n}\n","export function nuclenShowElement(el: HTMLElement | null): void {\n\tif (!el) return;\n\tel.classList.remove('nuclen-hidden');\n\t\n\t// Scroll to progress bar when showing step 2\n\tif (el.id === 'nuclen-step-2') {\n\t\tconst progressBar = document.getElementById('nuclen-progress-bar');\n\t\tif (progressBar) {\n\t\t\t// Get the position of the progress bar and scroll to it with some offset\n\t\t\tconst rect = progressBar.getBoundingClientRect();\n\t\t\tconst scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n\t\t\tconst targetPosition = rect.top + scrollTop - 32; // 32px offset for WordPress admin bar\n\t\t\t\n\t\t\twindow.scrollTo({ \n\t\t\t\ttop: targetPosition, \n\t\t\t\tbehavior: 'smooth' \n\t\t\t});\n\t\t} else {\n\t\t\t// Fallback to scrolling to top if progress bar not found\n\t\t\twindow.scrollTo({ top: 0, behavior: 'smooth' });\n\t\t}\n\t}\n}\n\nexport function nuclenHideElement(el: HTMLElement | null): void {\n\tif (!el) return;\n\tel.classList.add('nuclen-hidden');\n}\n\nexport function nuclenUpdateProgressBarStep(stepEl: HTMLElement | null, state: string): void {\n\tif (!stepEl) return;\n\tstepEl.classList.remove(\n\t\t'ne-step-bar__step--todo',\n\t\t'ne-step-bar__step--current',\n\t\t'ne-step-bar__step--done',\n\t\t'ne-step-bar__step--failed'\n\t);\n\tstepEl.classList.add(`ne-step-bar__step--${state}`);\n}\n\n/**\n * Fetch remaining credits from the SaaS.\n */\ninterface CreditsResponse {\n\tsuccess: boolean;\n\tmessage?: string;\n\tdata: {\n\tremaining_credits?: number;\n\tmessage?: string;\n\t[key: string]: unknown;\n\t};\n}\n\nexport async function nuclenCheckCreditsAjax(): Promise<number> {\n\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url) {\n\t\tthrow new Error('Missing nuclenAjax configuration (ajax_url).');\n\t}\n\tif (!window.nuclenAjax.fetch_action) {\n\t\tthrow new Error('Missing fetch_action in nuclenAjax configuration.');\n\t}\n\tconst formData = new FormData();\n\tformData.append('action', window.nuclenAjax.fetch_action);\n\tif (window.nuclenAjax.nonce) {\n\t\tformData.append('security', window.nuclenAjax.nonce);\n\t}\n\tconst result = await nuclenFetchWithRetry<CreditsResponse>(\n\t\twindow.nuclenAjax.ajax_url,\n\t\t{\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t\tcredentials: 'same-origin',\n\t\t}\n\t);\n\tif (!result.ok) {\n\t\tthrow new Error(result.error || `HTTP ${result.status}`);\n\t}\n\tconst data = result.data as CreditsResponse;\n\tif (!data.success) {\n\t\tthrow new Error(data.message || data.data?.message || 'Failed to fetch credits from SaaS');\n\t}\n\tif (typeof data.data.remaining_credits === 'number') {\n\t\treturn data.data.remaining_credits;\n\t}\n\tthrow new Error(\"No 'remaining_credits' in response\");\n}\n\n/**\n * Toggle summary settings visibility.\n */\nexport function nuclenToggleSummaryFields(): void {\n\tconst generateTypeEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\n\tconst summaryFormatRow = document.getElementById('nuclen-summary-format-row') as HTMLElement | null;\n\tconst summaryParagraphRow = document.getElementById('nuclen-summary-paragraph-row') as HTMLElement | null;\n\tconst summaryBulletRow = document.getElementById('nuclen-summary-bullet-row') as HTMLElement | null;\n\tconst summaryFormatEl = document.getElementById('nuclen_format') as HTMLSelectElement | null;\n\n\tif (!generateTypeEl || !summaryFormatRow) {\n\t\treturn;\n\t}\n\t\n\tif (generateTypeEl.value === 'summary') {\n\t\tsummaryFormatRow.classList.remove('nuclen-hidden');\n\t\tif (summaryFormatEl && summaryParagraphRow && summaryBulletRow) {\n\t\t\tif (summaryFormatEl.value === 'paragraph') {\n\t\t\t\tsummaryParagraphRow.classList.remove('nuclen-hidden');\n\t\t\t\tsummaryBulletRow.classList.add('nuclen-hidden');\n\t\t\t} else {\n\t\t\t\tsummaryParagraphRow.classList.add('nuclen-hidden');\n\t\t\t\tsummaryBulletRow.classList.remove('nuclen-hidden');\n\t\t\t}\n\t\t}\n\t} else {\n\t\tsummaryFormatRow.classList.add('nuclen-hidden');\n\t\tif (summaryParagraphRow) summaryParagraphRow.classList.add('nuclen-hidden');\n\t\tif (summaryBulletRow) summaryBulletRow.classList.add('nuclen-hidden');\n\t}\n}\n\nimport { nuclenFetchWithRetry } from '../nuclen-admin-generate';\n","export interface NuclenFilterValues {\n\tpostStatus: string;\n\tcategory: string;\n\tauthor: string;\n\tpostType: string;\n\tworkflow: string;\n\tallowRegenerate: boolean;\n\tregenerateProtected: boolean;\n\tsummaryFormat: string;\n\tsummaryLength: string;\n\tsummaryNumberOfItems: string;\n}\n\nexport function nuclenCollectFilters(): NuclenFilterValues {\n\tconst postStatusEl = document.getElementById('nuclen_post_status') as HTMLSelectElement | null;\n\tconst categoryEl = document.getElementById('nuclen_category') as HTMLSelectElement | null;\n\tconst authorEl = document.getElementById('nuclen_author') as HTMLSelectElement | null;\n\tconst postTypeEl = document.getElementById('nuclen_post_type') as HTMLSelectElement | null;\n\tconst workflowEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\n\tconst allowRegenEl = document.getElementById('nuclen_allow_regenerate_data') as HTMLInputElement | null;\n\tconst protectRegenEl = document.getElementById('nuclen_regenerate_protected_data') as HTMLInputElement | null;\n\tconst summaryFormatEl = document.getElementById('nuclen_format') as HTMLSelectElement | null;\n\tconst summaryLengthEl = document.getElementById('nuclen_length') as HTMLSelectElement | null;\n\tconst summaryNumberEl = document.getElementById('nuclen_number_of_items') as HTMLSelectElement | null;\n\treturn {\n\t\tpostStatus: postStatusEl ? postStatusEl.value : '',\n\t\tcategory: categoryEl ? categoryEl.value : '',\n\t\tauthor: authorEl ? authorEl.value : '',\n\t\tpostType: postTypeEl ? postTypeEl.value : '',\n\t\tworkflow: workflowEl ? workflowEl.value : '',\n\t\tallowRegenerate: !!allowRegenEl && allowRegenEl.checked,\n\t\tregenerateProtected: !!protectRegenEl && protectRegenEl.checked,\n\t\tsummaryFormat: summaryFormatEl ? summaryFormatEl.value : '',\n\t\tsummaryLength: summaryLengthEl ? summaryLengthEl.value : '',\n\t\tsummaryNumberOfItems: summaryNumberEl ? summaryNumberEl.value : '',\n\t};\n}\n\nexport function nuclenAppendFilters(formData: FormData, filters: NuclenFilterValues): void {\n\tformData.append('nuclen_post_status', filters.postStatus);\n\tformData.append('nuclen_category', filters.category);\n\tformData.append('nuclen_author', filters.author);\n\tformData.append('nuclen_post_type', filters.postType);\n\tformData.append('nuclen_generate_workflow', filters.workflow);\n\tformData.append('nuclen_allow_regenerate_data', filters.allowRegenerate ? '1' : '0');\n\tformData.append('nuclen_regenerate_protected_data', filters.regenerateProtected ? '1' : '0');\n\tformData.append('nuclen_summary_format', filters.summaryFormat);\n\tformData.append('nuclen_summary_length', filters.summaryLength);\n\tformData.append('nuclen_summary_number_of_items', filters.summaryNumberOfItems);\n}\n\nexport function nuclenStoreFilters(filters: NuclenFilterValues): void {\n\tconst selectedWorkflowEl = document.getElementById('nuclen_selected_generate_workflow') as HTMLInputElement | null;\n\tconst selectedSummaryFormatEl = document.getElementById('nuclen_selected_summary_format') as HTMLInputElement | null;\n\tconst selectedSummaryLengthEl = document.getElementById('nuclen_selected_summary_length') as HTMLInputElement | null;\n\tconst selectedSummaryNumberEl = document.getElementById('nuclen_selected_summary_number_of_items') as HTMLInputElement | null;\n\tconst selectedPostStatusEl = document.getElementById('nuclen_selected_post_status') as HTMLInputElement | null;\n\tconst selectedPostTypeEl = document.getElementById('nuclen_selected_post_type') as HTMLInputElement | null;\n\n\tif (selectedWorkflowEl) {\n\t\tselectedWorkflowEl.value = filters.workflow;\n\t}\n\tif (selectedSummaryFormatEl) {\n\t\tselectedSummaryFormatEl.value = filters.summaryFormat;\n\t}\n\tif (selectedSummaryLengthEl) {\n\t\tselectedSummaryLengthEl.value = filters.summaryLength;\n\t}\n\tif (selectedSummaryNumberEl) {\n\t\tselectedSummaryNumberEl.value = filters.summaryNumberOfItems;\n\t}\n\tif (selectedPostStatusEl) {\n\t\tselectedPostStatusEl.value = filters.postStatus;\n\t}\n\tif (selectedPostTypeEl) {\n\t\tselectedPostTypeEl.value = filters.postType;\n\t}\n}\n\n","import { nuclenFetchWithRetry } from '../nuclen-admin-generate';\nimport {\n\tnuclenShowElement,\n\tnuclenHideElement,\n\tnuclenUpdateProgressBarStep,\n\tnuclenCheckCreditsAjax,\n} from './generate-page-utils';\nimport type { GeneratePageElements } from './elements';\nimport {\n\tnuclenCollectFilters,\n\tnuclenAppendFilters,\n\tnuclenStoreFilters,\n\ttype NuclenFilterValues,\n} from './filters';\nimport { displayError } from '../utils/displayError';\nimport * as logger from '../utils/logger';\n\ninterface PostsCountResponse {\n        success: boolean;\n        message?: string;\n        data: {\n        count: number;\n\tpost_ids: string[];\n\tmessage?: string;\n\t[key: string]: unknown;\n        };\n}\n\nasync function requestPostsCount(\n\tajaxUrl: string,\n\tfilters: NuclenFilterValues,\n): Promise<PostsCountResponse | null> {\n\tconst formData = new FormData();\n\tformData.append('action', 'nuclen_get_posts_count');\n\tif (window.nuclenAjax?.nonce) {\n\t\tformData.append('security', window.nuclenAjax.nonce);\n\t}\n\tnuclenAppendFilters(formData, filters);\n\tconst result = await nuclenFetchWithRetry<PostsCountResponse>(ajaxUrl, {\n\t\tmethod: 'POST',\n\t\tbody: formData,\n\t\tcredentials: 'same-origin',\n\t});\n\treturn result.ok ? (result.data as PostsCountResponse) : null;\n}\n\nasync function updateCreditsInfo(elements: GeneratePageElements, count: number): Promise<void> {\n\ttry {\n\t\tconst remainingCredits = await nuclenCheckCreditsAjax();\n\t\tconst neededCredits = count;\n\t\tif (elements.creditsInfoEl) {\n\t\t\telements.creditsInfoEl.textContent = `This will consume ${neededCredits} credit(s). You have ${remainingCredits} left.`;\n\t\t}\n\t\tif (remainingCredits < neededCredits) {\n\t\t\tdisplayError('Not enough credits. Please top up or reduce the number of posts.');\n\t\t\tif (elements.submitBtn) {\n\t\t\t\telements.submitBtn.disabled = true;\n\t\t\t}\n\t\t} else if (elements.submitBtn) {\n\t\t\tnuclenShowElement(elements.submitBtn);\n\t\t\telements.submitBtn.disabled = false;\n\t\t}\n\t} catch (err: unknown) {\n\t\tlogger.error('Error fetching remaining credits:', err);\n\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\n\t\tif (elements.creditsInfoEl) {\n\t\t\telements.creditsInfoEl.textContent = `Unable to retrieve your credits: ${message}`;\n\t\t}\n\t\tif (elements.submitBtn) {\n\t\t\tnuclenHideElement(elements.submitBtn);\n\t\t}\n\t}\n}\n\nexport function initStep1(elements: GeneratePageElements): void {\n\telements.getPostsBtn?.addEventListener('click', async () => {\n\t\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url) {\n\t\t\tdisplayError('Error: Ajax is not configured properly. Please check the plugin settings.');\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Store original button text and disable button\n\t\tconst originalButtonText = elements.getPostsBtn?.textContent || 'Get Posts to Process';\n\t\tif (elements.getPostsBtn) {\n\t\t\telements.getPostsBtn.textContent = 'Selecting posts...';\n\t\t\telements.getPostsBtn.disabled = true;\n\t\t}\n\t\t\n\t\tif (elements.postsCountEl) {\n\t\t\telements.postsCountEl.innerText = 'Loading posts...';\n\t\t}\n\t\tconst filters: NuclenFilterValues = nuclenCollectFilters();\n\t\tconst data = await requestPostsCount(window.nuclenAjax.ajax_url || '', filters);\n\t\tif (!data) {\n\t\t\tlogger.error('Error retrieving post count');\n\t\t\tif (elements.postsCountEl) {\n\t\t\t\telements.postsCountEl.innerText = 'Error retrieving post count.';\n\t\t\t}\n\t\t\t// Restore button state on error\n\t\t\tif (elements.getPostsBtn) {\n\t\t\t\telements.getPostsBtn.textContent = originalButtonText;\n\t\t\t\telements.getPostsBtn.disabled = false;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (!data.success) {\n\t\t\tif (elements.postsCountEl) {\n\t\t\t\telements.postsCountEl.innerText = 'Error retrieving post count.';\n\t\t\t}\n\t\t\tconst errMsg = data.message || data.data?.message;\n\t\t\tif (errMsg) {\n\t\t\t\tif (errMsg.includes('Invalid API key')) {\n\t\t\t\t\tdisplayError('Your Gold Code (API key) is invalid. Please create a new one on the NE app and enter it on the plugin Setup page.');\n\t\t\t\t} else if (errMsg.includes('Invalid WP App Password')) {\n\t\t\t\t\tdisplayError('Your WP App Password is invalid. Please go to the plugin Setup page and re-generate it.');\n\t\t\t\t} else {\n\t\t\t\t\tdisplayError(errMsg);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Restore button state on error\n\t\t\tif (elements.getPostsBtn) {\n\t\t\t\telements.getPostsBtn.textContent = originalButtonText;\n\t\t\t\telements.getPostsBtn.disabled = false;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tconst count = data.data.count as number;\n\t\tconst foundPosts = data.data.post_ids;\n\t\tconst selectedPostIdsEl = document.getElementById('nuclen_selected_post_ids') as HTMLInputElement | null;\n\t\tif (selectedPostIdsEl) {\n\t\t\tselectedPostIdsEl.value = JSON.stringify(foundPosts);\n\t\t}\n\t\tnuclenStoreFilters(filters);\n\t\tnuclenHideElement(elements.step1);\n\t\tnuclenShowElement(elements.step2);\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'done');\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'current');\n\t\tif (count === 0) {\n\t\t\tif (elements.postsCountEl) {\n\t\t\t\telements.postsCountEl.innerText = 'No posts found with these filters.';\n\t\t\t}\n\t\t\tif (elements.submitBtn) {\n\t\t\t\tnuclenHideElement(elements.submitBtn);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (elements.postsCountEl) {\n\t\t\telements.postsCountEl.innerText = `Number of posts to process: ${count}`;\n\t\t}\n\t\tawait updateCreditsInfo(elements, count);\n\t});\n}\n","import * as logger from './logger';\n\nexport function displaySuccess(message: string, _context?: Record<string, any>): void {\n\t// Log success with context\n\tlogger.log(`[SUCCESS] UI Success | ${message}`);\n\t\n\t// Create toast notification\n\tconst toast = document.createElement('div');\n\ttoast.className = 'nuclen-success-toast';\n\ttoast.innerHTML = message;\n\tdocument.body.appendChild(toast);\n\t\n\t// Remove toast after 5 seconds\n\tsetTimeout(() => {\n\t\tif (toast.parentNode) {\n\t\t\ttoast.remove();\n\t\t}\n\t}, 5000);\n}\n\nexport function displayPageMessage(message: string, type: 'success' | 'info' | 'warning' = 'success'): void {\n\t// Log message\n\tlogger.log(`[PAGE MESSAGE] ${type.toUpperCase()} | ${message}`);\n\t\n\t// Find or create message container\n\tlet messageContainer = document.getElementById('nuclen-page-message');\n\tif (!messageContainer) {\n\t\t// Create it after the heading\n\t\tconst heading = document.querySelector('.nuclen-heading');\n\t\tif (heading) {\n\t\t\tmessageContainer = document.createElement('div');\n\t\t\tmessageContainer.id = 'nuclen-page-message';\n\t\t\theading.insertAdjacentElement('afterend', messageContainer);\n\t\t}\n\t}\n\t\n\tif (messageContainer) {\n\t\t// Clear any existing message\n\t\tmessageContainer.innerHTML = '';\n\t\t\n\t\t// Create message element\n\t\tconst messageEl = document.createElement('div');\n\t\tmessageEl.className = `nuclen-page-message nuclen-page-message--${type}`;\n\t\tmessageEl.innerHTML = `\n\t\t\t<div class=\"nuclen-page-message__icon\">\n\t\t\t\t${type === 'success' ? '' : type === 'warning' ? '' : ''}\n\t\t\t</div>\n\t\t\t<div class=\"nuclen-page-message__text\">${message}</div>\n\t\t`;\n\t\t\n\t\tmessageContainer.appendChild(messageEl);\n\t\t\n\t\t// Auto-hide after 10 seconds for non-warning messages\n\t\tif (type !== 'warning') {\n\t\t\tsetTimeout(() => {\n\t\t\t\tmessageEl.style.opacity = '0';\n\t\t\t\tsetTimeout(() => messageEl.remove(), 300);\n\t\t\t}, 10000);\n\t\t}\n\t}\n}","import {\n\tNuclenStartGeneration,\n\t// NuclenPollAndPullUpdates, // Commented out - polling disabled for now\n} from '../nuclen-admin-generate';\nimport type {\n\tStartGenerationResponse,\n\t// PollingUpdateData, // Commented out - polling disabled for now\n} from '../generation/api';\nimport {\n\t// nuclenShowElement, // Commented out - not needed anymore\n\tnuclenHideElement,\n\tnuclenUpdateProgressBarStep,\n} from './generate-page-utils';\nimport type { GeneratePageElements } from './elements';\nimport { error } from '../../../shared/logger';\nimport {\n\tnuclenAlertApiError,\n} from '../generation/results';\nimport { displayError } from '../utils/displayError';\nimport { displaySuccess, displayPageMessage } from '../utils/displaySuccess';\n\n// Store active polling cleanup function\n// Not currently used as polling is disabled, but kept for future use\n// let activePollingCleanup: (() => void) | null = null;\n\n// Function removed - results are stored by backend during polling\n// This function is no longer needed since we're redirecting to tasks page\n\nexport function initStep2(elements: GeneratePageElements): void {\n\telements.generateForm?.addEventListener('submit', async (event) => {\n\t\tevent.preventDefault();\n\t\t\n\t\t// Clean up any existing polling - commented out since polling is disabled\n\t\t/*\n\t\tif (activePollingCleanup) {\n\t\t\tactivePollingCleanup();\n\t\t\tactivePollingCleanup = null;\n\t\t}\n\t\t*/\n\t\tif (!window.nuclenAdminVars || !window.nuclenAdminVars.ajax_url) {\n\t\t\tdisplayError('Error: WP Ajax config not found. Please check the plugin settings.');\n\t\t\treturn;\n\t\t}\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'done');\n\t\t// Remove step 3 & 4 - no longer showing real-time progress\n\t\tnuclenHideElement(elements.step2);\n\t\tif (elements.submitBtn) {\n\t\t\telements.submitBtn.disabled = true;\n\t\t\telements.submitBtn.innerHTML = '<span class=\"spinner is-active\" style=\"float: none; margin: 0 8px 0 0;\"></span>Starting generation...';\n\t\t}\n\t\t\n\t\t// Show loading message in the page\n\t\tdisplayPageMessage('Starting content generation...', 'info');\n\t\ttry {\n\t\t\tconst formDataObj = Object.fromEntries(new FormData(elements.generateForm!).entries());\n\t\t\tconst startResp: StartGenerationResponse = await NuclenStartGeneration(\n\t\t\t\tformDataObj\n\t\t\t);\n\t\t\t// Extract generation_id - WordPress returns it in data object\n\t\t\tlet generationId = '';\n\t\t\t\n\t\t\t// The actual structure from WordPress wp_send_json_success is:\n\t\t\t// { success: true, data: { generation_id: \"...\", ... } }\n\t\t\tif (startResp && startResp.data && startResp.data.generation_id) {\n\t\t\t\tgenerationId = String(startResp.data.generation_id);\n\t\t\t}\n\t\t\t// Fallback checks for other possible structures\n\t\t\telse if (startResp && startResp.generation_id) {\n\t\t\t\tgenerationId = String(startResp.generation_id);\n\t\t\t}\n\t\t\t\n\t\t\t// Final fallback to random ID if not found\n\t\t\tif (!generationId) {\n\t\t\t\terror('Generation ID not found in response, using fallback');\n\t\t\t\tgenerationId = 'gen_' + Math.random().toString(36).substring(2);\n\t\t\t}\n\t\t\t\n\t\t\t// Show success message in the page\n\t\t\tdisplayPageMessage(' Generation task started successfully! Content is being generated in the background.', 'success');\n\t\t\t\n\t\t\t// Also show a success toast\n\t\t\tdisplaySuccess('Redirecting to tasks page in a moment...');\n\t\t\t\n\t\t\t// Redirect to tasks page after 3 seconds\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst tasksUrl = `${window.nuclenAdminVars?.admin_url || '/wp-admin/'}admin.php?page=nuclear-engagement-tasks`;\n\t\t\t\twindow.location.href = tasksUrl;\n\t\t\t}, 3000);\n\t\t\t\n\t\t\t// Comment out the polling code for later use\n\t\t\t/*\n\t\t\tactivePollingCleanup = NuclenPollAndPullUpdates({\n\t\t\t\tintervalMs: 5000,\n\t\t\t\tgenerationId,\n\t\t\t\tonProgress: (processed, total) => {\n\t\t\t\t\tconst safeProcessed = processed === undefined ? 0 : processed;\n\t\t\t\t\tconst safeTotal = total === undefined ? 0 : total;\n\t\t\t\t\tif (elements.updatesContent) {\n\t\t\t\t\t\t// Show simple progress message\n\t\t\t\t\t\tconst progressPercent = safeTotal > 0 ? Math.round((safeProcessed / safeTotal) * 100) : 0;\n\t\t\t\t\t\telements.updatesContent.innerHTML = `<span class=\"spinner is-active\"></span> Processing: ${safeProcessed} of ${safeTotal} posts completed (${progressPercent}%)`;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonComplete: async ({ failCount, finalReport }: PollingUpdateData) => {\n\t\t\t\t\t// Clear the cleanup function since polling completed\n\t\t\t\t\tactivePollingCleanup = null;\n\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'done');\n\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar4, 'current');\n\t\t\t\t\t// Results are already stored by the backend during polling\n\t\t\t\t\t// await storeResults(workflow, results);\n\t\t\t\t\tupdateCompletionUi(elements, failCount, finalReport);\n\t\t\t\t},\n\t\t\t\tonError: (errMsg: string) => {\n\t\t\t\t\t// Clear the cleanup function since polling errored\n\t\t\t\t\tactivePollingCleanup = null;\n\t\t\t\t\t\n\t\t\t\t\t// Check if this is a polling timeout or error\n\t\t\t\t\tif (errMsg.startsWith('polling-timeout:') || errMsg.startsWith('polling-error:')) {\n\t\t\t\t\t\tconst generationId = errMsg.split(':')[1];\n\t\t\t\t\t\t// Redirect to tasks page\n\t\t\t\t\t\twindow.location.href = `${window.nuclenAdminVars?.admin_url || '/wp-admin/'}admin.php?page=nuclear-engagement-tasks`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Handle other errors as failures\n\t\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'failed');\n\t\t\t\t\t\tnuclenAlertApiError(errMsg);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (elements.updatesContent) {\n\t\t\t\t\t\t\telements.updatesContent.innerText = `Error: ${errMsg}`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (elements.submitBtn) {\n\t\t\t\t\t\t\telements.submitBtn.disabled = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnuclenShowElement(elements.restartBtn);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t});\n\t\t\t*/\n\t\t} catch (error: unknown) {\n\t\t\t// Handle error without step 3 references\n\t\t\tconst message = error instanceof Error ? error.message : 'Unknown error';\n\t\t\tnuclenAlertApiError(message);\n\t\t\tif (elements.submitBtn) {\n\t\t\t\telements.submitBtn.disabled = false;\n\t\t\t}\n\t\t\t// Don't show restart button since we're redirecting\n\t\t}\n\t});\n\t\n\t// Clean up active polling when page unloads - commented out since polling is disabled\n\t/*\n\twindow.addEventListener('beforeunload', () => {\n\t\tif (activePollingCleanup) {\n\t\t\tactivePollingCleanup();\n\t\t\tactivePollingCleanup = null;\n\t\t}\n\t});\n\t*/\n}\n","import {\n\tnuclenShowElement,\n\tnuclenHideElement,\n\tnuclenUpdateProgressBarStep,\n\tnuclenToggleSummaryFields,\n} from './generate-page-utils';\nimport type { GeneratePageElements } from './elements';\n\nexport function initGoBack(elements: GeneratePageElements): void {\n\telements.goBackBtn?.addEventListener('click', () => {\n\t\tnuclenHideElement(elements.step2);\n\t\tnuclenShowElement(elements.step1);\n\t\tif (elements.postsCountEl) {\n\t\t\telements.postsCountEl.innerText = '';\n\t\t}\n\t\tif (elements.creditsInfoEl) {\n\t\t\telements.creditsInfoEl.textContent = '';\n\t\t}\n\t\t// Reset the Step 1 button to its original state\n\t\tif (elements.getPostsBtn) {\n\t\t\telements.getPostsBtn.textContent = 'Get Posts to Process';\n\t\t\telements.getPostsBtn.disabled = false;\n\t\t}\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'current');\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'todo');\n\t});\n}\n\nexport function initRestart(elements: GeneratePageElements): void {\n\telements.restartBtn?.addEventListener('click', () => {\n\t\tnuclenHideElement(elements.updatesSection);\n\t\tnuclenHideElement(elements.restartBtn);\n\t\tnuclenHideElement(elements.step2);\n\t\tif (elements.postsCountEl) {\n\t\t\telements.postsCountEl.innerText = '';\n\t\t}\n\t\tif (elements.creditsInfoEl) {\n\t\t\telements.creditsInfoEl.textContent = '';\n\t\t}\n\t\t// Reset the Step 1 button to its original state\n\t\tif (elements.getPostsBtn) {\n\t\t\telements.getPostsBtn.textContent = 'Get Posts to Process';\n\t\t\telements.getPostsBtn.disabled = false;\n\t\t}\n\t\tnuclenShowElement(elements.step1);\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'current');\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'todo');\n\t\t// Removed step 3 & 4 updates - no longer needed\n\t});\n}\n\nexport function initSummaryToggle(): void {\n\tnuclenToggleSummaryFields();\n\tconst generateTypeEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\n\tconst summaryFormatEl = document.getElementById('nuclen_format') as HTMLSelectElement | null;\n\tgenerateTypeEl?.addEventListener('change', nuclenToggleSummaryFields);\n\tsummaryFormatEl?.addEventListener('change', nuclenToggleSummaryFields);\n}\n","import { getGeneratePageElements } from './elements';\nimport { initStep1 } from './step1';\nimport { initStep2 } from './step2';\nimport { initGoBack, initRestart, initSummaryToggle } from './navigation';\n\nexport function initGeneratePage(): void {\n\tconst elements = getGeneratePageElements();\n\n\t// Initial UI setup - removed step 3 & 4\n\tif (elements.step1) elements.step1.classList.remove('nuclen-hidden');\n\tif (elements.step2) elements.step2.classList.add('nuclen-hidden');\n\tif (elements.updatesSection) elements.updatesSection.classList.add('nuclen-hidden');\n\tif (elements.restartBtn) elements.restartBtn.classList.add('nuclen-hidden');\n\tif (elements.stepBar1) elements.stepBar1.classList.add('ne-step-bar__step--current');\n\tif (elements.stepBar2) elements.stepBar2.classList.add('ne-step-bar__step--todo');\n\n\tinitStep1(elements);\n\tinitStep2(elements);\n\tinitGoBack(elements);\n\tinitRestart(elements);\n\tinitSummaryToggle();\n}\n","import { initGeneratePage } from './generate/generate-page-handlers';\n\ninitGeneratePage();\n","// admin/ts/nuclen-admin-ui.ts\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n\t// Grab tab links as HTMLAnchorElements\n\tconst tabs = document.querySelectorAll<HTMLAnchorElement>(\".nav-tab\");\n\t// Grab tab content sections as HTMLElements\n\tconst contents = document.querySelectorAll<HTMLElement>(\".nuclen-tab-content\");\n\n\ttabs.forEach((tab) => {\n\t\ttab.addEventListener(\"click\", (e) => {\n\t\t\te.preventDefault();\n\t\t\tconst target = tab.getAttribute(\"href\");\n\t\t\tif (!target) return; // If href is missing, bail\n\n\t\t\t// Remove active class from all tabs, then add to the one that was clicked\n\t\t\ttabs.forEach((t) => t.classList.remove(\"nav-tab-active\"));\n\t\t\ttab.classList.add(\"nav-tab-active\");\n\n\t\t\t// Hide all tab contents, then show only the targeted one\n\t\t\tcontents.forEach((c) => {\n\t\t\t\tc.style.display = \"none\";\n\t\t\t});\n\t\t\tconst targetContent = document.querySelector<HTMLElement>(target);\n\t\t\tif (targetContent) {\n\t\t\t\ttargetContent.style.display = \"block\";\n\t\t\t}\n\t\t});\n\t});\n\n\n\n\t// Show/hide the custom theme section\n\tconst customThemeSection = document.getElementById(\"nuclen-custom-theme-section\");\n\tconst themeRadios = document.querySelectorAll<HTMLInputElement>(\"input[name='nuclen_theme']\");\n\n\tfunction nuclenUpdateCustomThemeVisibility() {\n\t\tconst checkedInput = document.querySelector<HTMLInputElement>(\"input[name='nuclen_theme']:checked\");\n\t\t// If either the input or the section is missing, do nothing\n\t\tif (!checkedInput || !customThemeSection) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst selectedTheme = checkedInput.value;\n\t\tif (selectedTheme === \"custom\") {\n\t\t\tcustomThemeSection.classList.remove(\"nuclen-hidden\");\n\t\t} else {\n\t\t\tcustomThemeSection.classList.add(\"nuclen-hidden\");\n\t\t}\n\t}\n\n\t// Listen for theme radio changes\n\tthemeRadios.forEach((radio) => {\n\t\tradio.addEventListener(\"change\", nuclenUpdateCustomThemeVisibility);\n\t});\n\n\t// Initial run on page load\n\tnuclenUpdateCustomThemeVisibility();\n\n\t// Initialize auto-generation summary format toggling for settings page\n\tfunction initAutoGenSummaryFormatToggle(): void {\n\t\tconst formatSelect = document.getElementById('auto_summary_format') as HTMLSelectElement;\n\t\tif (!formatSelect) return;\n\n\t\tconst paragraphOptions = document.querySelector('.nuclen-summary-paragraph-options') as HTMLElement;\n\t\tconst bulletOptions = document.querySelector('.nuclen-summary-bullet-options') as HTMLElement;\n\n\t\tfunction toggleFormatFields(): void {\n\t\t\tif (!paragraphOptions || !bulletOptions) return;\n\t\t\t\n\t\t\tif (formatSelect.value === 'paragraph') {\n\t\t\t\tparagraphOptions.style.display = 'block';\n\t\t\t\tbulletOptions.style.display = 'none';\n\t\t\t} else {\n\t\t\t\tparagraphOptions.style.display = 'none';\n\t\t\t\tbulletOptions.style.display = 'block';\n\t\t\t}\n\t\t}\n\n\t\t// Initial toggle\n\t\ttoggleFormatFields();\n\n\t\t// Listen for changes\n\t\tformatSelect.addEventListener('change', toggleFormatFields);\n\t}\n\n\t// Initialize auto-generation settings toggle\n\tinitAutoGenSummaryFormatToggle();\n});\n","// nuclen-admin-onboarding.ts\nimport { nuclenFetchWithRetry } from './nuclen-admin-generate';\nimport { displayError } from './utils/displayError';\nimport * as logger from './utils/logger';\n\ndeclare const jQuery: any;\n\n// 1) Declare the global shape of window.nePointerData.\ndeclare global {\n\tinterface Window {\n\t\tnePointerData?: NuclenPointerData;\n\t}\n}\n\n// 2) Describe the structure of the pointer data\nexport interface NuclenPointerData {\n\tpointers: NuclenPointer[];\n\tajaxurl: string;\n\tnonce: string | undefined;\n}\n\n// 3) Each pointer has the properties your PHP code provides\nexport interface NuclenPointer {\n\tid: string;\n\ttarget: string;\n\ttitle: string;\n\tcontent: string;\n\tposition: {\n\t\tedge: 'top' | 'bottom' | 'left' | 'right';\n\t\talign: 'top' | 'bottom' | 'left' | 'right' | 'center';\n\t};\n}\n\n// Wrap our logic in an IIFE\n(function ($: any) {\n\t$(document).ready(() => {\n\t\tconst pointerData = window.nePointerData;\n\n\t\tif (!pointerData || !pointerData.pointers || pointerData.pointers.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet currentIndex = 0;\n\t\tconst pointers = pointerData.pointers;\n\t\tconst ajaxurl = pointerData.ajaxurl;\n\t\tconst nonce = pointerData.nonce;\n\n\t\tasync function dismissPointer(id: string) {\n\t\t\tconst form = new URLSearchParams();\n\t\t\tform.append('action', 'nuclen_dismiss_pointer');\n\t\t\tform.append('pointer', id);\n\t\t\tif (nonce) {\n\t\t\t\tform.append('nonce', nonce);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst result = await nuclenFetchWithRetry(ajaxurl, {\n\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\tcredentials: 'same-origin',\n\t\t\t\t\theaders: { 'Content-Type': 'application/x-www-form-urlencoded' },\n\t\t\t\t\tbody: form.toString(),\n\t\t\t\t});\n\t\t\t\tif (!result.ok) {\n\t\t\t\t\tlogger.error('Failed to dismiss pointer:', result.error);\n\t\t\t\t\tdisplayError('Failed to dismiss pointer.');\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tlogger.error('Error dismissing pointer:', err);\n\t\t\t\tdisplayError('Network error while dismissing pointer.');\n\t\t\t}\n\t\t}\n\n\t\tfunction showNextPointer() {\n\t\t\tif (currentIndex >= pointers.length) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst ptr = pointers[currentIndex];\n\t\t\tconst $target = $(ptr.target);\n\n\t\t\tif (!$target.length) {\n\t\t\t\tcurrentIndex++;\n\t\t\t\tshowNextPointer();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$target.pointer({\n\t\t\t\tcontent: `<h3>${ptr.title}</h3><p>${ptr.content}</p>`,\n\t\t\t\tposition: ptr.position,\n\t\t\t\tclose: async () => {\n\t\t\t\t\tawait dismissPointer(ptr.id);\n\t\t\t\t\tcurrentIndex++;\n\t\t\t\t\tshowNextPointer();\n\t\t\t\t},\n\t\t\t}).pointer('open');\n\t\t}\n\n\t\tshowNextPointer();\n\t});\n})(jQuery);\n","(function(){\n\t// Only register blocks if we're in the block editor\n\tif (!document.body.classList.contains('block-editor-page')) {\n\t\treturn;\n\t}\n\t\n\tinterface WPGlobal {\n\tblocks?: { registerBlockType: (...args: unknown[]) => void };\n\telement?: { createElement: (...args: unknown[]) => unknown };\n\ti18n?: { __: (...args: unknown[]) => string };\n\t}\n\tconst wp = window.wp as WPGlobal;\n\tif (!wp || !wp.blocks || !wp.element || !wp.i18n) {\n\t\treturn;\n\t}\n\tconst { registerBlockType } = wp.blocks;\n\tconst { createElement } = wp.element;\n\tconst { __ } = wp.i18n;\n\tregisterBlockType('nuclear-engagement/quiz', {\n\t\tapiVersion: 2,\n\t\ttitle: __('Quiz', 'nuclear-engagement'),\n\t\ticon: 'editor-help',\n\t\tcategory: 'widgets',\n\t\tedit: () => createElement('p', null, __('Quiz will render on the front-end.', 'nuclear-engagement')),\n\t\tsave: () => null,\n\t});\n\tregisterBlockType('nuclear-engagement/summary', {\n\t\tapiVersion: 2,\n\t\ttitle: __('Summary', 'nuclear-engagement'),\n\t\ticon: 'excerpt-view',\n\t\tcategory: 'widgets',\n\t\tedit: () => createElement('p', null, __('Summary will render on the front-end.', 'nuclear-engagement')),\n\t\tsave: () => null,\n\t});\n\tregisterBlockType('nuclear-engagement/toc', {\n\t\tapiVersion: 2,\n\t\ttitle: __('TOC', 'nuclear-engagement'),\n\t\ticon: 'list-view',\n\t\tcategory: 'widgets',\n\t\tedit: () => createElement('p', null, __('TOC will render on the front-end.', 'nuclear-engagement')),\n\t\tsave: () => null,\n\t});\n})();\n"],"names":["API_CONFIG","nuclenFetchWithRetry","url","options","retries","initialDelayMs","timeoutMs","attempt","delay","lastError","controller","timeoutId","response","status","ok","bodyText","data","error","logger.warn","resolve","logger.error","nuclenFetchUpdates","generationId","formData","result","errorMessage","logger.log","_a","NuclenStartGeneration","dataToSend","rawData","errMsg","NuclenPollAndPullUpdates","intervalMs","onProgress","onComplete","onError","maxAttempts","useExponentialBackoff","maxIntervalMs","useProgressiveIntervals","attemptCount","startTime","currentInterval","consecutiveErrors","streamingClient","getProgressiveInterval","elapsed","accumulatedDuration","stage","schedulePoll","poll","pollResults","processed","total","successCount","failCount","finalReport","results","workflow","err","message","displayError","_context","toast","REST_ENDPOINT","REST_NONCE","nuclenAlertApiError","cleanMsg","tasksUrl","nuclenStoreGenerationResults","payload","resp","populateQuizMetaBox","postResult","finalDate","date","questions","newDate","dateField","q","qIndex","questionSelector","questionInput","ans","aIndex","ansSelector","ansInput","explanationSelector","explanationTextarea","populateSummaryMetaBox","summary","summaryField","activePollingCleanups","initSingleGenerationButtons","event","target","btn","postId","buttonKey","existingCleanup","formatSelect","lengthSelect","itemsSelect","startResp","alertApiError","cleanupPolling","wf","storeGenerationResults","respData","cleanup","initSummaryFormatToggle","paragraphOptions","bulletOptions","toggleFormatFields","initAll","getGeneratePageElements","nuclenShowElement","el","progressBar","rect","scrollTop","targetPosition","nuclenHideElement","nuclenUpdateProgressBarStep","stepEl","state","nuclenCheckCreditsAjax","nuclenToggleSummaryFields","generateTypeEl","summaryFormatRow","summaryParagraphRow","summaryBulletRow","summaryFormatEl","nuclenCollectFilters","postStatusEl","categoryEl","authorEl","postTypeEl","workflowEl","allowRegenEl","protectRegenEl","summaryLengthEl","summaryNumberEl","nuclenAppendFilters","filters","nuclenStoreFilters","selectedWorkflowEl","selectedSummaryFormatEl","selectedSummaryLengthEl","selectedSummaryNumberEl","selectedPostStatusEl","selectedPostTypeEl","requestPostsCount","ajaxUrl","updateCreditsInfo","elements","count","remainingCredits","neededCredits","initStep1","originalButtonText","_b","foundPosts","selectedPostIdsEl","displaySuccess","displayPageMessage","type","messageContainer","heading","messageEl","initStep2","formDataObj","initGoBack","initRestart","initSummaryToggle","initGeneratePage","tabs","contents","tab","e","t","c","targetContent","customThemeSection","themeRadios","nuclenUpdateCustomThemeVisibility","checkedInput","radio","initAutoGenSummaryFormatToggle","$","pointerData","currentIndex","pointers","ajaxurl","nonce","dismissPointer","id","form","showNextPointer","ptr","$target","wp","registerBlockType","createElement","__"],"mappings":"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"}