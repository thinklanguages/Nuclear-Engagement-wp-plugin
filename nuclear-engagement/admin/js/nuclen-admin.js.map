{"version":3,"file":"nuclen-admin.js","sources":["../../../src/shared/constants.ts","../../../src/admin/ts/generation/api.ts","../../../src/admin/ts/generation/polling.ts","../../../src/admin/ts/utils/displayError.ts","../../../src/admin/ts/generation/results.ts","../../../src/admin/ts/single/single-generation-utils.ts","../../../src/admin/ts/single/single-generation-handlers.ts","../../../src/admin/ts/nuclen-admin-single-generation.ts","../../../src/admin/ts/generate/elements.ts","../../../src/admin/ts/generate/generate-page-utils.ts","../../../src/admin/ts/generate/filters.ts","../../../src/admin/ts/generate/step1.ts","../../../src/admin/ts/generate/step2.ts","../../../src/admin/ts/generate/navigation.ts","../../../src/admin/ts/generate/generate-page-handlers.ts","../../../src/admin/ts/nuclen-admin-generate-page.ts","../../../src/admin/ts/nuclen-admin-ui.ts","../../../src/admin/ts/nuclen-admin-onboarding.ts","../../../src/admin/ts/blocks/nuclen-editor-blocks.ts"],"sourcesContent":["// API Configuration\r\nexport const API_CONFIG = {\r\n\tRETRY_COUNT: 3,\r\n\tINITIAL_DELAY_MS: 500,\r\n\tPOLLING_INTERVAL_MS: 5000,\r\n\tMAX_BACKOFF_MS: 30000,\r\n} as const;\r\n\r\n// Action Names\r\nexport const ACTIONS = {\r\n\tTRIGGER_GENERATION: 'nuclen_trigger_generation',\r\n\tGET_POSTS_COUNT: 'nuclen_get_posts_count',\r\n\tUPDATE_POINTER: 'nuclen_update_pointer',\r\n\tEXPORT_OPTIN: 'nuclen_export_optin',\r\n} as const;\r\n\r\n// CSS Class Names\r\nexport const CSS_CLASSES = {\r\n\tADMIN: {\r\n\t\tCONTAINER: 'nuclen-admin-container',\r\n\t\tLOADING: 'nuclen-loading',\r\n\t\tERROR: 'nuclen-error',\r\n\t\tSUCCESS: 'nuclen-success',\r\n\t},\r\n\tQUIZ: {\r\n\t\tCONTAINER: 'nuclen-quiz-container',\r\n\t\tQUESTION: 'nuclen-quiz-question',\r\n\t\tANSWER: 'nuclen-quiz-answer',\r\n\t\tPROGRESS: 'nuclen-quiz-progress',\r\n\t},\r\n\tTOC: {\r\n\t\tCONTAINER: 'nuclen-toc-container',\r\n\t\tSTICKY: 'nuclen-toc-sticky',\r\n\t\tACTIVE: 'nuclen-toc-active',\r\n\t},\r\n} as const;\r\n\r\n// Scroll Configuration\r\nexport const SCROLL_CONFIG = {\r\n\tTOC_ROOT_MARGIN: '0px 0px -60%',\r\n\tSMOOTH_SCROLL_DURATION: 300,\r\n} as const;\r\n\r\n// Local Storage Keys\r\nexport const STORAGE_KEYS = {\r\n\tQUIZ_PROGRESS: 'nuclen_quiz_progress',\r\n\tUSER_PREFERENCES: 'nuclen_user_prefs',\r\n} as const;","import * as logger from '../utils/logger';\r\nimport { API_CONFIG } from '../../../shared/constants';\r\n\r\nexport interface NuclenFetchResult<T> {\r\n\tok: boolean;\r\n\tstatus: number;\r\n\tdata: T | null;\r\n\terror?: string;\r\n}\r\n\r\nexport async function nuclenFetchWithRetry<T = unknown>(\r\n\turl: string,\r\n\toptions: RequestInit,\r\n\tretries = API_CONFIG.RETRY_COUNT,\r\n\tinitialDelayMs = API_CONFIG.INITIAL_DELAY_MS\r\n): Promise<NuclenFetchResult<T>> {\r\n\tlet attempt = 0;\r\n\tlet delay = initialDelayMs;\r\n\tlet lastError: Error | undefined;\r\n\r\n\twhile (attempt <= retries) {\r\n\t\ttry {\r\n\t\t\tconst response = await fetch(url, options);\r\n\t\t\tconst { status, ok } = response;\r\n\t\t\tconst bodyText = await response.text().catch(() => '');\r\n\t\t\tlet data: T | null = null;\r\n\t\t\tif (bodyText) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tdata = JSON.parse(bodyText) as T;\r\n\t\t\t\t} catch {\r\n\t\t\t\t\t// body is not JSON\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (ok) {\r\n\t\t\t\tconst success: NuclenFetchResult<T> = {\r\n\t\t\t\t\tok: true,\r\n\t\t\t\t\tstatus: status,\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t};\r\n\t\t\t\treturn success;\r\n\t\t\t}\r\n\r\n\t\t\tconst fail: NuclenFetchResult<T> = {\r\n\t\t\t\tok: false,\r\n\t\t\t\tstatus: status,\r\n\t\t\t\tdata: data,\r\n\t\t\t\terror: bodyText,\r\n\t\t\t};\r\n\t\t\treturn fail;\r\n\t\t} catch (error: unknown) {\r\n\t\t\tlastError = error as Error;\r\n\t\t\tif (attempt === retries) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tlogger.warn(\r\n\t\t\t\t`Retrying request to ${url} with method ${options.method || 'GET'} (${retries - attempt} attempts left). Error: ${lastError.message}`,\r\n\t\t\t\tlastError\r\n\t\t\t);\r\n\t\t\tawait new Promise((resolve) => setTimeout(resolve, delay));\r\n\t\t\tdelay *= 2;\r\n\t\t}\r\n\t\tattempt += 1;\r\n\t}\r\n\r\n\tlogger.error(\r\n\t\t`Max retries reached for ${url} with method ${options.method || 'GET'}:`,\r\n\t\tlastError\r\n\t);\r\n\tthrow lastError;\r\n}\r\n\r\nexport interface PollingUpdateData {\r\n\tprocessed: number;\r\n\ttotal: number;\r\n\tsuccessCount?: number;\r\n\tfailCount?: number;\r\n\tfinalReport?: { message?: string };\r\n\tresults?: Record<string, unknown>;\r\n\tworkflow: string;\r\n}\r\n\r\nexport interface PollingUpdateResponse {\r\n\tsuccess: boolean;\r\n\tmessage?: string;\r\n\tdata: PollingUpdateData;\r\n}\r\n\r\nexport interface StartGenerationResponse {\r\n\tsuccess: boolean;\r\n\tmessage?: string;\r\n\tgeneration_id?: string;\r\n\tdata?: {\r\n\tgeneration_id?: string;\r\n\t[key: string]: unknown;\r\n\t};\r\n}\r\n\r\nexport async function nuclenFetchUpdates(\r\n\tgenerationId?: string\r\n): Promise<PollingUpdateResponse> {\r\n\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url || !window.nuclenAjax.fetch_action) {\r\n\t\tthrow new Error('Missing nuclenAjax configuration (ajax_url or fetch_action).');\r\n\t}\r\n\r\n\tconst formData = new FormData();\r\n\tformData.append('action', window.nuclenAjax.fetch_action);\r\n\r\n\tif (window.nuclenAjax.nonce) {\r\n\t\tformData.append('security', window.nuclenAjax.nonce);\r\n\t}\r\n\r\n\tif (generationId) {\r\n\t\tformData.append('generation_id', generationId);\r\n\t}\r\n\r\n\tconst result = await nuclenFetchWithRetry<PollingUpdateResponse>(\r\n\t\twindow.nuclenAjax.ajax_url,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tbody: formData,\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t}\r\n\t);\r\n\r\n\tif (!result.ok) {\r\n\t\tthrow new Error(result.error || `HTTP ${result.status}`);\r\n\t}\r\n\r\n\treturn result.data as PollingUpdateResponse;\r\n}\r\n\r\nexport async function NuclenStartGeneration(\r\n\tdataToSend: Record<string, unknown>\r\n): Promise<StartGenerationResponse> {\r\n\tif (!window.nuclenAdminVars || !window.nuclenAdminVars.ajax_url) {\r\n\t\tthrow new Error('Missing WP Ajax config (nuclenAdminVars.ajax_url).');\r\n\t}\r\n\r\n\tconst formData = new FormData();\r\n\tformData.append('action', 'nuclen_trigger_generation');\r\n\tformData.append('payload', JSON.stringify(dataToSend));\r\n\tif (!window.nuclenAjax?.nonce) {\r\n\t\tthrow new Error('Missing security nonce.');\r\n\t}\r\n\tformData.append('security', window.nuclenAjax.nonce);\r\n\r\n\tconst result = await nuclenFetchWithRetry<StartGenerationResponse>(\r\n\t\twindow.nuclenAdminVars.ajax_url,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tbody: formData,\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t}\r\n\t);\r\n\r\n\tif (!result.ok) {\r\n\t\tthrow new Error(result.error || `HTTP ${result.status}`);\r\n\t}\r\n\r\n\t// Validate response structure before casting\r\n\tconst rawData = result.data;\r\n\tif (!rawData || typeof rawData !== 'object') {\r\n\t\tthrow new Error('Invalid response format: expected object');\r\n\t}\r\n\t\r\n\tconst data = rawData as StartGenerationResponse;\r\n\t\r\n\t// Runtime validation of required properties\r\n\tif (typeof data.success !== 'boolean') {\r\n\t\tthrow new Error('Invalid response format: missing or invalid success field');\r\n\t}\r\n\t\r\n\tif (!data.success) {\r\n\t\tlet errMsg = 'Generation start failed (unknown error).';\r\n\t\t\r\n\t\tif (typeof data.message === 'string' && data.message) {\r\n\t\t\terrMsg = data.message;\r\n\t\t} else if (data.data && typeof data.data === 'object' && \r\n\t\t\t\t   typeof (data.data as any).message === 'string') {\r\n\t\t\terrMsg = (data.data as any).message;\r\n\t\t}\r\n\t\t\r\n\t\tthrow new Error(errMsg);\r\n\t}\r\n\r\n\treturn data;\r\n}\r\n","import { nuclenFetchUpdates } from './api';\r\nimport type { PollingUpdateData, PollingUpdateResponse } from './api';\r\nimport { API_CONFIG } from '../../../shared/constants';\r\n\r\nexport function NuclenPollAndPullUpdates({\r\n\tintervalMs = API_CONFIG.POLLING_INTERVAL_MS,\r\n\tgenerationId,\r\n\tonProgress = (() => {}) as (processed: number, total: number) => void,\r\n\tonComplete = () => {},\r\n\tonError = () => {},\r\n\tmaxAttempts = 120, // Maximum polling attempts (default: 10 minutes at 5s intervals)\r\n\ttimeoutMs = 600000, // Maximum total timeout (10 minutes)\r\n}: {\r\n\tintervalMs?: number;\r\n\tgenerationId: string;\r\n\tonProgress?: (processed: number, total: number) => void;\r\n\tonComplete?: (finalData: PollingUpdateData) => void;\r\n\tonError?: (errMsg: string) => void;\r\n\tmaxAttempts?: number;\r\n\ttimeoutMs?: number;\r\n}) {\r\n\tlet attemptCount = 0;\r\n\tconst startTime = Date.now();\r\n\t\r\n\tconst pollInterval = setInterval(async () => {\r\n\t\tattemptCount++;\r\n\t\tconst elapsed = Date.now() - startTime;\r\n\t\t\r\n\t\t// Check for timeout conditions\r\n\t\tif (attemptCount > maxAttempts) {\r\n\t\t\tclearInterval(pollInterval);\r\n\t\t\tonError(`Polling timeout: Exceeded maximum attempts (${maxAttempts})`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (elapsed > timeoutMs) {\r\n\t\t\tclearInterval(pollInterval);\r\n\t\t\tonError(`Polling timeout: Exceeded maximum time (${timeoutMs}ms)`);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\ttry {\r\n\t\t\tconst pollResults: PollingUpdateResponse = await nuclenFetchUpdates(generationId);\r\n\t\t\tif (!pollResults.success) {\r\n\t\t\t\tconst errMsg = pollResults.message || 'Polling error';\r\n\t\t\t\tthrow new Error(errMsg);\r\n\t\t\t}\r\n\r\n\t\t\tconst {\r\n\t\t\t\tprocessed,\r\n\t\t\t\ttotal,\r\n\t\t\t\tsuccessCount = processed,\r\n\t\t\t\tfailCount,\r\n\t\t\t\tfinalReport,\r\n\t\t\t\tresults,\r\n\t\t\t\tworkflow,\r\n\t\t\t} = pollResults.data;\r\n\r\n\t\t\tonProgress(processed, total);\r\n\r\n\t\t\tif (processed >= total) {\r\n\t\t\t\tclearInterval(pollInterval);\r\n\t\t\t\tonComplete({\r\n\t\t\t\t\tprocessed,\r\n\t\t\t\t\ttotal,\r\n\t\t\t\t\tsuccessCount,\r\n\t\t\t\t\tfailCount,\r\n\t\t\t\t\tfinalReport,\r\n\t\t\t\t\tresults,\r\n\t\t\t\t\tworkflow,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t} catch (err: unknown) {\r\n\t\t\tclearInterval(pollInterval);\r\n\t\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\r\n\t\t\tonError(`Polling failed after ${attemptCount} attempts: ${message}`);\r\n\t\t}\r\n\t}, intervalMs);\r\n\r\n\t// Return a cleanup function to allow manual cancellation\r\n\treturn () => {\r\n\t\tclearInterval(pollInterval);\r\n\t};\r\n}\r\n","import { error } from '../../../shared/logger';\r\n\r\nexport function displayError(message: string): void {\r\n\tconst toast = document.createElement('div');\r\n\ttoast.className = 'nuclen-error-toast';\r\n\ttoast.textContent = message;\r\n\tdocument.body.appendChild(toast);\r\n\tsetTimeout(() => toast.remove(), 5000);\r\n\terror(message);\r\n}\r\n","export const REST_ENDPOINT =\r\n\twindow.nuclenAdminVars?.rest_receive_content ||\r\n\t'/wp-json/nuclear-engagement/v1/receive-content';\r\n\r\nexport const REST_NONCE = window.nuclenAdminVars?.rest_nonce || '';\r\nimport { displayError } from '../utils/displayError';\r\nimport * as logger from '../utils/logger';\r\n\r\nexport function nuclenAlertApiError(errMsg: string): void {\r\n\tconst cleanMsg = errMsg.replace(/<[^>]+>/g, '');\r\n\tif (cleanMsg.includes('Invalid API key')) {\r\n\t\tdisplayError('Your API key is invalid. Please go to the Setup page and enter a new one.');\r\n\t} else if (cleanMsg.includes('Invalid WP App Password')) {\r\n\t\tdisplayError('Your WP App Password is invalid. Please re-generate it on the Setup page.');\r\n\t} else if (cleanMsg.includes('Not enough credits')) {\r\n\t\tdisplayError('Not enough credits. Please top up your account or reduce the number of posts.');\r\n\t} else {\r\n\t\tdisplayError(`Error: ${cleanMsg}`);\r\n\t}\r\n}\r\n\r\nexport async function nuclenStoreGenerationResults(workflow: string, results: unknown) {\r\n\tconst payload = { workflow, results };\r\n\tlet resp: Response;\r\n\ttry {\r\n\t\tresp = await fetch(REST_ENDPOINT, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\t'X-WP-Nonce': REST_NONCE,\r\n\t\t\t},\r\n\t\t\tcredentials: 'include',\r\n\t\t\tbody: JSON.stringify(payload),\r\n\t\t});\r\n\t} catch (err) {\r\n\t\tlogger.error('Fetch failed in nuclenStoreGenerationResults:', err);\r\n\t\tdisplayError('Network error');\r\n\t\treturn { ok: false, data: { message: 'Network error' } };\r\n\t}\r\n\tlet data: unknown = null;\r\n\tif (resp.ok) {\r\n\t\ttry {\r\n\t\t\tdata = await resp.json();\r\n\t\t} catch {\r\n\t\t\treturn { ok: false, data: { message: 'Invalid JSON' } };\r\n\t\t}\r\n\t}\r\n\treturn { ok: resp.ok, data };\r\n}\r\n","export {\r\n\tnuclenAlertApiError as alertApiError,\r\n\tnuclenStoreGenerationResults as storeGenerationResults,\r\n} from '../generation/results';\r\n\r\nexport interface PostResult {\r\n\tdate?: string;\r\n\tsummary?: string;\r\n\tquestions?: Array<{\r\n\tquestion?: string;\r\n\tanswers?: string[];\r\n\texplanation?: string;\r\n\t}>;\r\n\t[key: string]: unknown;\r\n}\r\n\r\nexport function populateQuizMetaBox(\r\n\tpostResult: PostResult,\r\n\tfinalDate?: string\r\n): void {\r\n\tconst { date, questions } = postResult;\r\n\tconst newDate = finalDate || date;\r\n\tconst dateField = document.querySelector<HTMLInputElement>('input[name=\"nuclen_quiz_data[date]\"]');\r\n\tif (dateField) {\r\n\t\tdateField.readOnly = false;\r\n\t\tdateField.value = newDate || '';\r\n\t\tdateField.readOnly = true;\r\n\t}\r\n\r\n\tif (Array.isArray(questions)) {\r\n\t\tquestions.forEach((q, qIndex) => {\r\n\t\t\tconst questionSelector = `input[name=\"nuclen_quiz_data[questions][${qIndex}][question]\"]`;\r\n\t\t\tconst questionInput = document.querySelector<HTMLInputElement>(questionSelector);\r\n\t\t\tif (questionInput) {\r\n\t\t\t\tquestionInput.value = q.question || '';\r\n\t\t\t}\r\n\r\n\t\t\tif (Array.isArray(q.answers)) {\r\n\t\t\t\tq.answers.forEach((ans: string, aIndex: number) => {\r\n\t\t\t\t\tconst ansSelector = `input[name=\"nuclen_quiz_data[questions][${qIndex}][answers][${aIndex}]\"]`;\r\n\t\t\t\t\tconst ansInput = document.querySelector<HTMLInputElement>(ansSelector);\r\n\t\t\t\t\tif (ansInput) {\r\n\t\t\t\t\t\tansInput.value = ans;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst explanationSelector = `textarea[name=\"nuclen_quiz_data[questions][${qIndex}][explanation]\"]`;\r\n\t\t\tconst explanationTextarea = document.querySelector<HTMLTextAreaElement>(explanationSelector);\r\n\t\t\tif (explanationTextarea) {\r\n\t\t\t\texplanationTextarea.value = q.explanation || '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport function populateSummaryMetaBox(\r\n\tpostResult: PostResult,\r\n\tfinalDate?: string\r\n): void {\r\n\tconst { date, summary } = postResult;\r\n\tconst newDate = finalDate || date;\r\n\tconst dateField = document.querySelector<HTMLInputElement>('input[name=\"nuclen_summary_data[date]\"]');\r\n\tif (dateField) {\r\n\t\tdateField.readOnly = false;\r\n\t\tdateField.value = newDate || '';\r\n\t\tdateField.readOnly = true;\r\n\t}\r\n\r\n\tif (typeof window.tinymce !== 'undefined') {\r\n\t\tconst tiny = window.tinymce as {\r\n\t\tget?: (id: string) => {\r\n\t\tsetContent?: (html: string) => void;\r\n\t\tsave?: () => void;\r\n\t\t};\r\n\t};\r\n\t\tlet editor: { setContent?: (html: string) => void; save?: () => void } | undefined;\r\n\t\tif (typeof tiny.get === 'function') {\r\n\t\t\teditor = tiny.get('nuclen_summary_data_summary');\r\n\t\t}\r\n\t\tif (editor && typeof editor.setContent === 'function') {\r\n\t\t\teditor.setContent(summary || '');\r\n\t\t\teditor.save?.();\r\n\t\t} else {\r\n\t\t\tconst summaryField = document.querySelector<HTMLTextAreaElement>('textarea[name=\"nuclen_summary_data[summary]\"]');\r\n\t\t\tif (summaryField) {\r\n\t\t\t\tsummaryField.value = summary || '';\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tconst summaryField = document.querySelector<HTMLTextAreaElement>('textarea[name=\"nuclen_summary_data[summary]\"]');\r\n\t\tif (summaryField) {\r\n\t\t\tsummaryField.value = summary || '';\r\n\t\t}\r\n\t}\r\n}\r\n\r\n","import {\r\n\talertApiError,\r\n\tpopulateQuizMetaBox,\r\n\tpopulateSummaryMetaBox,\r\n\tstoreGenerationResults,\r\n\ttype PostResult,\r\n} from './single-generation-utils';\r\nimport {\r\n\tNuclenStartGeneration,\r\n\tNuclenPollAndPullUpdates,\r\n} from '../nuclen-admin-generate';\r\nimport type { StartGenerationResponse, PollingUpdateData } from '../generation/api';\r\nimport { displayError } from '../utils/displayError';\r\nimport * as logger from '../utils/logger';\r\n\r\nexport function initSingleGenerationButtons(): void {\r\n\t// Use passive listener for better scroll performance\r\n\tdocument.addEventListener('click', async (event: MouseEvent) => {\r\n\t\tconst target = event.target;\r\n\t\tif (!(target instanceof HTMLElement)) return;\r\n\t\tif (!target.classList.contains('nuclen-generate-single')) return;\r\n\r\n\t\tconst btn = target as HTMLButtonElement;\r\n\t\tconst postId = btn.dataset.postId;\r\n\t\tconst workflow = btn.dataset.workflow;\r\n\t\tif (!postId || !workflow) {\r\n\t\t\tdisplayError('Missing data attributes: postId or workflow not found.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tbtn.disabled = true;\r\n\t\tbtn.textContent = 'Generating...';\r\n\r\n\t\ttry {\r\n\t\t\tconst startResp: StartGenerationResponse | {\r\n\t\tok: boolean;\r\n\t\tstatus: number;\r\n\t\terror?: string;\r\n\t\tdata?: { generation_id?: string; [key: string]: unknown };\r\n\t\tgeneration_id?: string;\r\n\t\t} = await NuclenStartGeneration({\r\n\t\t\tnuclen_selected_post_ids: JSON.stringify([postId]),\r\n\t\t\tnuclen_selected_generate_workflow: workflow,\r\n\t\t});\r\n\r\n\t\t\tif ('ok' in startResp && !startResp.ok) {\r\n\t\t\t\talertApiError((startResp as { error?: string }).error || 'Generation failed');\r\n\t\t\t\tbtn.textContent = 'Generate';\r\n\t\t\t\tbtn.disabled = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst generationId =\r\n\t\tstartResp.data?.generation_id ||\r\n\t\tstartResp.generation_id ||\r\n\t\t'gen_' + Math.random().toString(36).substring(2);\r\n\r\n\t\t\tNuclenPollAndPullUpdates({\r\n\t\t\t\tintervalMs: 5000,\r\n\t\t\t\tgenerationId,\r\n\t\t\t\tonProgress() {\r\n\t\t\t\t\tbtn.textContent = 'Generating...';\r\n\t\t\t\t},\r\n\t\t\t\tasync onComplete({ results, workflow: wf }: PollingUpdateData) {\r\n\t\t\t\t\tif (results && typeof results === 'object') {\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tconst { ok, data } = await storeGenerationResults(wf, results);\r\n\t\t\t\t\t\t\tconst respData = data as Record<string, unknown>;\r\n\t\t\t\t\t\t\tif (ok && !('code' in respData)) {\r\n\t\t\t\t\t\t\t\tconst postResult = results[postId] as PostResult;\r\n\t\t\t\t\t\t\t\tconst finalDate = respData.finalDate && typeof respData.finalDate === 'string' ? (respData.finalDate as string) : undefined;\r\n\t\t\t\t\t\t\t\tif (postResult) {\r\n\t\t\t\t\t\t\t\t\tif (wf === 'quiz') {\r\n\t\t\t\t\t\t\t\t\t\tpopulateQuizMetaBox(postResult, finalDate);\r\n\t\t\t\t\t\t\t\t\t} else if (wf === 'summary') {\r\n\t\t\t\t\t\t\t\t\t\tpopulateSummaryMetaBox(postResult, finalDate);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbtn.textContent = 'Stored!';\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tlogger.error('Error storing single-generation results in WP:', respData);\r\n\t\t\t\t\t\t\t\tbtn.textContent = 'Generation failed!';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\tlogger.error('Fetch error calling /receive-content endpoint:', err);\r\n\t\t\t\t\t\t\tbtn.textContent = 'Generation failed!';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbtn.textContent = 'Done (no data)!';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbtn.disabled = false;\r\n\t\t\t\t},\r\n\t\t\t\tonError(errMsg) {\r\n\t\t\t\t\talertApiError(errMsg);\r\n\t\t\t\t\tbtn.textContent = 'Generate';\r\n\t\t\t\t\tbtn.disabled = false;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} catch (err: unknown) {\r\n\t\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\r\n\t\t\talertApiError(message);\r\n\t\t\tbtn.textContent = 'Generate';\r\n\t\t\tbtn.disabled = false;\r\n\t\t}\r\n\t});\r\n}\r\n","import { initSingleGenerationButtons } from './single/single-generation-handlers';\r\n\r\ninitSingleGenerationButtons();\r\n","export interface GeneratePageElements {\r\n\tstep1: HTMLDivElement | null;\r\n\tstep2: HTMLDivElement | null;\r\n\tupdatesSection: HTMLDivElement | null;\r\n\tupdatesContent: HTMLDivElement | null;\r\n\trestartBtn: HTMLButtonElement | null;\r\n\tgetPostsBtn: HTMLButtonElement | null;\r\n\tgoBackBtn: HTMLButtonElement | null;\r\n\tgenerateForm: HTMLFormElement | null;\r\n\tsubmitBtn: HTMLButtonElement | null;\r\n\tpostsCountEl: HTMLSpanElement | null;\r\n\tstepBar1: HTMLElement | null;\r\n\tstepBar2: HTMLElement | null;\r\n\tstepBar3: HTMLElement | null;\r\n\tstepBar4: HTMLElement | null;\r\n\tcreditsInfoEl: HTMLParagraphElement | null;\r\n}\r\n\r\nexport function getGeneratePageElements(): GeneratePageElements {\r\n\treturn {\r\n\t\tstep1: document.getElementById('nuclen-step-1') as HTMLDivElement | null,\r\n\t\tstep2: document.getElementById('nuclen-step-2') as HTMLDivElement | null,\r\n\t\tupdatesSection: document.getElementById('nuclen-updates-section') as HTMLDivElement | null,\r\n\t\tupdatesContent: document.getElementById('nuclen-updates-content') as HTMLDivElement | null,\r\n\t\trestartBtn: document.getElementById('nuclen-restart-btn') as HTMLButtonElement | null,\r\n\t\tgetPostsBtn: document.getElementById('nuclen-get-posts-btn') as HTMLButtonElement | null,\r\n\t\tgoBackBtn: document.getElementById('nuclen-go-back-btn') as HTMLButtonElement | null,\r\n\t\tgenerateForm: document.getElementById('nuclen-generate-form') as HTMLFormElement | null,\r\n\t\tsubmitBtn: document.getElementById('nuclen-submit-btn') as HTMLButtonElement | null,\r\n\t\tpostsCountEl: document.getElementById('nuclen-posts-count') as HTMLSpanElement | null,\r\n\t\tstepBar1: document.getElementById('nuclen-step-bar-1'),\r\n\t\tstepBar2: document.getElementById('nuclen-step-bar-2'),\r\n\t\tstepBar3: document.getElementById('nuclen-step-bar-3'),\r\n\t\tstepBar4: document.getElementById('nuclen-step-bar-4'),\r\n\t\tcreditsInfoEl: document.getElementById('nuclen-credits-info') as HTMLParagraphElement | null,\r\n\t};\r\n}\r\n","export function nuclenShowElement(el: HTMLElement | null): void {\r\n\tif (!el) return;\r\n\tel.classList.remove('nuclen-hidden');\r\n}\r\n\r\nexport function nuclenHideElement(el: HTMLElement | null): void {\r\n\tif (!el) return;\r\n\tel.classList.add('nuclen-hidden');\r\n}\r\n\r\nexport function nuclenUpdateProgressBarStep(stepEl: HTMLElement | null, state: string): void {\r\n\tif (!stepEl) return;\r\n\tstepEl.classList.remove(\r\n\t\t'ne-step-bar__step--todo',\r\n\t\t'ne-step-bar__step--current',\r\n\t\t'ne-step-bar__step--done',\r\n\t\t'ne-step-bar__step--failed'\r\n\t);\r\n\tstepEl.classList.add(`ne-step-bar__step--${state}`);\r\n}\r\n\r\n/**\r\n * Fetch remaining credits from the SaaS.\r\n */\r\ninterface CreditsResponse {\r\n\tsuccess: boolean;\r\n\tmessage?: string;\r\n\tdata: {\r\n\tremaining_credits?: number;\r\n\tmessage?: string;\r\n\t[key: string]: unknown;\r\n\t};\r\n}\r\n\r\nexport async function nuclenCheckCreditsAjax(): Promise<number> {\r\n\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url) {\r\n\t\tthrow new Error('Missing nuclenAjax configuration (ajax_url).');\r\n\t}\r\n\tif (!window.nuclenAjax.fetch_action) {\r\n\t\tthrow new Error('Missing fetch_action in nuclenAjax configuration.');\r\n\t}\r\n\tconst formData = new FormData();\r\n\tformData.append('action', window.nuclenAjax.fetch_action);\r\n\tif (window.nuclenAjax.nonce) {\r\n\t\tformData.append('security', window.nuclenAjax.nonce);\r\n\t}\r\n\tconst result = await nuclenFetchWithRetry<CreditsResponse>(\r\n\t\twindow.nuclenAjax.ajax_url,\r\n\t\t{\r\n\t\t\tmethod: 'POST',\r\n\t\t\tbody: formData,\r\n\t\t\tcredentials: 'same-origin',\r\n\t\t}\r\n\t);\r\n\tif (!result.ok) {\r\n\t\tthrow new Error(result.error || `HTTP ${result.status}`);\r\n\t}\r\n\tconst data = result.data as CreditsResponse;\r\n\tif (!data.success) {\r\n\t\tthrow new Error(data.message || data.data?.message || 'Failed to fetch credits from SaaS');\r\n\t}\r\n\tif (typeof data.data.remaining_credits === 'number') {\r\n\t\treturn data.data.remaining_credits;\r\n\t}\r\n\tthrow new Error(\"No 'remaining_credits' in response\");\r\n}\r\n\r\n/**\r\n * Toggle summary settings visibility.\r\n */\r\nexport function nuclenToggleSummaryFields(): void {\r\n\tconst generateTypeEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\r\n\tconst summarySettingsEl = document.getElementById('nuclen-summary-settings') as HTMLDivElement | null;\r\n\tconst summaryParagraphOptions = document.getElementById('nuclen-summary-paragraph-options') as HTMLDivElement | null;\r\n\tconst summaryBulletOptions = document.getElementById('nuclen-summary-bullet-options') as HTMLDivElement | null;\r\n\tconst summaryFormatEl = document.getElementById('nuclen_summary_format') as HTMLSelectElement | null;\r\n\r\n\tif (!generateTypeEl || !summarySettingsEl || !summaryParagraphOptions || !summaryBulletOptions || !summaryFormatEl) {\r\n\t\treturn;\r\n\t}\r\n\tif (generateTypeEl.value === 'summary') {\r\n\t\tsummarySettingsEl.classList.remove('nuclen-hidden');\r\n\t\tif (summaryFormatEl.value === 'paragraph') {\r\n\t\t\tsummaryParagraphOptions.classList.remove('nuclen-hidden');\r\n\t\t\tsummaryBulletOptions.classList.add('nuclen-hidden');\r\n\t\t} else {\r\n\t\t\tsummaryParagraphOptions.classList.add('nuclen-hidden');\r\n\t\t\tsummaryBulletOptions.classList.remove('nuclen-hidden');\r\n\t\t}\r\n\t} else {\r\n\t\tsummarySettingsEl.classList.add('nuclen-hidden');\r\n\t\tsummaryParagraphOptions.classList.add('nuclen-hidden');\r\n\t\tsummaryBulletOptions.classList.add('nuclen-hidden');\r\n\t}\r\n}\r\n\r\nimport { nuclenFetchWithRetry } from '../nuclen-admin-generate';\r\n","export interface NuclenFilterValues {\r\n\tpostStatus: string;\r\n\tcategory: string;\r\n\tauthor: string;\r\n\tpostType: string;\r\n\tworkflow: string;\r\n\tallowRegenerate: boolean;\r\n\tregenerateProtected: boolean;\r\n\tsummaryFormat: string;\r\n\tsummaryLength: string;\r\n\tsummaryNumberOfItems: string;\r\n}\r\n\r\nexport function nuclenCollectFilters(): NuclenFilterValues {\r\n\tconst postStatusEl = document.getElementById('nuclen_post_status') as HTMLSelectElement | null;\r\n\tconst categoryEl = document.getElementById('nuclen_category') as HTMLSelectElement | null;\r\n\tconst authorEl = document.getElementById('nuclen_author') as HTMLSelectElement | null;\r\n\tconst postTypeEl = document.getElementById('nuclen_post_type') as HTMLSelectElement | null;\r\n\tconst workflowEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\r\n\tconst allowRegenEl = document.getElementById('nuclen_allow_regenerate_data') as HTMLInputElement | null;\r\n\tconst protectRegenEl = document.getElementById('nuclen_regenerate_protected_data') as HTMLInputElement | null;\r\n\tconst summaryFormatEl = document.getElementById('nuclen_summary_format') as HTMLSelectElement | null;\r\n\tconst summaryLengthEl = document.getElementById('nuclen_summary_length') as HTMLSelectElement | null;\r\n\tconst summaryNumberEl = document.getElementById('nuclen_summary_number_of_items') as HTMLSelectElement | null;\r\n\treturn {\r\n\t\tpostStatus: postStatusEl ? postStatusEl.value : '',\r\n\t\tcategory: categoryEl ? categoryEl.value : '',\r\n\t\tauthor: authorEl ? authorEl.value : '',\r\n\t\tpostType: postTypeEl ? postTypeEl.value : '',\r\n\t\tworkflow: workflowEl ? workflowEl.value : '',\r\n\t\tallowRegenerate: !!allowRegenEl && allowRegenEl.checked,\r\n\t\tregenerateProtected: !!protectRegenEl && protectRegenEl.checked,\r\n\t\tsummaryFormat: summaryFormatEl ? summaryFormatEl.value : '',\r\n\t\tsummaryLength: summaryLengthEl ? summaryLengthEl.value : '',\r\n\t\tsummaryNumberOfItems: summaryNumberEl ? summaryNumberEl.value : '',\r\n\t};\r\n}\r\n\r\nexport function nuclenAppendFilters(formData: FormData, filters: NuclenFilterValues): void {\r\n\tformData.append('nuclen_post_status', filters.postStatus);\r\n\tformData.append('nuclen_category', filters.category);\r\n\tformData.append('nuclen_author', filters.author);\r\n\tformData.append('nuclen_post_type', filters.postType);\r\n\tformData.append('nuclen_generate_workflow', filters.workflow);\r\n\tformData.append('nuclen_allow_regenerate_data', filters.allowRegenerate ? '1' : '0');\r\n\tformData.append('nuclen_regenerate_protected_data', filters.regenerateProtected ? '1' : '0');\r\n\tformData.append('nuclen_summary_format', filters.summaryFormat);\r\n\tformData.append('nuclen_summary_length', filters.summaryLength);\r\n\tformData.append('nuclen_summary_number_of_items', filters.summaryNumberOfItems);\r\n}\r\n\r\nexport function nuclenStoreFilters(filters: NuclenFilterValues): void {\r\n\tconst selectedWorkflowEl = document.getElementById('nuclen_selected_generate_workflow') as HTMLInputElement | null;\r\n\tconst selectedSummaryFormatEl = document.getElementById('nuclen_selected_summary_format') as HTMLInputElement | null;\r\n\tconst selectedSummaryLengthEl = document.getElementById('nuclen_selected_summary_length') as HTMLInputElement | null;\r\n\tconst selectedSummaryNumberEl = document.getElementById('nuclen_selected_summary_number_of_items') as HTMLInputElement | null;\r\n\tconst selectedPostStatusEl = document.getElementById('nuclen_selected_post_status') as HTMLInputElement | null;\r\n\tconst selectedPostTypeEl = document.getElementById('nuclen_selected_post_type') as HTMLInputElement | null;\r\n\r\n\tif (selectedWorkflowEl) {\r\n\t\tselectedWorkflowEl.value = filters.workflow;\r\n\t}\r\n\tif (selectedSummaryFormatEl) {\r\n\t\tselectedSummaryFormatEl.value = filters.summaryFormat;\r\n\t}\r\n\tif (selectedSummaryLengthEl) {\r\n\t\tselectedSummaryLengthEl.value = filters.summaryLength;\r\n\t}\r\n\tif (selectedSummaryNumberEl) {\r\n\t\tselectedSummaryNumberEl.value = filters.summaryNumberOfItems;\r\n\t}\r\n\tif (selectedPostStatusEl) {\r\n\t\tselectedPostStatusEl.value = filters.postStatus;\r\n\t}\r\n\tif (selectedPostTypeEl) {\r\n\t\tselectedPostTypeEl.value = filters.postType;\r\n\t}\r\n}\r\n\r\n","import { nuclenFetchWithRetry } from '../nuclen-admin-generate';\r\nimport {\r\n\tnuclenShowElement,\r\n\tnuclenHideElement,\r\n\tnuclenUpdateProgressBarStep,\r\n\tnuclenCheckCreditsAjax,\r\n} from './generate-page-utils';\r\nimport type { GeneratePageElements } from './elements';\r\nimport {\r\n\tnuclenCollectFilters,\r\n\tnuclenAppendFilters,\r\n\tnuclenStoreFilters,\r\n\ttype NuclenFilterValues,\r\n} from './filters';\r\nimport { displayError } from '../utils/displayError';\r\nimport * as logger from '../utils/logger';\r\n\r\ninterface PostsCountResponse {\r\n        success: boolean;\r\n        message?: string;\r\n        data: {\r\n        count: number;\r\n\tpost_ids: string[];\r\n\tmessage?: string;\r\n\t[key: string]: unknown;\r\n        };\r\n}\r\n\r\nasync function requestPostsCount(\r\n\tajaxUrl: string,\r\n\tfilters: NuclenFilterValues,\r\n): Promise<PostsCountResponse | null> {\r\n\tconst formData = new FormData();\r\n\tformData.append('action', 'nuclen_get_posts_count');\r\n\tif (window.nuclenAjax?.nonce) {\r\n\t\tformData.append('security', window.nuclenAjax.nonce);\r\n\t}\r\n\tnuclenAppendFilters(formData, filters);\r\n\tconst result = await nuclenFetchWithRetry<PostsCountResponse>(ajaxUrl, {\r\n\t\tmethod: 'POST',\r\n\t\tbody: formData,\r\n\t\tcredentials: 'same-origin',\r\n\t});\r\n\treturn result.ok ? (result.data as PostsCountResponse) : null;\r\n}\r\n\r\nasync function updateCreditsInfo(elements: GeneratePageElements, count: number): Promise<void> {\r\n\ttry {\r\n\t\tconst remainingCredits = await nuclenCheckCreditsAjax();\r\n\t\tconst neededCredits = count;\r\n\t\tif (elements.creditsInfoEl) {\r\n\t\t\telements.creditsInfoEl.textContent = `This will consume ${neededCredits} credit(s). You have ${remainingCredits} left.`;\r\n\t\t}\r\n\t\tif (remainingCredits < neededCredits) {\r\n\t\t\tdisplayError('Not enough credits. Please top up or reduce the number of posts.');\r\n\t\t\tif (elements.submitBtn) {\r\n\t\t\t\telements.submitBtn.disabled = true;\r\n\t\t\t}\r\n\t\t} else if (elements.submitBtn) {\r\n\t\t\tnuclenShowElement(elements.submitBtn);\r\n\t\t\telements.submitBtn.disabled = false;\r\n\t\t}\r\n\t} catch (err: unknown) {\r\n\t\tlogger.error('Error fetching remaining credits:', err);\r\n\t\tconst message = err instanceof Error ? err.message : 'Unknown error';\r\n\t\tif (elements.creditsInfoEl) {\r\n\t\t\telements.creditsInfoEl.textContent = `Unable to retrieve your credits: ${message}`;\r\n\t\t}\r\n\t\tif (elements.submitBtn) {\r\n\t\t\telements.submitBtn.disabled = false;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function initStep1(elements: GeneratePageElements): void {\r\n\telements.getPostsBtn?.addEventListener('click', async () => {\r\n\t\tif (!window.nuclenAjax || !window.nuclenAjax.ajax_url) {\r\n\t\t\tdisplayError('Error: Ajax is not configured properly. Please check the plugin settings.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (elements.postsCountEl) {\r\n\t\t\telements.postsCountEl.innerText = 'Loading posts...';\r\n\t\t}\r\n\t\tconst filters: NuclenFilterValues = nuclenCollectFilters();\r\n\t\tconst data = await requestPostsCount(window.nuclenAjax.ajax_url || '', filters);\r\n\t\tif (!data) {\r\n\t\t\tlogger.error('Error retrieving post count');\r\n\t\t\tif (elements.postsCountEl) {\r\n\t\t\t\telements.postsCountEl.innerText = 'Error retrieving post count.';\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (!data.success) {\r\n\t\t\tif (elements.postsCountEl) {\r\n\t\t\t\telements.postsCountEl.innerText = 'Error retrieving post count.';\r\n\t\t\t}\r\n\t\t\tconst errMsg = data.message || data.data?.message;\r\n\t\t\tif (errMsg) {\r\n\t\t\t\tif (errMsg.includes('Invalid API key')) {\r\n\t\t\t\t\tdisplayError('Your Gold Code (API key) is invalid. Please create a new one on the NE app and enter it on the plugin Setup page.');\r\n\t\t\t\t} else if (errMsg.includes('Invalid WP App Password')) {\r\n\t\t\t\t\tdisplayError('Your WP App Password is invalid. Please go to the plugin Setup page and re-generate it.');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdisplayError(errMsg);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst count = data.data.count as number;\r\n\t\tconst foundPosts = data.data.post_ids;\r\n\t\tconst selectedPostIdsEl = document.getElementById('nuclen_selected_post_ids') as HTMLInputElement | null;\r\n\t\tif (selectedPostIdsEl) {\r\n\t\t\tselectedPostIdsEl.value = JSON.stringify(foundPosts);\r\n\t\t}\r\n\t\tnuclenStoreFilters(filters);\r\n\t\tnuclenHideElement(elements.step1);\r\n\t\tnuclenShowElement(elements.step2);\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'done');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'current');\r\n\t\tif (count === 0) {\r\n\t\t\tif (elements.postsCountEl) {\r\n\t\t\t\telements.postsCountEl.innerText = 'No posts found with these filters.';\r\n\t\t\t}\r\n\t\t\tif (elements.submitBtn) {\r\n\t\t\t\tnuclenHideElement(elements.submitBtn);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (elements.postsCountEl) {\r\n\t\t\telements.postsCountEl.innerText = `Number of posts to process: ${count}`;\r\n\t\t}\r\n\t\tawait updateCreditsInfo(elements, count);\r\n\t});\r\n}\r\n","import {\r\n\tNuclenStartGeneration,\r\n\tNuclenPollAndPullUpdates,\r\n} from '../nuclen-admin-generate';\r\nimport type {\r\n\tStartGenerationResponse,\r\n\tPollingUpdateData,\r\n} from '../generation/api';\r\nimport {\r\n\tnuclenShowElement,\r\n\tnuclenHideElement,\r\n\tnuclenUpdateProgressBarStep,\r\n} from './generate-page-utils';\r\nimport type { GeneratePageElements } from './elements';\r\nimport {\r\n\tnuclenAlertApiError,\r\n\tnuclenStoreGenerationResults,\r\n} from '../generation/results';\r\nimport { displayError } from '../utils/displayError';\r\nimport * as logger from '../utils/logger';\r\n\r\nasync function storeResults(workflow: string, results: unknown): Promise<void> {\r\n\tif (!results || typeof results !== 'object') {\r\n\t\treturn;\r\n\t}\r\n\ttry {\r\n\t\tconst { ok, data } = await nuclenStoreGenerationResults(workflow, results);\r\n\t\tconst respData = data as Record<string, unknown>;\r\n\t\tif (!ok || 'code' in respData) {\r\n\t\t\tlogger.error('Error storing bulk content in WP meta:', respData);\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tlogger.error('Error storing bulk content in WP meta:', err);\r\n\t}\r\n}\r\n\r\nfunction updateCompletionUi(\r\n\telements: GeneratePageElements,\r\n\tfailCount: number | undefined,\r\n\tfinalReport: { message?: string } | undefined,\r\n): void {\r\n\tif (elements.updatesContent) {\r\n\t\tif (failCount && finalReport) {\r\n\t\t\telements.updatesContent.innerText = `Some posts failed. ${finalReport.message || ''}`;\r\n\t\t\tnuclenUpdateProgressBarStep(elements.stepBar4, 'failed');\r\n\t\t} else {\r\n\t\t\telements.updatesContent.innerText = 'All posts processed successfully! Your content has been saved.';\r\n\t\t\tnuclenUpdateProgressBarStep(elements.stepBar4, 'done');\r\n\t\t}\r\n\t}\r\n\tif (elements.submitBtn) {\r\n\t\telements.submitBtn.disabled = false;\r\n\t}\r\n\tnuclenShowElement(elements.restartBtn);\r\n}\r\n\r\nexport function initStep2(elements: GeneratePageElements): void {\r\n\telements.generateForm?.addEventListener('submit', async (event) => {\r\n\t\tevent.preventDefault();\r\n\t\tif (!window.nuclenAdminVars || !window.nuclenAdminVars.ajax_url) {\r\n\t\t\tdisplayError('Error: WP Ajax config not found. Please check the plugin settings.');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'done');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'current');\r\n\t\tnuclenShowElement(elements.updatesSection);\r\n\t\tif (elements.updatesContent) {\r\n\t\t\telements.updatesContent.innerText = 'Processing posts... Do NOT leave this page until the process is complete.';\r\n\t\t}\r\n\t\tnuclenHideElement(elements.step2);\r\n\t\tif (elements.submitBtn) {\r\n\t\t\telements.submitBtn.disabled = true;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tconst formDataObj = Object.fromEntries(new FormData(elements.generateForm!).entries());\r\n\t\t\tconst startResp: StartGenerationResponse = await NuclenStartGeneration(\r\n\t\t\t\tformDataObj\r\n\t\t\t);\r\n\t\t\tconst generationId =\r\n\t\tstartResp.data?.generation_id || startResp.generation_id || 'gen_' + Math.random().toString(36).substring(2);\r\n\t\t\tNuclenPollAndPullUpdates({\r\n\t\t\t\tintervalMs: 5000,\r\n\t\t\t\tgenerationId,\r\n\t\t\t\tonProgress: (processed, total) => {\r\n\t\t\t\t\tconst safeProcessed = processed === undefined ? 0 : processed;\r\n\t\t\t\t\tconst safeTotal = total === undefined ? '' : total;\r\n\t\t\t\t\tif (elements.updatesContent) {\r\n\t\t\t\t\t\telements.updatesContent.innerText = `Processed ${safeProcessed} of ${safeTotal} posts so far...`;\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonComplete: async ({ failCount, finalReport, results, workflow }: PollingUpdateData) => {\r\n\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'done');\r\n\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar4, 'current');\r\n\t\t\t\t\tawait storeResults(workflow, results);\r\n\t\t\t\t\tupdateCompletionUi(elements, failCount, finalReport);\r\n\t\t\t\t},\r\n\t\t\t\tonError: (errMsg: string) => {\r\n\t\t\t\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'failed');\r\n\t\t\t\t\tnuclenAlertApiError(errMsg);\r\n\t\t\t\t\tif (elements.updatesContent) {\r\n\t\t\t\t\t\telements.updatesContent.innerText = `Error: ${errMsg}`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (elements.submitBtn) {\r\n\t\t\t\t\t\telements.submitBtn.disabled = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnuclenShowElement(elements.restartBtn);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} catch (error: unknown) {\r\n\t\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'failed');\r\n\t\t\tconst message = error instanceof Error ? error.message : 'Unknown error';\r\n\t\t\tnuclenAlertApiError(message);\r\n\t\t\tif (elements.submitBtn) {\r\n\t\t\t\telements.submitBtn.disabled = false;\r\n\t\t\t}\r\n\t\t\tnuclenShowElement(elements.restartBtn);\r\n\t\t}\r\n\t});\r\n}\r\n","import {\r\n\tnuclenShowElement,\r\n\tnuclenHideElement,\r\n\tnuclenUpdateProgressBarStep,\r\n\tnuclenToggleSummaryFields,\r\n} from './generate-page-utils';\r\nimport type { GeneratePageElements } from './elements';\r\n\r\nexport function initGoBack(elements: GeneratePageElements): void {\r\n\telements.goBackBtn?.addEventListener('click', () => {\r\n\t\tnuclenHideElement(elements.step2);\r\n\t\tnuclenShowElement(elements.step1);\r\n\t\tif (elements.postsCountEl) {\r\n\t\t\telements.postsCountEl.innerText = '';\r\n\t\t}\r\n\t\tif (elements.creditsInfoEl) {\r\n\t\t\telements.creditsInfoEl.textContent = '';\r\n\t\t}\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'current');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'todo');\r\n\t});\r\n}\r\n\r\nexport function initRestart(elements: GeneratePageElements): void {\r\n\telements.restartBtn?.addEventListener('click', () => {\r\n\t\tnuclenHideElement(elements.updatesSection);\r\n\t\tnuclenHideElement(elements.restartBtn);\r\n\t\tnuclenHideElement(elements.step2);\r\n\t\tif (elements.postsCountEl) {\r\n\t\t\telements.postsCountEl.innerText = '';\r\n\t\t}\r\n\t\tif (elements.creditsInfoEl) {\r\n\t\t\telements.creditsInfoEl.textContent = '';\r\n\t\t}\r\n\t\tnuclenShowElement(elements.step1);\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar1, 'current');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar2, 'todo');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar3, 'todo');\r\n\t\tnuclenUpdateProgressBarStep(elements.stepBar4, 'todo');\r\n\t});\r\n}\r\n\r\nexport function initSummaryToggle(): void {\r\n\tnuclenToggleSummaryFields();\r\n\tconst generateTypeEl = document.getElementById('nuclen_generate_workflow') as HTMLSelectElement | null;\r\n\tconst summaryFormatEl = document.getElementById('nuclen_summary_format') as HTMLSelectElement | null;\r\n\tgenerateTypeEl?.addEventListener('change', nuclenToggleSummaryFields);\r\n\tsummaryFormatEl?.addEventListener('change', nuclenToggleSummaryFields);\r\n}\r\n","import { getGeneratePageElements } from './elements';\r\nimport { initStep1 } from './step1';\r\nimport { initStep2 } from './step2';\r\nimport { initGoBack, initRestart, initSummaryToggle } from './navigation';\r\n\r\nexport function initGeneratePage(): void {\r\n\tconst elements = getGeneratePageElements();\r\n\r\n\t// Initial UI setup\r\n\tif (elements.step1) elements.step1.classList.remove('nuclen-hidden');\r\n\tif (elements.step2) elements.step2.classList.add('nuclen-hidden');\r\n\tif (elements.updatesSection) elements.updatesSection.classList.add('nuclen-hidden');\r\n\tif (elements.restartBtn) elements.restartBtn.classList.add('nuclen-hidden');\r\n\tif (elements.stepBar1) elements.stepBar1.classList.add('ne-step-bar__step--current');\r\n\tif (elements.stepBar2) elements.stepBar2.classList.add('ne-step-bar__step--todo');\r\n\tif (elements.stepBar3) elements.stepBar3.classList.add('ne-step-bar__step--todo');\r\n\tif (elements.stepBar4) elements.stepBar4.classList.add('ne-step-bar__step--todo');\r\n\r\n\tinitStep1(elements);\r\n\tinitStep2(elements);\r\n\tinitGoBack(elements);\r\n\tinitRestart(elements);\r\n\tinitSummaryToggle();\r\n}\r\n","import { initGeneratePage } from './generate/generate-page-handlers';\r\n\r\ninitGeneratePage();\r\n","// admin/ts/nuclen-admin-ui.ts\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => {\r\n\t// Grab tab links as HTMLAnchorElements\r\n\tconst tabs = document.querySelectorAll<HTMLAnchorElement>(\".nav-tab\");\r\n\t// Grab tab content sections as HTMLElements\r\n\tconst contents = document.querySelectorAll<HTMLElement>(\".nuclen-tab-content\");\r\n\r\n\ttabs.forEach((tab) => {\r\n\t\ttab.addEventListener(\"click\", (e) => {\r\n\t\t\te.preventDefault();\r\n\t\t\tconst target = tab.getAttribute(\"href\");\r\n\t\t\tif (!target) return; // If href is missing, bail\r\n\r\n\t\t\t// Remove active class from all tabs, then add to the one that was clicked\r\n\t\t\ttabs.forEach((t) => t.classList.remove(\"nav-tab-active\"));\r\n\t\t\ttab.classList.add(\"nav-tab-active\");\r\n\r\n\t\t\t// Hide all tab contents, then show only the targeted one\r\n\t\t\tcontents.forEach((c) => {\r\n\t\t\t\tc.style.display = \"none\";\r\n\t\t\t});\r\n\t\t\tconst targetContent = document.querySelector<HTMLElement>(target);\r\n\t\t\tif (targetContent) {\r\n\t\t\t\ttargetContent.style.display = \"block\";\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\r\n\r\n\t// Show/hide the custom theme section\r\n\tconst customThemeSection = document.getElementById(\"nuclen-custom-theme-section\");\r\n\tconst themeRadios = document.querySelectorAll<HTMLInputElement>(\"input[name='nuclen_theme']\");\r\n\r\n\tfunction nuclenUpdateCustomThemeVisibility() {\r\n\t\tconst checkedInput = document.querySelector<HTMLInputElement>(\"input[name='nuclen_theme']:checked\");\r\n\t\t// If either the input or the section is missing, do nothing\r\n\t\tif (!checkedInput || !customThemeSection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst selectedTheme = checkedInput.value;\r\n\t\tif (selectedTheme === \"custom\") {\r\n\t\t\tcustomThemeSection.classList.remove(\"nuclen-hidden\");\r\n\t\t} else {\r\n\t\t\tcustomThemeSection.classList.add(\"nuclen-hidden\");\r\n\t\t}\r\n\t}\r\n\r\n\t// Listen for theme radio changes\r\n\tthemeRadios.forEach((radio) => {\r\n\t\tradio.addEventListener(\"change\", nuclenUpdateCustomThemeVisibility);\r\n\t});\r\n\r\n\t// Initial run on page load\r\n\tnuclenUpdateCustomThemeVisibility();\r\n});\r\n","// nuclen-admin-onboarding.ts\r\nimport { nuclenFetchWithRetry } from './nuclen-admin-generate';\r\nimport { displayError } from './utils/displayError';\r\nimport * as logger from './utils/logger';\r\n\r\ndeclare const jQuery: any;\r\n\r\n// 1) Declare the global shape of window.nePointerData.\r\ndeclare global {\r\n\tinterface Window {\r\n\t\tnePointerData?: NuclenPointerData;\r\n\t}\r\n}\r\n\r\n// 2) Describe the structure of the pointer data\r\nexport interface NuclenPointerData {\r\n\tpointers: NuclenPointer[];\r\n\tajaxurl: string;\r\n\tnonce: string | undefined;\r\n}\r\n\r\n// 3) Each pointer has the properties your PHP code provides\r\nexport interface NuclenPointer {\r\n\tid: string;\r\n\ttarget: string;\r\n\ttitle: string;\r\n\tcontent: string;\r\n\tposition: {\r\n\t\tedge: 'top' | 'bottom' | 'left' | 'right';\r\n\t\talign: 'top' | 'bottom' | 'left' | 'right' | 'center';\r\n\t};\r\n}\r\n\r\n// Wrap our logic in an IIFE\r\n(function ($: any) {\r\n\t$(document).ready(() => {\r\n\t\tconst pointerData = window.nePointerData;\r\n\r\n\t\tif (!pointerData || !pointerData.pointers || pointerData.pointers.length === 0) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet currentIndex = 0;\r\n\t\tconst pointers = pointerData.pointers;\r\n\t\tconst ajaxurl = pointerData.ajaxurl;\r\n\t\tconst nonce = pointerData.nonce;\r\n\r\n\t\tasync function dismissPointer(id: string) {\r\n\t\t\tconst form = new URLSearchParams();\r\n\t\t\tform.append('action', 'nuclen_dismiss_pointer');\r\n\t\t\tform.append('pointer', id);\r\n\t\t\tif (nonce) {\r\n\t\t\t\tform.append('nonce', nonce);\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await nuclenFetchWithRetry(ajaxurl, {\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tcredentials: 'same-origin',\r\n\t\t\t\t\theaders: { 'Content-Type': 'application/x-www-form-urlencoded' },\r\n\t\t\t\t\tbody: form.toString(),\r\n\t\t\t\t});\r\n\t\t\t\tif (!result.ok) {\r\n\t\t\t\t\tlogger.error('Failed to dismiss pointer:', result.error);\r\n\t\t\t\t\tdisplayError('Failed to dismiss pointer.');\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tlogger.error('Error dismissing pointer:', err);\r\n\t\t\t\tdisplayError('Network error while dismissing pointer.');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction showNextPointer() {\r\n\t\t\tif (currentIndex >= pointers.length) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst ptr = pointers[currentIndex];\r\n\t\t\tconst $target = $(ptr.target);\r\n\r\n\t\t\tif (!$target.length) {\r\n\t\t\t\tcurrentIndex++;\r\n\t\t\t\tshowNextPointer();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t$target.pointer({\r\n\t\t\t\tcontent: `<h3>${ptr.title}</h3><p>${ptr.content}</p>`,\r\n\t\t\t\tposition: ptr.position,\r\n\t\t\t\tclose: async () => {\r\n\t\t\t\t\tawait dismissPointer(ptr.id);\r\n\t\t\t\t\tcurrentIndex++;\r\n\t\t\t\t\tshowNextPointer();\r\n\t\t\t\t},\r\n\t\t\t}).pointer('open');\r\n\t\t}\r\n\r\n\t\tshowNextPointer();\r\n\t});\r\n})(jQuery);\r\n","(function(){\r\n\t// Only register blocks if we're in the block editor\r\n\tif (!document.body.classList.contains('block-editor-page')) {\r\n\t\treturn;\r\n\t}\r\n\t\r\n\tinterface WPGlobal {\r\n\tblocks?: { registerBlockType: (...args: unknown[]) => void };\r\n\telement?: { createElement: (...args: unknown[]) => unknown };\r\n\ti18n?: { __: (...args: unknown[]) => string };\r\n\t}\r\n\tconst wp = window.wp as WPGlobal;\r\n\tif (!wp || !wp.blocks || !wp.element || !wp.i18n) {\r\n\t\treturn;\r\n\t}\r\n\tconst { registerBlockType } = wp.blocks;\r\n\tconst { createElement } = wp.element;\r\n\tconst { __ } = wp.i18n;\r\n\tregisterBlockType('nuclear-engagement/quiz', {\r\n\t\tapiVersion: 2,\r\n\t\ttitle: __('Quiz', 'nuclear-engagement'),\r\n\t\ticon: 'editor-help',\r\n\t\tcategory: 'widgets',\r\n\t\tedit: () => createElement('p', null, __('Quiz will render on the front-end.', 'nuclear-engagement')),\r\n\t\tsave: () => null,\r\n\t});\r\n\tregisterBlockType('nuclear-engagement/summary', {\r\n\t\tapiVersion: 2,\r\n\t\ttitle: __('Summary', 'nuclear-engagement'),\r\n\t\ticon: 'excerpt-view',\r\n\t\tcategory: 'widgets',\r\n\t\tedit: () => createElement('p', null, __('Summary will render on the front-end.', 'nuclear-engagement')),\r\n\t\tsave: () => null,\r\n\t});\r\n\tregisterBlockType('nuclear-engagement/toc', {\r\n\t\tapiVersion: 2,\r\n\t\ttitle: __('TOC', 'nuclear-engagement'),\r\n\t\ticon: 'list-view',\r\n\t\tcategory: 'widgets',\r\n\t\tedit: () => createElement('p', null, __('TOC will render on the front-end.', 'nuclear-engagement')),\r\n\t\tsave: () => null,\r\n\t});\r\n})();\r\n"],"names":["API_CONFIG","nuclenFetchWithRetry","url","options","retries","initialDelayMs","attempt","delay","lastError","response","status","ok","bodyText","data","error","logger.warn","resolve","logger.error","nuclenFetchUpdates","generationId","formData","result","NuclenStartGeneration","dataToSend","_a","rawData","errMsg","NuclenPollAndPullUpdates","intervalMs","onProgress","onComplete","onError","maxAttempts","timeoutMs","attemptCount","startTime","pollInterval","elapsed","pollResults","processed","total","successCount","failCount","finalReport","results","workflow","err","message","displayError","toast","REST_ENDPOINT","REST_NONCE","nuclenAlertApiError","cleanMsg","nuclenStoreGenerationResults","payload","resp","populateQuizMetaBox","postResult","finalDate","date","questions","newDate","dateField","q","qIndex","questionSelector","questionInput","ans","aIndex","ansSelector","ansInput","explanationSelector","explanationTextarea","populateSummaryMetaBox","summary","tiny","editor","summaryField","initSingleGenerationButtons","event","target","btn","postId","startResp","alertApiError","wf","storeGenerationResults","respData","getGeneratePageElements","nuclenShowElement","el","nuclenHideElement","nuclenUpdateProgressBarStep","stepEl","state","nuclenCheckCreditsAjax","nuclenToggleSummaryFields","generateTypeEl","summarySettingsEl","summaryParagraphOptions","summaryBulletOptions","summaryFormatEl","nuclenCollectFilters","postStatusEl","categoryEl","authorEl","postTypeEl","workflowEl","allowRegenEl","protectRegenEl","summaryLengthEl","summaryNumberEl","nuclenAppendFilters","filters","nuclenStoreFilters","selectedWorkflowEl","selectedSummaryFormatEl","selectedSummaryLengthEl","selectedSummaryNumberEl","selectedPostStatusEl","selectedPostTypeEl","requestPostsCount","ajaxUrl","updateCreditsInfo","elements","count","remainingCredits","neededCredits","initStep1","foundPosts","selectedPostIdsEl","storeResults","updateCompletionUi","initStep2","formDataObj","safeProcessed","safeTotal","initGoBack","initRestart","initSummaryToggle","initGeneratePage","tabs","contents","tab","e","t","c","targetContent","customThemeSection","themeRadios","nuclenUpdateCustomThemeVisibility","checkedInput","radio","$","pointerData","currentIndex","pointers","ajaxurl","nonce","dismissPointer","id","form","showNextPointer","ptr","$target","wp","registerBlockType","createElement","__"],"mappings":"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"}