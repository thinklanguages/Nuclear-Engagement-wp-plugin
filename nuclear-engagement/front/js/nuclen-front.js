window.NuclenLazyLoadComponent=function(i,n=null){const e=document.getElementById(i);if(!e)return;const t=new IntersectionObserver(a=>{a.forEach(o=>{o.isIntersecting&&(n&&typeof window[n]=="function"&&window[n](),t.disconnect())})},{rootMargin:"0px 0px -200px 0px",threshold:.1});t.observe(e)};function I(i,n){const e=document.querySelector(i);if(!e)return;new IntersectionObserver((a,o)=>{a.forEach(l=>{l.isIntersecting&&l.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),o.unobserve(l.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(e)}const _=new MutationObserver((i,n)=>{const e=document.getElementById("nuclen-quiz-container"),t=document.getElementById("nuclen-summary-container");e&&t&&(I("#nuclen-summary-container","nuclen_summary_view"),I("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});_.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function k(i){const n=[...i];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}const x=i=>/.+@.+\..+/.test(i),h=i=>i.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),N=async(i,n,e,t)=>{if(!(!t.ajaxUrl||!t.ajaxNonce))try{await fetch(t.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:t.ajaxNonce,name:i,email:n,url:e})})}catch{}},B=async(i,n,e)=>{e.webhook&&await fetch(e.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:n})})},T=i=>`
  <div id="nuclen-optin-container" class="nuclen-optin-with-results">
    <p class="nuclen-fg"><strong>${i.promptText}</strong></p>
    <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
    <input  type="text"  id="nuclen-optin-name">
    <label for="nuclen-optin-email" class="nuclen-fg">Email</label>
    <input  type="email" id="nuclen-optin-email" required>
    <button type="button" id="nuclen-optin-submit">${i.submitLabel}</button>
  </div>`;function C(i,n,e,t){var a,o;i.innerHTML=`
    <div id="nuclen-optin-container">
      <p class="nuclen-fg"><strong>${n.promptText}</strong></p>
      <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
      <input  type="text"  id="nuclen-optin-name">
      <label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
      <input  type="email" id="nuclen-optin-email" required>
      <div class="nuclen-optin-btn-row">
        <button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
      </div>
      ${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
    </div>`,(a=document.getElementById("nuclen-optin-submit"))==null||a.addEventListener("click",async()=>{const l=document.getElementById("nuclen-optin-name").value.trim(),m=document.getElementById("nuclen-optin-email").value.trim();if(!x(m))return alert("Please enter a valid email");await N(l,m,window.location.href,n);try{await B(l,m,n),e()}catch{alert("Network error – please try again later.")}}),(o=document.getElementById("nuclen-optin-skip"))==null||o.addEventListener("click",l=>{l.preventDefault(),t()})}function M(i){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const e=document.getElementById("nuclen-optin-name").value.trim(),t=document.getElementById("nuclen-optin-email").value.trim();if(!x(t))return alert("Please enter a valid email");await N(e,t,window.location.href,i);try{await B(e,t,i)}catch{alert("Unable to submit. Please try later.")}})}function O(i,n,e){const{qContainer:t,aContainer:a,explContainer:o,nextBtn:l,finalContainer:m}=i;t.innerHTML="",a.innerHTML="",o.innerHTML="",l.classList.add("nuclen-quiz-hidden"),C(m,n,e,e)}function H(i,n,e,t,a){const{qContainer:o,aContainer:l,explContainer:m,nextBtn:y,finalContainer:p,progBar:f}=i;o.innerHTML="",l.innerHTML="",m.innerHTML="",y.classList.add("nuclen-quiz-hidden"),p.classList.remove("nuclen-quiz-hidden");let c="";n.enabled&&n.position==="with_results"&&(c+=T(n)),c+=`
    <div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
    <div id="nuclen-quiz-results-score" class="nuclen-fg">
      ${t.score} / ${e.length}
    </div>`;const r=t.score===e.length?NuclenStrings.perfect:t.score>e.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;c+=`<div id="nuclen-quiz-score-comment">${r}</div>`,c+='<div id="nuclen-quiz-result-tabs-container">',e.forEach((w,d)=>{c+=`
      <button class="nuclen-quiz-result-tab"
              onclick="nuclearEngagementShowQuizQuestionDetails(${d})">${d+1}</button>`}),c+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',NuclenCustomQuizHtmlAfter!=null&&NuclenCustomQuizHtmlAfter.trim()&&(c+=`
      <div id="nuclen-quiz-end-message" class="nuclen-fg">
        ${NuclenCustomQuizHtmlAfter}
      </div>`),c+=`
    <button id="nuclen-quiz-retake-button"
            onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,p.innerHTML=c,n.enabled&&n.position==="with_results"&&M(n),window.nuclearEngagementShowQuizQuestionDetails=w=>{var q;const d=e[w],z=t.userAnswers[w];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
      <p class="nuclen-quiz-detail-question">${h(d.question)}</p>
      <p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${h(d.answers[0])}</p>
      ${z===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${h(d.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${h(d.answers[z]??"[No data]")}</p>`}
      <p class="nuclen-quiz-detail-explanation">${h(d.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(u=>u.classList.remove("nuclen-quiz-result-active-tab")),(q=document.getElementsByClassName("nuclen-quiz-result-tab")[w])==null||q.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0),window.nuclearEngagementRetakeQuiz=()=>{t.currIdx=0,t.score=0,t.userAnswers.length=0,p.innerHTML="",p.classList.add("nuclen-quiz-hidden"),f.style.width=`${1/e.length*100}%`,a()},typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function S(...i){console.warn(...i)}function Q(){const i=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),e=document.getElementById("nuclen-quiz-answers-container"),t=document.getElementById("nuclen-quiz-progress-bar"),a=document.getElementById("nuclen-quiz-final-result-container"),o=document.getElementById("nuclen-quiz-next-button"),l=document.getElementById("nuclen-quiz-explanation-container");if(!i||!n||!e||!t||!a||!o||!l){S("[NE] Quiz markup missing — init aborted.");return}const m=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,y=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,p={position:NuclenOptinPosition??"with_results",mandatory:!!NuclenOptinMandatory,promptText:NuclenOptinPromptText,submitLabel:NuclenOptinButtonText,enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook,ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},f=postQuizData.filter(u=>{var b;return u.question.trim()&&((b=u.answers[0])==null?void 0:b.trim())}).slice(0,m).map(u=>({...u,answers:u.answers.slice(0,y)})),c={qContainer:n,aContainer:e,explContainer:l,nextBtn:o,finalContainer:a,progBar:t},r={currIdx:0,score:0,userAnswers:[]};o.addEventListener("click",q),w();function w(){const u=f[r.currIdx];n.innerHTML=`
        <div id="nuclen-quiz-question-number">
          ${r.currIdx+1}/${f.length}
        </div>
        <div class="nuclen-quiz-title">${h(u.question)}</div>`;const b=k(u.answers.map((s,v)=>({ans:s,idx:v})).filter(s=>s.ans.trim()));e.innerHTML=b.map(s=>`
            <button
              class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
              data-orig-idx="${s.idx}"
            >${h(s.ans)}</button>`).join("");const E=b.findIndex(s=>s.idx===0);l.innerHTML="",l.classList.add("nuclen-quiz-hidden"),o.classList.add("nuclen-quiz-hidden"),d();const g=s=>{const v=s.target;if(!v.matches("button.nuclen-quiz-answer-button"))return;const L=parseInt(v.getAttribute("data-orig-idx")||"0",10);z(L,b.findIndex($=>$.idx===L),E),e.removeEventListener("click",g)};e.addEventListener("click",g)}function d(){t.style.width=`${(r.currIdx+1)/f.length*100}%`}function z(u,b,E){u===0&&r.score++,r.userAnswers.push(u);const g=e.getElementsByTagName("button");for(let s=0;s<g.length;s++)g[s].classList.remove("nuclen-quiz-possible-answer"),s===E?g[s].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):s===b?g[s].classList.add("nuclen-quiz-answer-wrong"):g[s].classList.add("nuclen-quiz-answer-not-selected"),g[s].disabled=!0;l.innerHTML=`<p>${h(f[r.currIdx].explanation)}</p>`,l.classList.remove("nuclen-quiz-hidden"),o.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(r.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function q(){if(r.currIdx++,r.currIdx<f.length)return w(),i.scrollIntoView();const u=()=>H(c,p,f,r,w);if(p.enabled&&p.position==="before_results")return O(c,p,u);u()}}window.nuclearEngagementInitQuiz=Q;
