window.NuclenLazyLoadComponent=function(i,n=null){const e=document.getElementById(i);if(!e)return;const t=new IntersectionObserver(a=>{a.forEach(s=>{if(s.isIntersecting){const r=window;n&&typeof r[n]=="function"&&r[n](),t.disconnect()}})},{rootMargin:"0px 0px -200px 0px",threshold:.1});t.observe(e)};function E(i,n){const e=document.querySelector(i);if(!e)return;new IntersectionObserver((a,s)=>{a.forEach(r=>{r.isIntersecting&&r.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),s.unobserve(r.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(e)}const k=new MutationObserver((i,n)=>{const e=document.getElementById("nuclen-quiz-container"),t=document.getElementById("nuclen-summary-container");e&&t&&(E("#nuclen-summary-container","nuclen_summary_view"),E("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});k.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function N(...i){console.warn(...i)}function y(...i){console.error(...i)}function B(i){const n=[...i];for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}const L=i=>/.+@.+\..+/.test(i),b=i=>i.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),x=async(i,n,e,t)=>{if(!(!t.ajaxUrl||!t.ajaxNonce))try{const a=await fetch(t.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:t.ajaxNonce,name:i,email:n,url:e})});a.ok||y("[NE] Local opt-in failed",a.status)}catch(a){y("[NE] Local opt-in network error",a)}},I=async(i,n,e)=>{if(e.webhook)try{const t=await fetch(e.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:n})});if(!t.ok)throw y("[NE] Webhook responded with",t.status),new Error(String(t.status))}catch(t){throw y("[NE] Webhook request error",t),t}},$=i=>`
	<div id="nuclen-optin-container" class="nuclen-optin-with-results">
	<p class="nuclen-fg"><strong>${i.promptText}</strong></p>
	<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
	<input  type="text"  id="nuclen-optin-name">
	<label for="nuclen-optin-email" class="nuclen-fg">Email</label>
	<input  type="email" id="nuclen-optin-email" required>
	<button type="button" id="nuclen-optin-submit">${i.submitLabel}</button>
	</div>`;function _(i,n,e,t){var a,s;i.innerHTML=`
	<div id="nuclen-optin-container">
		<p class="nuclen-fg"><strong>${n.promptText}</strong></p>
		<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
		<input  type="text"  id="nuclen-optin-name">
		<label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
		<input  type="email" id="nuclen-optin-email" required>
		<div class="nuclen-optin-btn-row">
		<button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
		</div>
		${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
	</div>`,(a=document.getElementById("nuclen-optin-submit"))==null||a.addEventListener("click",async()=>{const r=document.getElementById("nuclen-optin-name").value.trim(),g=document.getElementById("nuclen-optin-email").value.trim();if(!L(g))return alert("Please enter a valid email");await x(r,g,window.location.href,n);try{await I(r,g,n),e()}catch{alert("Network error – please try again later.")}}),(s=document.getElementById("nuclen-optin-skip"))==null||s.addEventListener("click",r=>{r.preventDefault(),t()})}function T(i){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const e=document.getElementById("nuclen-optin-name").value.trim(),t=document.getElementById("nuclen-optin-email").value.trim();if(!L(t))return alert("Please enter a valid email");await x(e,t,window.location.href,i);try{await I(e,t,i)}catch{alert("Unable to submit. Please try later.")}})}function C(i,n,e){const{qContainer:t,aContainer:a,explContainer:s,nextBtn:r,finalContainer:g}=i;t.innerHTML="",a.innerHTML="",s.innerHTML="",r.classList.add("nuclen-quiz-hidden"),_(g,n,e,e)}function M(i,n,e,t,a){const{qContainer:s,aContainer:r,explContainer:g,nextBtn:v,finalContainer:d,progBar:p}=i;s.innerHTML="",r.innerHTML="",g.innerHTML="",v.classList.add("nuclen-quiz-hidden"),d.classList.remove("nuclen-quiz-hidden");let c="";n.enabled&&n.position==="with_results"&&(c+=$(n)),c+=`
	<div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
	<div id="nuclen-quiz-results-score" class="nuclen-fg" aria-live="polite" aria-atomic="true">
		${t.score} / ${e.length}
	</div>`;const u=t.score===e.length?NuclenStrings.perfect:t.score>e.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;c+=`<div id="nuclen-quiz-score-comment" aria-live="polite">${u}</div>`,c+='<div id="nuclen-quiz-result-tabs-container">',e.forEach((f,m)=>{c+=`
		<button class="nuclen-quiz-result-tab"
				onclick="nuclearEngagementShowQuizQuestionDetails(${m})">${m+1}</button>`}),c+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',NuclenCustomQuizHtmlAfter!=null&&NuclenCustomQuizHtmlAfter.trim()&&(c+=`
		<div id="nuclen-quiz-end-message" class="nuclen-fg">
		${NuclenCustomQuizHtmlAfter}
		</div>`),c+=`
	<button id="nuclen-quiz-retake-button"
			onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,d.innerHTML=c,d.setAttribute("aria-live","polite"),n.enabled&&n.position==="with_results"&&T(n),window.nuclearEngagementShowQuizQuestionDetails=f=>{var l;const m=e[f],o=t.userAnswers[f];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
		<p class="nuclen-quiz-detail-question">${b(m.question)}</p>
		<p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${b(m.answers[0])}</p>
		${o===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${b(m.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${b(m.answers[o]??"[No data]")}</p>`}
		<p class="nuclen-quiz-detail-explanation">${b(m.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(z=>z.classList.remove("nuclen-quiz-result-active-tab")),(l=document.getElementsByClassName("nuclen-quiz-result-tab")[f])==null||l.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0),window.nuclearEngagementRetakeQuiz=()=>{t.currIdx=0,t.score=0,t.userAnswers.length=0,d.innerHTML="",d.classList.add("nuclen-quiz-hidden"),p.style.width=`${1/e.length*100}%`,a()},typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function O(i,n,e){i.style.width=`${(n+1)/e*100}%`}function q(i,n,e,t){const{qContainer:a,aContainer:s,explContainer:r,nextBtn:g,progBar:v}=e,d=i[n.currIdx];a.innerHTML=`
	<div id="nuclen-quiz-question-number" aria-live="polite" aria-atomic="true">
		${n.currIdx+1}/${i.length}
	</div>
	<div class="nuclen-quiz-title" role="heading" aria-level="2">${b(d.question)}</div>`;const p=B(d.answers.map((o,l)=>({ans:o,idx:l})).filter(o=>o.ans.trim()));s.innerHTML=p.map((o,l)=>`
		<button
			class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
			data-orig-idx="${o.idx}"
			tabindex="0"
			aria-label="Answer ${l+1}: ${b(o.ans)}"
		>${b(o.ans)}</button>`).join("");const c=p.findIndex(o=>o.idx===0);r.innerHTML="",r.classList.add("nuclen-quiz-hidden"),g.classList.add("nuclen-quiz-hidden"),O(v,n.currIdx,i.length);const u=o=>{const l=parseInt(o.getAttribute("data-orig-idx")||"0",10);t(l,p.findIndex(z=>z.idx===l),c),s.removeEventListener("click",f),s.removeEventListener("keydown",m)},f=o=>{const l=o.target;l.matches("button.nuclen-quiz-answer-button")&&u(l)},m=o=>{const l=o.target;l.matches("button.nuclen-quiz-answer-button")&&(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),u(l))};s.addEventListener("click",f),s.addEventListener("keydown",m)}function S(){const i=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),e=document.getElementById("nuclen-quiz-answers-container"),t=document.getElementById("nuclen-quiz-progress-bar"),a=document.getElementById("nuclen-quiz-final-result-container"),s=document.getElementById("nuclen-quiz-next-button"),r=document.getElementById("nuclen-quiz-explanation-container");if(!i||!n||!e||!t||!a||!s||!r){N("[NE] Quiz markup missing — init aborted.");return}const g=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,v=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,d={position:NuclenOptinPosition??"with_results",mandatory:!!NuclenOptinMandatory,promptText:NuclenOptinPromptText,submitLabel:NuclenOptinButtonText,enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook??"",ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},p=postQuizData.filter(o=>{var l;return o.question.trim()&&((l=o.answers[0])==null?void 0:l.trim())}).slice(0,g).map(o=>({...o,answers:o.answers.slice(0,v)})),c={qContainer:n,aContainer:e,explContainer:r,nextBtn:s,finalContainer:a,progBar:t},u={currIdx:0,score:0,userAnswers:[]};s.addEventListener("click",m),q(p,u,c,f);function f(o,l,z){o===0&&u.score++,u.userAnswers.push(o);const h=e.getElementsByTagName("button");for(let w=0;w<h.length;w++)h[w].classList.remove("nuclen-quiz-possible-answer"),w===z?h[w].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):w===l?h[w].classList.add("nuclen-quiz-answer-wrong"):h[w].classList.add("nuclen-quiz-answer-not-selected"),h[w].disabled=!0;r.innerHTML=`<p>${b(p[u.currIdx].explanation)}</p>`,r.classList.remove("nuclen-quiz-hidden"),s.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(u.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function m(){if(u.currIdx++,u.currIdx<p.length)return q(p,u,c,f),i.scrollIntoView();const o=()=>M(c,d,p,u,()=>q(p,u,c,f));if(d.enabled&&d.position==="before_results")return C(c,d,o);o()}}window.nuclearEngagementInitQuiz=S;
