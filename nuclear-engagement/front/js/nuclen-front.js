window.NuclenLazyLoadComponent=function(t,n=null){const i=document.getElementById(t);if(!i)return;const e=new IntersectionObserver(s=>{s.forEach(l=>{if(l.isIntersecting){const o=window;n&&typeof o[n]=="function"&&o[n](),e.disconnect()}})},{rootMargin:"0px 0px -200px 0px",threshold:.1});e.observe(i)};function E(t,n){const i=document.querySelector(t);if(!i)return;new IntersectionObserver((s,l)=>{s.forEach(o=>{o.isIntersecting&&o.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),l.unobserve(o.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(i)}const k=new MutationObserver((t,n)=>{const i=document.getElementById("nuclen-quiz-container"),e=document.getElementById("nuclen-summary-container");i&&e&&(E("#nuclen-summary-container","nuclen_summary_view"),E("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});k.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function N(...t){console.warn(...t)}function z(...t){console.error(...t)}function B(t){const n=[...t];for(let i=n.length-1;i>0;i--){const e=Math.floor(Math.random()*(i+1));[n[i],n[e]]=[n[e],n[i]]}return n}const L=t=>/.+@.+\..+/.test(t),g=t=>t.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),x=async(t,n,i,e)=>{if(!(!e.ajaxUrl||!e.ajaxNonce))try{const s=await fetch(e.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:e.ajaxNonce,name:t,email:n,url:i})});s.ok||z("[NE] Local opt-in failed",s.status)}catch(s){z("[NE] Local opt-in network error",s)}},I=async(t,n,i)=>{if(i.webhook)try{const e=await fetch(i.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:n})});if(!e.ok)throw z("[NE] Webhook responded with",e.status),new Error(String(e.status))}catch(e){throw z("[NE] Webhook request error",e),e}},$=t=>`
	<div id="nuclen-optin-container" class="nuclen-optin-with-results">
	<p class="nuclen-fg"><strong>${t.promptText}</strong></p>
	<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
	<input  type="text"  id="nuclen-optin-name">
	<label for="nuclen-optin-email" class="nuclen-fg">Email</label>
	<input  type="email" id="nuclen-optin-email" required>
	<button type="button" id="nuclen-optin-submit">${t.submitLabel}</button>
	</div>`;function _(t,n,i,e){var s,l;t.innerHTML=`
	<div id="nuclen-optin-container">
		<p class="nuclen-fg"><strong>${n.promptText}</strong></p>
		<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
		<input  type="text"  id="nuclen-optin-name">
		<label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
		<input  type="email" id="nuclen-optin-email" required>
		<div class="nuclen-optin-btn-row">
		<button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
		</div>
		${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
	</div>`,(s=document.getElementById("nuclen-optin-submit"))==null||s.addEventListener("click",async()=>{const o=document.getElementById("nuclen-optin-name").value.trim(),m=document.getElementById("nuclen-optin-email").value.trim();if(!L(m))return alert("Please enter a valid email");await x(o,m,window.location.href,n);try{await I(o,m,n),i()}catch{alert("Network error – please try again later.")}}),(l=document.getElementById("nuclen-optin-skip"))==null||l.addEventListener("click",o=>{o.preventDefault(),e()})}function T(t){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const i=document.getElementById("nuclen-optin-name").value.trim(),e=document.getElementById("nuclen-optin-email").value.trim();if(!L(e))return alert("Please enter a valid email");await x(i,e,window.location.href,t);try{await I(i,e,t)}catch{alert("Unable to submit. Please try later.")}})}function C(t,n,i){let e="";t.enabled&&t.position==="with_results"&&(e+=$(t)),e+=`
<div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
<div id="nuclen-quiz-results-score" class="nuclen-fg" aria-live="polite" aria-atomic="true">
${i.score} / ${n.length}
</div>`;const s=i.score===n.length?NuclenStrings.perfect:i.score>n.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;return e+=`<div id="nuclen-quiz-score-comment" aria-live="polite">${s}</div>`,e+='<div id="nuclen-quiz-result-tabs-container">',n.forEach((l,o)=>{e+=`
<button class="nuclen-quiz-result-tab" onclick="nuclearEngagementShowQuizQuestionDetails(${o})">${o+1}</button>`}),e+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',NuclenCustomQuizHtmlAfter!=null&&NuclenCustomQuizHtmlAfter.trim()&&(e+=`
<div id="nuclen-quiz-end-message" class="nuclen-fg">
${NuclenCustomQuizHtmlAfter}
</div>`),e+=`
<button id="nuclen-quiz-retake-button" onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,e}function H(t,n){window.nuclearEngagementShowQuizQuestionDetails=i=>{var l;const e=t[i],s=n.userAnswers[i];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
<p class="nuclen-quiz-detail-question">${g(e.question)}</p>
<p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${g(e.answers[0])}</p>
${s===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[s]??"[No data]")}</p>`}
<p class="nuclen-quiz-detail-explanation">${g(e.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(o=>o.classList.remove("nuclen-quiz-result-active-tab")),(l=document.getElementsByClassName("nuclen-quiz-result-tab")[i])==null||l.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0)}function M(t,n,i,e,s){window.nuclearEngagementRetakeQuiz=()=>{t.currIdx=0,t.score=0,t.userAnswers.length=0,n.innerHTML="",n.classList.add("nuclen-quiz-hidden"),i.style.width=`${1/e*100}%`,s()}}function O(t,n,i){const{qContainer:e,aContainer:s,explContainer:l,nextBtn:o,finalContainer:m}=t;e.innerHTML="",s.innerHTML="",l.innerHTML="",o.classList.add("nuclen-quiz-hidden"),_(m,n,i,i)}function S(t,n,i,e,s){const{qContainer:l,aContainer:o,explContainer:m,nextBtn:h,finalContainer:u,progBar:d}=t;l.innerHTML="",o.innerHTML="",m.innerHTML="",h.classList.add("nuclen-quiz-hidden"),u.classList.remove("nuclen-quiz-hidden"),u.innerHTML=C(n,i,e),u.setAttribute("aria-live","polite"),n.enabled&&n.position==="with_results"&&T(n),H(i,e),M(e,u,d,i.length,s),typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function Q(t,n,i){t.style.width=`${(n+1)/i*100}%`}function q(t,n,i,e){const{qContainer:s,aContainer:l,explContainer:o,nextBtn:m,progBar:h}=i,u=t[n.currIdx];s.innerHTML=`
	<div id="nuclen-quiz-question-number" aria-live="polite" aria-atomic="true">
		${n.currIdx+1}/${t.length}
	</div>
	<div class="nuclen-quiz-title" role="heading" aria-level="2">${g(u.question)}</div>`;const d=B(u.answers.map((r,a)=>({ans:r,idx:a})).filter(r=>r.ans.trim()));l.innerHTML=d.map((r,a)=>`
		<button
			class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
			data-orig-idx="${r.idx}"
			tabindex="0"
			aria-label="Answer ${a+1}: ${g(r.ans)}"
		>${g(r.ans)}</button>`).join("");const f=d.findIndex(r=>r.idx===0);o.innerHTML="",o.classList.add("nuclen-quiz-hidden"),m.classList.add("nuclen-quiz-hidden"),Q(h,n.currIdx,t.length);const c=r=>{const a=parseInt(r.getAttribute("data-orig-idx")||"0",10);e(a,d.findIndex(y=>y.idx===a),f),l.removeEventListener("click",w),l.removeEventListener("keydown",v)},w=r=>{const a=r.target;a.matches("button.nuclen-quiz-answer-button")&&c(a)},v=r=>{const a=r.target;a.matches("button.nuclen-quiz-answer-button")&&(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),c(a))};l.addEventListener("click",w),l.addEventListener("keydown",v)}function A(){const t=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),i=document.getElementById("nuclen-quiz-answers-container"),e=document.getElementById("nuclen-quiz-progress-bar"),s=document.getElementById("nuclen-quiz-final-result-container"),l=document.getElementById("nuclen-quiz-next-button"),o=document.getElementById("nuclen-quiz-explanation-container");if(!t||!n||!i||!e||!s||!l||!o){N("[NE] Quiz markup missing — init aborted.");return}const m=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,h=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,u={position:NuclenOptinPosition??"with_results",mandatory:!!NuclenOptinMandatory,promptText:NuclenOptinPromptText,submitLabel:NuclenOptinButtonText,enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook??"",ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},d=postQuizData.filter(r=>{var a;return r.question.trim()&&((a=r.answers[0])==null?void 0:a.trim())}).slice(0,m).map(r=>({...r,answers:r.answers.slice(0,h)})),f={qContainer:n,aContainer:i,explContainer:o,nextBtn:l,finalContainer:s,progBar:e},c={currIdx:0,score:0,userAnswers:[]};l.addEventListener("click",v),q(d,c,f,w);function w(r,a,y){r===0&&c.score++,c.userAnswers.push(r);const b=i.getElementsByTagName("button");for(let p=0;p<b.length;p++)b[p].classList.remove("nuclen-quiz-possible-answer"),p===y?b[p].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):p===a?b[p].classList.add("nuclen-quiz-answer-wrong"):b[p].classList.add("nuclen-quiz-answer-not-selected"),b[p].disabled=!0;o.innerHTML=`<p>${g(d[c.currIdx].explanation)}</p>`,o.classList.remove("nuclen-quiz-hidden"),l.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(c.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function v(){if(c.currIdx++,c.currIdx<d.length)return q(d,c,f,w),t.scrollIntoView();const r=()=>S(f,u,d,c,()=>q(d,c,f,w));if(u.enabled&&u.position==="before_results")return O(f,u,r);r()}}window.nuclearEngagementInitQuiz=A;
