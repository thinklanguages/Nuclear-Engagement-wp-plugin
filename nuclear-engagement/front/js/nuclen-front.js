import{n as y}from"../../nuclen-notify-BUkiVJnd.js";window.NuclenLazyLoadComponent=function(i,n=null){const e=document.getElementById(i);if(!e)return;const o=new IntersectionObserver(d=>{d.forEach(m=>{m.isIntersecting&&(n&&typeof window[n]=="function"&&window[n](),o.disconnect())})},{rootMargin:"0px 0px -200px 0px",threshold:.1});o.observe(e)};function M(i,n){const e=document.querySelector(i);if(!e)return;new IntersectionObserver((d,m)=>{d.forEach(l=>{l.isIntersecting&&l.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),m.unobserve(l.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(e)}const A=new MutationObserver((i,n)=>{const e=document.getElementById("nuclen-quiz-container"),o=document.getElementById("nuclen-summary-container");e&&o&&(M("#nuclen-summary-container","nuclen_summary_view"),M("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});A.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function P(i){const n=[...i];for(let e=n.length-1;e>0;e--){const o=Math.floor(Math.random()*(e+1));[n[e],n[o]]=[n[o],n[e]]}return n}const $=i=>/.+@.+\..+/.test(i),H=async(i,n,e,o)=>{if(!(!o.ajaxUrl||!o.ajaxNonce))try{await fetch(o.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:o.ajaxNonce,name:i,email:n,url:e})})}catch{}},_=async(i,n,e)=>{e.webhook&&await fetch(e.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:n})})},R=i=>`
  <div id="nuclen-optin-container" class="nuclen-optin-with-results">
    <p class="nuclen-fg"><strong>${i.promptText}</strong></p>
    <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
    <input  type="text"  id="nuclen-optin-name">
    <label for="nuclen-optin-email" class="nuclen-fg">Email</label>
    <input  type="email" id="nuclen-optin-email" required>
    <button type="button" id="nuclen-optin-submit">${i.submitLabel}</button>
  </div>`;function D(i,n,e,o){var d,m;i.innerHTML=`
    <div id="nuclen-optin-container">
      <p class="nuclen-fg"><strong>${n.promptText}</strong></p>
      <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
      <input  type="text"  id="nuclen-optin-name">
      <label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
      <input  type="email" id="nuclen-optin-email" required>
      <div style="margin-top:1em;display:flex;gap:10px;">
        <button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
      </div>
      ${n.mandatory?"":'<div style="margin-top:0.5em;"><a href="#" id="nuclen-optin-skip" style="font-size:.85em;">Skip &amp; view results</a></div>'}
    </div>`,(d=document.getElementById("nuclen-optin-submit"))==null||d.addEventListener("click",async()=>{const l=document.getElementById("nuclen-optin-name").value.trim(),h=document.getElementById("nuclen-optin-email").value.trim();if(!$(h)){y("Please enter a valid email");return}await H(l,h,window.location.href,n);try{await _(l,h,n),e()}catch{y("Network error – please try again later.")}}),(m=document.getElementById("nuclen-optin-skip"))==null||m.addEventListener("click",l=>{l.preventDefault(),o()})}function U(i){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const e=document.getElementById("nuclen-optin-name").value.trim(),o=document.getElementById("nuclen-optin-email").value.trim();if(!$(o)){y("Please enter a valid email");return}await H(e,o,window.location.href,i);try{await _(e,o,i)}catch{y("Unable to submit. Please try later.")}})}function W(){var N,T,k,B;const i=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),e=document.getElementById("nuclen-quiz-answers-container"),o=document.getElementById("nuclen-quiz-progress-bar"),d=document.getElementById("nuclen-quiz-final-result-container"),m=document.getElementById("nuclen-quiz-next-button"),l=document.getElementById("nuclen-quiz-explanation-container");if(!i||!n||!e||!o||!d||!m||!l){console.warn("[NE] Quiz markup missing — init aborted.");return}const h=(typeof window.NuclenSettings!=="undefined"?window.NuclenSettings.questions_per_quiz??10:10),(typeof window.NuclenSettings!=="undefined"?window.NuclenSettings.answers_per_question??4:4),g={position:window.NuclenOptinPosition??"with_results",mandatory:!!window.NuclenOptinMandatory,promptText:window.NuclenOptinPromptText||"Please enter your details:",submitLabel:window.NuclenOptinButtonText||"Submit",enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook||"",ajaxUrl:((k=window.NuclenOptinAjax)==null?void 0:k.url)??"",ajaxNonce:((B=window.NuclenOptinAjax)==null?void 0:B.nonce)??""},q=window.postQuizData;if(!q||!Array.isArray(q)||q.length===0){console.warn("[NE] No quiz data available."),n.innerHTML="<p>No quiz data available for this post.</p>";return}const c=[];for(let s=0;s<Math.min(q.length,h);s++){const u=q[s];if(!u||typeof u!="object")continue;const p=String(u.question||"").trim();if(!p)continue;const a=[];if(Array.isArray(u.answers))for(let t=0;t<Math.min(u.answers.length,O);t++){const r=String(u.answers[t]||"").trim();r&&a.push(r)}a.length!==0&&c.push({question:p,answers:a,explanation:String(u.explanation||"").trim()||"No explanation provided."})}if(c.length===0){console.warn("[NE] No valid quiz questions found."),n.innerHTML="<p>No valid quiz questions available.</p>";return}let f=0,v=0;const E=[];m.addEventListener("click",C),L();function L(){if(f>=c.length){console.error("[NE] Question index out of bounds");return}const s=c[f];n.innerHTML=`
      <div id="nuclen-quiz-question-number">
        ${f+1}/${c.length}
      </div>
      <div class="nuclen-quiz-title">${w(s.question)}</div>`;const u=s.answers.map((r,b)=>({ans:r,idx:b})),p=P(u);e.innerHTML=p.map(r=>`
          <button
            class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
            data-orig-idx="${r.idx}"
          >${w(r.ans)}</button>`).join("");const a=p.findIndex(r=>r.idx===0);l.innerHTML="",l.classList.add("nuclen-quiz-hidden"),m.classList.add("nuclen-quiz-hidden"),Q();const t=r=>{const b=r.target;if(!b.matches("button.nuclen-quiz-answer-button"))return;const z=parseInt(b.getAttribute("data-orig-idx")||"0",10);S(z,p.findIndex(x=>x.idx===z),a),e.removeEventListener("click",t)};e.addEventListener("click",t)}function Q(){o.style.width=`${(f+1)/c.length*100}%`}function S(s,u,p){s===0&&v++,E.push(s);const a=e.getElementsByTagName("button");for(let t=0;t<a.length;t++)a[t].classList.remove("nuclen-quiz-possible-answer"),t===p?a[t].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):t===u?a[t].classList.add("nuclen-quiz-answer-wrong"):a[t].classList.add("nuclen-quiz-answer-not-selected"),a[t].disabled=!0;l.innerHTML=`<p>${w(c[f].explanation)}</p>`,l.classList.remove("nuclen-quiz-hidden"),m.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(f===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function C(){if(f++,f<c.length){L(),i.scrollIntoView({behavior:"smooth",block:"center"});return}if(g.enabled&&g.position==="before_results")return j();I()}function j(){n.innerHTML="",e.innerHTML="",l.innerHTML="",m.classList.add("nuclen-quiz-hidden"),D(d,g,()=>I(),()=>I())}function I(){n.innerHTML="",e.innerHTML="",l.innerHTML="",m.classList.add("nuclen-quiz-hidden"),d.classList.remove("nuclen-quiz-hidden");let s="";g.enabled&&g.position==="with_results"&&(s+=R(g)),s+=`
      <div id="nuclen-quiz-results-title" class="nuclen-fg">Your Score</div>
      <div id="nuclen-quiz-results-score" class="nuclen-fg">
        ${v} / ${c.length}
      </div>`;const u=v===c.length?"Perfect!":v>c.length/2?"Well done!":"Why not retake the test?";s+=`<div id="nuclen-quiz-score-comment">${w(u)}</div>`,s+='<div id="nuclen-quiz-result-tabs-container">',c.forEach((a,t)=>{s+=`
        <button class="nuclen-quiz-result-tab"
                onclick="nuclearEngagementShowQuizQuestionDetails(${t})">${t+1}</button>`}),s+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>';const p=window.NuclenCustomQuizHtmlAfter;p&&typeof p=="string"&&p.trim()&&(s+=`
        <div id="nuclen-quiz-end-message" class="nuclen-fg">
          ${p}
        </div>`),s+=`
      <button id="nuclen-quiz-retake-button"
              onclick="nuclearEngagementRetakeQuiz()">Retake Test</button>`,d.innerHTML=s,g.enabled&&g.position==="with_results"&&U(g),window.nuclearEngagementShowQuizQuestionDetails=a=>{if(a<0||a>=c.length)return;const t=c[a],r=E[a]??-1,b=document.getElementById("nuclen-quiz-result-details-container");if(!b)return;b.innerHTML=`
        <p class="nuclen-quiz-detail-question">${w(t.question)}</p>
        <p class="nuclen-quiz-detail-correct"><strong>Correct:</strong> ${w(t.answers[0])}</p>
        ${r===0?`<p class="nuclen-quiz-detail-chosen"><strong>Your answer:</strong> ${w(t.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:r>=0&&r<t.answers.length?`<p class="nuclen-quiz-detail-chosen"><strong>Your answer:</strong> ${w(t.answers[r])}</p>`:'<p class="nuclen-quiz-detail-chosen"><strong>Your answer:</strong> [No answer selected]</p>'}
        <p class="nuclen-quiz-detail-explanation">${w(t.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(x=>x.classList.remove("nuclen-quiz-result-active-tab"));const z=document.getElementsByClassName("nuclen-quiz-result-tab");z[a]&&z[a].classList.add("nuclen-quiz-result-active-tab")},c.length>0&&window.nuclearEngagementShowQuizQuestionDetails(0),window.nuclearEngagementRetakeQuiz=()=>{f=0,v=0,E.length=0,d.innerHTML="",d.classList.add("nuclen-quiz-hidden"),L(),i.scrollIntoView({behavior:"smooth",block:"center"})},typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function w(s){const u=document.createElement("div");return u.textContent=s,u.innerHTML}}window.nuclearEngagementInitQuiz=W;
