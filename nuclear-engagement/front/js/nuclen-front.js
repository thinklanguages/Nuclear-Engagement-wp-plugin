import{e as z,w as k}from"../../logger-CX9s0JXb.js";window.NuclenLazyLoadComponent=function(i,n=null){const t=document.getElementById(i);if(!t)return;const e=new IntersectionObserver(s=>{s.forEach(a=>{if(a.isIntersecting){const o=window;n&&typeof o[n]=="function"&&o[n](),e.disconnect()}})},{rootMargin:"0px 0px -200px 0px",threshold:.1});e.observe(t)};function E(i,n){const t=document.querySelector(i);if(!t)return;new IntersectionObserver((s,a)=>{s.forEach(o=>{o.isIntersecting&&o.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),a.unobserve(o.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(t)}const N=new MutationObserver((i,n)=>{const t=document.getElementById("nuclen-quiz-container"),e=document.getElementById("nuclen-summary-container");t&&e&&(E("#nuclen-summary-container","nuclen_summary_view"),E("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});N.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function B(i){const n=[...i];for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}return n}const L=i=>/.+@.+\..+/.test(i),g=i=>i.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),x=async(i,n,t,e)=>{if(!(!e.ajaxUrl||!e.ajaxNonce))try{const s=await fetch(e.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:e.ajaxNonce,name:i,email:n,url:t})});s.ok||z("[NE] Local opt-in failed",s.status)}catch(s){z("[NE] Local opt-in network error",s)}},I=async(i,n,t)=>{if(t.webhook)try{const e=await fetch(t.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:n})});if(!e.ok)throw z("[NE] Webhook responded with",e.status),new Error(String(e.status))}catch(e){throw z("[NE] Webhook request error",e),e}},$=i=>`
	<div id="nuclen-optin-container" class="nuclen-optin-with-results">
	<p class="nuclen-fg"><strong>${i.promptText}</strong></p>
	<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
	<input  type="text"  id="nuclen-optin-name">
	<label for="nuclen-optin-email" class="nuclen-fg">Email</label>
	<input  type="email" id="nuclen-optin-email" required>
	<button type="button" id="nuclen-optin-submit">${i.submitLabel}</button>
	</div>`;function _(i,n,t,e){var s,a;i.innerHTML=`
	<div id="nuclen-optin-container">
		<p class="nuclen-fg"><strong>${n.promptText}</strong></p>
		<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
		<input  type="text"  id="nuclen-optin-name">
		<label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
		<input  type="email" id="nuclen-optin-email" required>
		<div class="nuclen-optin-btn-row">
		<button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
		</div>
		${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
	</div>`,(s=document.getElementById("nuclen-optin-submit"))==null||s.addEventListener("click",async()=>{const o=document.getElementById("nuclen-optin-name").value.trim(),m=document.getElementById("nuclen-optin-email").value.trim();if(!L(m))return alert("Please enter a valid email");await x(o,m,window.location.href,n);try{await I(o,m,n),t()}catch{alert("Network error – please try again later.")}}),(a=document.getElementById("nuclen-optin-skip"))==null||a.addEventListener("click",o=>{o.preventDefault(),e()})}function T(i){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const t=document.getElementById("nuclen-optin-name").value.trim(),e=document.getElementById("nuclen-optin-email").value.trim();if(!L(e))return alert("Please enter a valid email");await x(t,e,window.location.href,i);try{await I(t,e,i)}catch{alert("Unable to submit. Please try later.")}})}function C(i,n,t){let e="";i.enabled&&i.position==="with_results"&&(e+=$(i)),e+=`
<div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
<div id="nuclen-quiz-results-score" class="nuclen-fg" aria-live="polite" aria-atomic="true">
${t.score} / ${n.length}
</div>`;const s=t.score===n.length?NuclenStrings.perfect:t.score>n.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;return e+=`<div id="nuclen-quiz-score-comment" aria-live="polite">${s}</div>`,e+='<div id="nuclen-quiz-result-tabs-container">',n.forEach((a,o)=>{e+=`
<button class="nuclen-quiz-result-tab" onclick="nuclearEngagementShowQuizQuestionDetails(${o})">${o+1}</button>`}),e+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',NuclenCustomQuizHtmlAfter!=null&&NuclenCustomQuizHtmlAfter.trim()&&(e+=`
<div id="nuclen-quiz-end-message" class="nuclen-fg">
${NuclenCustomQuizHtmlAfter}
</div>`),e+=`
<button id="nuclen-quiz-retake-button" onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,e}function H(i,n){window.nuclearEngagementShowQuizQuestionDetails=t=>{var a;const e=i[t],s=n.userAnswers[t];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
<p class="nuclen-quiz-detail-question">${g(e.question)}</p>
<p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${g(e.answers[0])}</p>
${s===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[s]??"[No data]")}</p>`}
<p class="nuclen-quiz-detail-explanation">${g(e.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(o=>o.classList.remove("nuclen-quiz-result-active-tab")),(a=document.getElementsByClassName("nuclen-quiz-result-tab")[t])==null||a.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0)}function M(i,n,t,e,s){window.nuclearEngagementRetakeQuiz=()=>{i.currIdx=0,i.score=0,i.userAnswers.length=0,n.innerHTML="",n.classList.add("nuclen-quiz-hidden"),t.style.width=`${1/e*100}%`,s()}}function O(i,n,t){const{qContainer:e,aContainer:s,explContainer:a,nextBtn:o,finalContainer:m}=i;e.innerHTML="",s.innerHTML="",a.innerHTML="",o.classList.add("nuclen-quiz-hidden"),_(m,n,t,t)}function S(i,n,t,e,s){const{qContainer:a,aContainer:o,explContainer:m,nextBtn:h,finalContainer:c,progBar:d}=i;a.innerHTML="",o.innerHTML="",m.innerHTML="",h.classList.add("nuclen-quiz-hidden"),c.classList.remove("nuclen-quiz-hidden"),c.innerHTML=C(n,t,e),c.setAttribute("aria-live","polite"),n.enabled&&n.position==="with_results"&&T(n),H(t,e),M(e,c,d,t.length,s),typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function Q(i,n,t){i.style.width=`${(n+1)/t*100}%`}function q(i,n,t,e){const{qContainer:s,aContainer:a,explContainer:o,nextBtn:m,progBar:h}=t,c=i[n.currIdx];s.innerHTML=`
	<div id="nuclen-quiz-question-number" aria-live="polite" aria-atomic="true">
		${n.currIdx+1}/${i.length}
	</div>
	<div class="nuclen-quiz-title" role="heading" aria-level="2">${g(c.question)}</div>`;const d=B(c.answers.map((r,l)=>({ans:r,idx:l})).filter(r=>r.ans.trim()));a.innerHTML=d.map((r,l)=>`
		<button
			class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
			data-orig-idx="${r.idx}"
			tabindex="0"
			aria-label="Answer ${l+1}: ${g(r.ans)}"
		>${g(r.ans)}</button>`).join("");const f=d.findIndex(r=>r.idx===0);o.innerHTML="",o.classList.add("nuclen-quiz-hidden"),m.classList.add("nuclen-quiz-hidden"),Q(h,n.currIdx,i.length);const u=r=>{const l=parseInt(r.getAttribute("data-orig-idx")||"0",10);e(l,d.findIndex(y=>y.idx===l),f),a.removeEventListener("click",w),a.removeEventListener("keydown",v)},w=r=>{const l=r.target;l.matches("button.nuclen-quiz-answer-button")&&u(l)},v=r=>{const l=r.target;l.matches("button.nuclen-quiz-answer-button")&&(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),u(l))};a.addEventListener("click",w),a.addEventListener("keydown",v)}function A(){const i=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),t=document.getElementById("nuclen-quiz-answers-container"),e=document.getElementById("nuclen-quiz-progress-bar"),s=document.getElementById("nuclen-quiz-final-result-container"),a=document.getElementById("nuclen-quiz-next-button"),o=document.getElementById("nuclen-quiz-explanation-container");if(!i||!n||!t||!e||!s||!a||!o){k("[NE] Quiz markup missing — init aborted.");return}const m=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,h=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,c={position:NuclenOptinPosition??"with_results",mandatory:!!NuclenOptinMandatory,promptText:NuclenOptinPromptText,submitLabel:NuclenOptinButtonText,enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook??"",ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},d=postQuizData.filter(r=>{var l;return r.question.trim()&&((l=r.answers[0])==null?void 0:l.trim())}).slice(0,m).map(r=>({...r,answers:r.answers.slice(0,h)})),f={qContainer:n,aContainer:t,explContainer:o,nextBtn:a,finalContainer:s,progBar:e},u={currIdx:0,score:0,userAnswers:[]};a.addEventListener("click",v),q(d,u,f,w);function w(r,l,y){r===0&&u.score++,u.userAnswers.push(r);const b=t.getElementsByTagName("button");for(let p=0;p<b.length;p++)b[p].classList.remove("nuclen-quiz-possible-answer"),p===y?b[p].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):p===l?b[p].classList.add("nuclen-quiz-answer-wrong"):b[p].classList.add("nuclen-quiz-answer-not-selected"),b[p].disabled=!0;o.innerHTML=`<p>${g(d[u.currIdx].explanation)}</p>`,o.classList.remove("nuclen-quiz-hidden"),a.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(u.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function v(){if(u.currIdx++,u.currIdx<d.length)return q(d,u,f,w),i.scrollIntoView();const r=()=>S(f,c,d,u,()=>q(d,u,f,w));if(c.enabled&&c.position==="before_results")return O(f,c,r);r()}}window.nuclearEngagementInitQuiz=A;
