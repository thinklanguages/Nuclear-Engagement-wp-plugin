window.NuclenLazyLoadComponent=function(t,n=null){const e=document.getElementById(t);if(!e)return;const i=new IntersectionObserver(a=>{a.forEach(c=>{c.isIntersecting&&(n&&typeof window[n]=="function"&&window[n](),i.disconnect())})},{rootMargin:"0px 0px -200px 0px",threshold:.1});i.observe(e)};function E(t,n){const e=document.querySelector(t);if(!e)return;new IntersectionObserver((a,c)=>{a.forEach(u=>{u.isIntersecting&&u.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),c.unobserve(u.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(e)}const M=new MutationObserver((t,n)=>{const e=document.getElementById("nuclen-quiz-container"),i=document.getElementById("nuclen-summary-container");e&&i&&(E("#nuclen-summary-container","nuclen_summary_view"),E("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});M.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function O(t){const n=[...t];for(let e=n.length-1;e>0;e--){const i=Math.floor(Math.random()*(e+1));[n[e],n[i]]=[n[i],n[e]]}return n}const L=t=>/.+@.+\..+/.test(t),f=t=>t.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),I=async(t,n,e,i)=>{if(!(!i.ajaxUrl||!i.ajaxNonce))try{await fetch(i.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:i.ajaxNonce,name:t,email:n,url:e})})}catch{}},N=async(t,n,e)=>{e.webhook&&await fetch(e.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:n})})},H=t=>`
  <div id="nuclen-optin-container" class="nuclen-optin-with-results">
    <p class="nuclen-fg"><strong>${t.promptText}</strong></p>
    <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
    <input  type="text"  id="nuclen-optin-name">
    <label for="nuclen-optin-email" class="nuclen-fg">Email</label>
    <input  type="email" id="nuclen-optin-email" required>
    <button type="button" id="nuclen-optin-submit">${t.submitLabel}</button>
  </div>`;function S(t,n,e,i){var a,c;t.innerHTML=`
    <div id="nuclen-optin-container">
      <p class="nuclen-fg"><strong>${n.promptText}</strong></p>
      <label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
      <input  type="text"  id="nuclen-optin-name">
      <label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
      <input  type="email" id="nuclen-optin-email" required>
      <div class="nuclen-optin-btn-row">
        <button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
      </div>
      ${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
    </div>`,(a=document.getElementById("nuclen-optin-submit"))==null||a.addEventListener("click",async()=>{const u=document.getElementById("nuclen-optin-name").value.trim(),w=document.getElementById("nuclen-optin-email").value.trim();if(!L(w))return alert("Please enter a valid email");await I(u,w,window.location.href,n);try{await N(u,w,n),e()}catch{alert("Network error – please try again later.")}}),(c=document.getElementById("nuclen-optin-skip"))==null||c.addEventListener("click",u=>{u.preventDefault(),i()})}function Q(t){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const e=document.getElementById("nuclen-optin-name").value.trim(),i=document.getElementById("nuclen-optin-email").value.trim();if(!L(i))return alert("Please enter a valid email");await I(e,i,window.location.href,t);try{await N(e,i,t)}catch{alert("Unable to submit. Please try later.")}})}function C(...t){console.warn(...t)}function j(){const t=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),e=document.getElementById("nuclen-quiz-answers-container"),i=document.getElementById("nuclen-quiz-progress-bar"),a=document.getElementById("nuclen-quiz-final-result-container"),c=document.getElementById("nuclen-quiz-next-button"),u=document.getElementById("nuclen-quiz-explanation-container");if(!t||!n||!e||!i||!a||!c||!u){C("[NE] Quiz markup missing — init aborted.");return}const w=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,$=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,m={position:NuclenOptinPosition??"with_results",mandatory:!!NuclenOptinMandatory,promptText:NuclenOptinPromptText,submitLabel:NuclenOptinButtonText,enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook,ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},r=postQuizData.filter(l=>{var d;return l.question.trim()&&((d=l.answers[0])==null?void 0:d.trim())}).slice(0,w).map(l=>({...l,answers:l.answers.slice(0,$)}));let p=0,h=0;const z=[];c.addEventListener("click",_),v();function v(){const l=r[p];n.innerHTML=`
        <div id="nuclen-quiz-question-number">
          ${p+1}/${r.length}
        </div>
        <div class="nuclen-quiz-title">${f(l.question)}</div>`;const d=O(l.answers.map((s,b)=>({ans:s,idx:b})).filter(s=>s.ans.trim()));e.innerHTML=d.map(s=>`
            <button
              class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
              data-orig-idx="${s.idx}"
            >${f(s.ans)}</button>`).join("");const g=d.findIndex(s=>s.idx===0);u.innerHTML="",u.classList.add("nuclen-quiz-hidden"),c.classList.add("nuclen-quiz-hidden"),x();const o=s=>{const b=s.target;if(!b.matches("button.nuclen-quiz-answer-button"))return;const q=parseInt(b.getAttribute("data-orig-idx")||"0",10);B(q,d.findIndex(T=>T.idx===q),g),e.removeEventListener("click",o)};e.addEventListener("click",o)}function x(){i.style.width=`${(p+1)/r.length*100}%`}function B(l,d,g){l===0&&h++,z.push(l);const o=e.getElementsByTagName("button");for(let s=0;s<o.length;s++)o[s].classList.remove("nuclen-quiz-possible-answer"),s===g?o[s].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):s===d?o[s].classList.add("nuclen-quiz-answer-wrong"):o[s].classList.add("nuclen-quiz-answer-not-selected"),o[s].disabled=!0;u.innerHTML=`<p>${f(r[p].explanation)}</p>`,u.classList.remove("nuclen-quiz-hidden"),c.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(p===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function _(){if(p++,p<r.length)return v(),t.scrollIntoView();if(m.enabled&&m.position==="before_results")return k();y()}function k(){n.innerHTML="",e.innerHTML="",u.innerHTML="",c.classList.add("nuclen-quiz-hidden"),S(a,m,()=>y(),()=>y())}function y(){n.innerHTML="",e.innerHTML="",u.innerHTML="",c.classList.add("nuclen-quiz-hidden"),a.classList.remove("nuclen-quiz-hidden");let l="";m.enabled&&m.position==="with_results"&&(l+=H(m)),l+=`
        <div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
        <div id="nuclen-quiz-results-score" class="nuclen-fg">
          ${h} / ${r.length}
        </div>`;const d=h===r.length?NuclenStrings.perfect:h>r.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;l+=`<div id="nuclen-quiz-score-comment">${d}</div>`,l+='<div id="nuclen-quiz-result-tabs-container">',r.forEach((g,o)=>{l+=`
          <button class="nuclen-quiz-result-tab"
                  onclick="nuclearEngagementShowQuizQuestionDetails(${o})">${o+1}</button>`}),l+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',NuclenCustomQuizHtmlAfter!=null&&NuclenCustomQuizHtmlAfter.trim()&&(l+=`
          <div id="nuclen-quiz-end-message" class="nuclen-fg">
            ${NuclenCustomQuizHtmlAfter}
          </div>`),l+=`
        <button id="nuclen-quiz-retake-button"
                onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,a.innerHTML=l,m.enabled&&m.position==="with_results"&&Q(m),window.nuclearEngagementShowQuizQuestionDetails=g=>{var b;const o=r[g],s=z[g];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
          <p class="nuclen-quiz-detail-question">${f(o.question)}</p>
          <p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${f(o.answers[0])}</p>
          ${s===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${f(o.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${f(o.answers[s]??"[No data]")}</p>`}
          <p class="nuclen-quiz-detail-explanation">${f(o.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(q=>q.classList.remove("nuclen-quiz-result-active-tab")),(b=document.getElementsByClassName("nuclen-quiz-result-tab")[g])==null||b.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0),window.nuclearEngagementRetakeQuiz=()=>{p=0,h=0,z.length=0,a.innerHTML="",a.classList.add("nuclen-quiz-hidden"),i.style.width=`${1/r.length*100}%`,v()},typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}}window.nuclearEngagementInitQuiz=j;
