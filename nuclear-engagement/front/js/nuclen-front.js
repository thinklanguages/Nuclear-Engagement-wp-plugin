import{e as z}from"../../logger-CjYDh3vN.js";window.NuclenLazyLoadComponent=function(i,n=null){const t=document.getElementById(i);if(!t)return;const e=new IntersectionObserver(r=>{r.forEach(s=>{if(s.isIntersecting){const l=window;n&&typeof l[n]=="function"&&l[n](),e.disconnect()}})},{rootMargin:"0px 0px -200px 0px",threshold:.1});e.observe(t)};function E(i,n){const t=document.querySelector(i);if(!t)return;new IntersectionObserver((r,s)=>{r.forEach(l=>{l.isIntersecting&&l.intersectionRatio===1&&(typeof gtag=="function"&&gtag("event",n),s.unobserve(l.target))})},{root:null,rootMargin:"0px",threshold:1}).observe(t)}const k=new MutationObserver((i,n)=>{const t=document.getElementById("nuclen-quiz-container"),e=document.getElementById("nuclen-summary-container");t&&e&&(E("#nuclen-summary-container","nuclen_summary_view"),E("#nuclen-quiz-container","nuclen_quiz_view"),n.disconnect())});k.observe(document.body,{childList:!0,subtree:!0});window.NuclenLazyLoadComponent("nuclen-quiz-container","nuclearEngagementInitQuiz");function N(i){const n=[...i];for(let t=n.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1));[n[t],n[e]]=[n[e],n[t]]}return n}const L=i=>/.+@.+\..+/.test(i),g=i=>i.replace(/[&<>"']/g,n=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[n]||n),x=async(i,n,t,e)=>{if(!(!e.ajaxUrl||!e.ajaxNonce))try{const r=await fetch(e.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:e.ajaxNonce,name:i,email:n,url:t})});r.ok||z("[NE] Local opt-in failed",r.status)}catch(r){z("[NE] Local opt-in network error",r)}},I=async(i,n,t)=>{if(t.webhook)try{const e=await fetch(t.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:n})});if(!e.ok)throw z("[NE] Webhook responded with",e.status),new Error(String(e.status))}catch(e){throw z("[NE] Webhook request error",e),e}},B=i=>`
	<div id="nuclen-optin-container" class="nuclen-optin-with-results">
	<p class="nuclen-fg"><strong>${i.promptText}</strong></p>
	<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
	<input  type="text"  id="nuclen-optin-name">
	<label for="nuclen-optin-email" class="nuclen-fg">Email</label>
	<input  type="email" id="nuclen-optin-email" required>
	<button type="button" id="nuclen-optin-submit">${i.submitLabel}</button>
	</div>`;function $(i,n,t,e){var r,s;i.innerHTML=`
	<div id="nuclen-optin-container">
		<p class="nuclen-fg"><strong>${n.promptText}</strong></p>
		<label for="nuclen-optin-name"  class="nuclen-fg">Name</label>
		<input  type="text"  id="nuclen-optin-name">
		<label for="nuclen-optin-email" class="nuclen-fg">Email *</label>
		<input  type="email" id="nuclen-optin-email" required>
		<div class="nuclen-optin-btn-row">
		<button type="button" id="nuclen-optin-submit">${n.submitLabel}</button>
		</div>
		${n.mandatory?"":'<div class="nuclen-optin-skip"><a href="#" id="nuclen-optin-skip">Skip &amp; view results</a></div>'}
	</div>`,(r=document.getElementById("nuclen-optin-submit"))==null||r.addEventListener("click",async()=>{const l=document.getElementById("nuclen-optin-name").value.trim(),c=document.getElementById("nuclen-optin-email").value.trim();if(!L(c))return alert("Please enter a valid email");await x(l,c,window.location.href,n);try{await I(l,c,n),t()}catch{alert("Network error – please try again later.")}}),(s=document.getElementById("nuclen-optin-skip"))==null||s.addEventListener("click",l=>{l.preventDefault(),e()})}function _(i){var n;(n=document.getElementById("nuclen-optin-submit"))==null||n.addEventListener("click",async()=>{const t=document.getElementById("nuclen-optin-name").value.trim(),e=document.getElementById("nuclen-optin-email").value.trim();if(!L(e))return alert("Please enter a valid email");await x(t,e,window.location.href,i);try{await I(t,e,i)}catch{alert("Unable to submit. Please try later.")}})}function T(i,n,t){var s;let e="";i.enabled&&i.position==="with_results"&&(e+=B(i)),e+=`
<div id="nuclen-quiz-results-title" class="nuclen-fg">${NuclenStrings.your_score}</div>
<div id="nuclen-quiz-results-score" class="nuclen-fg" aria-live="polite" aria-atomic="true">
${t.score} / ${n.length}
</div>`;const r=t.score===n.length?NuclenStrings.perfect:t.score>n.length/2?NuclenStrings.well_done:NuclenStrings.retake_prompt;return e+=`<div id="nuclen-quiz-score-comment" aria-live="polite">${r}</div>`,e+='<div id="nuclen-quiz-result-tabs-container">',n.forEach((l,c)=>{e+=`
<button class="nuclen-quiz-result-tab" onclick="nuclearEngagementShowQuizQuestionDetails(${c})">${c+1}</button>`}),e+='</div><div id="nuclen-quiz-result-details-container" class="nuclen-fg dashboard-box"></div>',(s=window.NuclenCustomQuizHtmlAfter)!=null&&s.trim()&&(e+=`
<div id="nuclen-quiz-end-message" class="nuclen-fg">
${window.NuclenCustomQuizHtmlAfter}
</div>`),e+=`
<button id="nuclen-quiz-retake-button" onclick="nuclearEngagementRetakeQuiz()">${NuclenStrings.retake_test}</button>`,e}function C(i,n){window.nuclearEngagementShowQuizQuestionDetails=t=>{var s;const e=i[t],r=n.userAnswers[t];document.getElementById("nuclen-quiz-result-details-container").innerHTML=`
<p class="nuclen-quiz-detail-question">${g(e.question)}</p>
<p class="nuclen-quiz-detail-correct"><strong>${NuclenStrings.correct}</strong> ${g(e.answers[0])}</p>
${r===0?`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[0])} <span class="nuclen-quiz-checkmark">✔️</span></p>`:`<p class="nuclen-quiz-detail-chosen"><strong>${NuclenStrings.your_answer}</strong> ${g(e.answers[r]??"[No data]")}</p>`}
<p class="nuclen-quiz-detail-explanation">${g(e.explanation)}</p>`,Array.from(document.getElementsByClassName("nuclen-quiz-result-tab")).forEach(l=>l.classList.remove("nuclen-quiz-result-active-tab")),(s=document.getElementsByClassName("nuclen-quiz-result-tab")[t])==null||s.classList.add("nuclen-quiz-result-active-tab")},window.nuclearEngagementShowQuizQuestionDetails(0)}function H(i,n,t,e,r){window.nuclearEngagementRetakeQuiz=()=>{i.currIdx=0,i.score=0,i.userAnswers.length=0,n.innerHTML="",n.classList.add("nuclen-quiz-hidden"),t.style.width=`${1/e*100}%`,r()}}function M(i,n,t){const{qContainer:e,aContainer:r,explContainer:s,nextBtn:l,finalContainer:c}=i;e.innerHTML="",r.innerHTML="",s.innerHTML="",l.classList.add("nuclen-quiz-hidden"),$(c,n,t,t)}function O(i,n,t,e,r){const{qContainer:s,aContainer:l,explContainer:c,nextBtn:h,finalContainer:d,progBar:m}=i;s.innerHTML="",l.innerHTML="",c.innerHTML="",h.classList.add("nuclen-quiz-hidden"),d.classList.remove("nuclen-quiz-hidden"),d.innerHTML=T(n,t,e),d.setAttribute("aria-live","polite"),n.enabled&&n.position==="with_results"&&_(n),C(t,e),H(e,d,m,t.length,r),typeof gtag=="function"&&gtag("event","nuclen_quiz_end")}function S(i,n,t){i.style.width=`${(n+1)/t*100}%`}function q(i,n,t,e){const{qContainer:r,aContainer:s,explContainer:l,nextBtn:c,progBar:h}=t,d=i[n.currIdx];r.innerHTML=`
	<div id="nuclen-quiz-question-number" aria-live="polite" aria-atomic="true">
		${n.currIdx+1}/${i.length}
	</div>
	<div class="nuclen-quiz-title" role="heading" aria-level="2">${g(d.question)}</div>`;const m=N(d.answers.map((o,a)=>({ans:o,idx:a})).filter(o=>o.ans.trim()));s.innerHTML=m.map((o,a)=>`
		<button
			class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
			data-orig-idx="${o.idx}"
			tabindex="0"
			aria-label="Answer ${a+1}: ${g(o.ans)}"
		>${g(o.ans)}</button>`).join("");const w=m.findIndex(o=>o.idx===0);l.innerHTML="",l.classList.add("nuclen-quiz-hidden"),c.classList.add("nuclen-quiz-hidden"),S(h,n.currIdx,i.length);const u=o=>{const a=parseInt(o.getAttribute("data-orig-idx")||"0",10);e(a,m.findIndex(y=>y.idx===a),w),s.removeEventListener("click",f),s.removeEventListener("keydown",v)},f=o=>{const a=o.target;a.matches("button.nuclen-quiz-answer-button")&&u(a)},v=o=>{const a=o.target;a.matches("button.nuclen-quiz-answer-button")&&(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),u(a))};s.addEventListener("click",f),s.addEventListener("keydown",v)}function Q(){const i=document.getElementById("nuclen-quiz-container"),n=document.getElementById("nuclen-quiz-question-container"),t=document.getElementById("nuclen-quiz-answers-container"),e=document.getElementById("nuclen-quiz-progress-bar"),r=document.getElementById("nuclen-quiz-final-result-container"),s=document.getElementById("nuclen-quiz-next-button"),l=document.getElementById("nuclen-quiz-explanation-container");if(!i||!n||!t||!e||!r||!s||!l)return;const c=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,h=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,d={position:window.NuclenOptinPosition??"with_results",mandatory:!!window.NuclenOptinMandatory,promptText:window.NuclenOptinPromptText??"",submitLabel:window.NuclenOptinButtonText??"",enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook??"",ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""},m=postQuizData.filter(o=>{var a;return o.question.trim()&&((a=o.answers[0])==null?void 0:a.trim())}).slice(0,c).map(o=>({...o,answers:o.answers.slice(0,h)})),w={qContainer:n,aContainer:t,explContainer:l,nextBtn:s,finalContainer:r,progBar:e},u={currIdx:0,score:0,userAnswers:[]};s.addEventListener("click",v),q(m,u,w,f);function f(o,a,y){o===0&&u.score++,u.userAnswers.push(o);const b=t.getElementsByTagName("button");for(let p=0;p<b.length;p++)b[p].classList.remove("nuclen-quiz-possible-answer"),p===y?b[p].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):p===a?b[p].classList.add("nuclen-quiz-answer-wrong"):b[p].classList.add("nuclen-quiz-answer-not-selected"),b[p].disabled=!0;l.innerHTML=`<p>${g(m[u.currIdx].explanation)}</p>`,l.classList.remove("nuclen-quiz-hidden"),s.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(u.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function v(){if(u.currIdx++,u.currIdx<m.length)return q(m,u,w,f),i.scrollIntoView();const o=()=>O(w,d,m,u,()=>q(m,u,w,f));if(d.enabled&&d.position==="before_results")return M(w,d,o);o()}}window.nuclearEngagementInitQuiz=Q;
