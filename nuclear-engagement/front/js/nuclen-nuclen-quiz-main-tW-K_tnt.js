const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["front/js/nuclen-nuclen-quiz-results-_hsgmeLy.js","front/js/nuclen-front.js","logger-DwRZMuf8.js"])))=>i.map(i=>d[i]);
import{_}from"./nuclen-front.js";import{e as z}from"../../logger-DwRZMuf8.js";function v(i){const e=[...i];for(let o=e.length-1;o>0;o--){const t=Math.floor(Math.random()*(o+1));[e[o],e[t]]=[e[t],e[o]]}return e}const O=i=>/.+@.+\..+/.test(i),x=i=>i.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[e]||e),T=async(i,e,o,t)=>{if(!(!t.ajaxUrl||!t.ajaxNonce))try{const d=await fetch(t.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"nuclen_save_optin",nonce:t.ajaxNonce,name:i,email:e,url:o})});d.ok||z("[NE] Local opt-in failed",d.status)}catch(d){z("[NE] Local opt-in network error",d)}},j=async(i,e,o)=>{if(o.webhook)try{const t=await fetch(o.webhook,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,email:e})});if(!t.ok)throw z("[NE] Webhook responded with",t.status),new Error(String(t.status))}catch(t){throw z("[NE] Webhook request error",t),t}};function k(i,e,o){i.style.width=`${(e+1)/o*100}%`}function L(i,e,o,t){const{qContainer:d,aContainer:c,explContainer:p,nextBtn:q,progBar:y}=o,m=i[e.currIdx];d.innerHTML=`
	<div id="nuclen-quiz-question-number" aria-live="polite" aria-atomic="true">
		${e.currIdx+1}/${i.length}
	</div>
	<div class="nuclen-quiz-title" role="heading" aria-level="2">${x(m.question)}</div>`;const u=v(m.answers.map((n,r)=>({ans:n,idx:r})).filter(n=>n.ans.trim()));c.innerHTML=u.map((n,r)=>`
		<button
			class="nuclen-quiz-answer-button nuclen-quiz-possible-answer"
			data-orig-idx="${n.idx}"
			data-testid="quiz-answer"
			tabindex="0"
			aria-label="Answer ${r+1}: ${x(n.ans)}"
		>${x(n.ans)}</button>`).join("");const f=u.findIndex(n=>n.idx===0);p.innerHTML="",p.classList.add("nuclen-quiz-hidden"),q.classList.add("nuclen-quiz-hidden"),k(y,e.currIdx,i.length);const a=n=>{const r=parseInt(n.getAttribute("data-orig-idx")||"0",10);t(r,u.findIndex(s=>s.idx===r),f),c.removeEventListener("click",h),c.removeEventListener("keydown",b)},h=n=>{const r=n.target;r.matches("button.nuclen-quiz-answer-button")&&a(r)},b=n=>{const r=n.target;r.matches("button.nuclen-quiz-answer-button")&&(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),a(r))};c.addEventListener("click",h),c.addEventListener("keydown",b)}function I(){const i=document.getElementById("nuclen-quiz-container"),e=document.getElementById("nuclen-quiz-question-container"),o=document.getElementById("nuclen-quiz-answers-container"),t=document.getElementById("nuclen-quiz-progress-bar"),d=document.getElementById("nuclen-quiz-final-result-container"),c=document.getElementById("nuclen-quiz-next-button"),p=document.getElementById("nuclen-quiz-explanation-container");if(!i||!e||!o||!t||!d||!c||!p)return;const q=(NuclenSettings==null?void 0:NuclenSettings.questions_per_quiz)??10,y=(NuclenSettings==null?void 0:NuclenSettings.answers_per_question)??4,m={position:window.NuclenOptinPosition??"with_results",mandatory:!!window.NuclenOptinMandatory,promptText:window.NuclenOptinPromptText??"",submitLabel:window.NuclenOptinButtonText??"",enabled:!!window.NuclenOptinEnabled,webhook:window.NuclenOptinWebhook??"",ajaxUrl:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.url)??"",ajaxNonce:(NuclenOptinAjax==null?void 0:NuclenOptinAjax.nonce)??""};if(typeof postQuizData>"u"||!Array.isArray(postQuizData))return;const u=postQuizData.filter(s=>{var l;return s.question.trim()&&((l=s.answers[0])==null?void 0:l.trim())}).slice(0,q).map(s=>({...s,answers:s.answers.slice(0,y)})),f={qContainer:e,aContainer:o,explContainer:p,nextBtn:c,finalContainer:d,progBar:t},a={currIdx:0,score:0,userAnswers:[]},h=r;c.addEventListener("click",h),L(u,a,f,n);const b=()=>{c.removeEventListener("click",h),window.nuclearEngagementShowQuizQuestionDetails&&delete window.nuclearEngagementShowQuizQuestionDetails,window.nuclearEngagementRetakeQuiz&&delete window.nuclearEngagementRetakeQuiz};"onpagehide"in window?window.addEventListener("pagehide",b):window.addEventListener("beforeunload",b);function n(s,l,E){s===0&&a.score++,a.userAnswers.push(s);const g=o.getElementsByTagName("button");for(let w=0;w<g.length;w++)g[w].classList.remove("nuclen-quiz-possible-answer"),w===E?g[w].classList.add("nuclen-quiz-answer-correct","nuclen-quiz-pulse"):w===l?g[w].classList.add("nuclen-quiz-answer-wrong"):g[w].classList.add("nuclen-quiz-answer-not-selected"),g[w].disabled=!0;p.innerHTML=`<p>${x(u[a.currIdx].explanation)}</p>`,p.classList.remove("nuclen-quiz-hidden"),c.classList.remove("nuclen-quiz-hidden"),typeof gtag=="function"&&(a.currIdx===0&&gtag("event","nuclen_quiz_start"),gtag("event","nuclen_quiz_answer"))}function r(){if(a.currIdx++,a.currIdx<u.length)return L(u,a,f,n),i.scrollIntoView();const s=async()=>{const{renderFinal:l}=await _(async()=>{const{renderFinal:E}=await import("./nuclen-nuclen-quiz-results-_hsgmeLy.js");return{renderFinal:E}},__vite__mapDeps([0,1,2]));l(f,m,u,a,()=>L(u,a,f,n))};if(m.enabled&&m.position==="before_results"){_(async()=>{const{renderOptinBeforeResultsFlow:l}=await import("./nuclen-nuclen-quiz-results-_hsgmeLy.js");return{renderOptinBeforeResultsFlow:l}},__vite__mapDeps([0,1,2])).then(({renderOptinBeforeResultsFlow:l})=>{l(f,m,s)});return}s()}}const Q=Object.freeze(Object.defineProperty({__proto__:null,initQuiz:I},Symbol.toStringTag,{value:"Module"}));export{j as a,x as e,O as i,Q as n,T as s};
//# sourceMappingURL=nuclen-nuclen-quiz-main-tW-K_tnt.js.map
