{"version":3,"file":"nuclen-nuclen-quiz-optin-CeqiwQTO.js","sources":["../../../src/front/ts/nuclen-quiz-optin.ts"],"sourcesContent":["\n// ─────────────────────────────────────────────────────────────\n// File: src/front/ts/nuclen-quiz-optin.ts\n// -----------------------------------------------------------------------------\nimport type { OptinContext } from './nuclen-quiz-types';\nimport { isValidEmail, storeOptinLocally, submitToWebhook } from './nuclen-quiz-utils';\n\nexport const buildOptinInlineHTML = (ctx: OptinContext): string => `\n\t<div id=\"nuclen-optin-container\" class=\"nuclen-optin-with-results\">\n\t<p class=\"nuclen-fg\"><strong>${ctx.promptText}</strong></p>\n\t<label for=\"nuclen-optin-name\"  class=\"nuclen-fg\">Name</label>\n\t<input  type=\"text\"  id=\"nuclen-optin-name\">\n\t<label for=\"nuclen-optin-email\" class=\"nuclen-fg\">Email</label>\n\t<input  type=\"email\" id=\"nuclen-optin-email\" required>\n\t<button type=\"button\" id=\"nuclen-optin-submit\">${ctx.submitLabel}</button>\n\t</div>`;\n\nexport function mountOptinBeforeResults(\n\tcontainer: HTMLElement,\n\tctx: OptinContext,\n\tonComplete: () => void,\n\tonSkip: () => void\n): void {\n\tcontainer.innerHTML = `\n\t<div id=\"nuclen-optin-container\">\n\t\t<p class=\"nuclen-fg\"><strong>${ctx.promptText}</strong></p>\n\t\t<label for=\"nuclen-optin-name\"  class=\"nuclen-fg\">Name</label>\n\t\t<input  type=\"text\"  id=\"nuclen-optin-name\">\n\t\t<label for=\"nuclen-optin-email\" class=\"nuclen-fg\">Email *</label>\n\t\t<input  type=\"email\" id=\"nuclen-optin-email\" required>\n\t\t<div class=\"nuclen-optin-btn-row\">\n\t\t<button type=\"button\" id=\"nuclen-optin-submit\">${ctx.submitLabel}</button>\n\t\t</div>\n\t\t${\n\tctx.mandatory\n\t\t? ''\n\t\t: '<div class=\"nuclen-optin-skip\"><a href=\"#\" id=\"nuclen-optin-skip\">Skip &amp; view results</a></div>'\n}\n\t</div>`;\n\n\tdocument.getElementById('nuclen-optin-submit')?.addEventListener('click', async () => {\n\t\tconst submitBtn = document.getElementById('nuclen-optin-submit') as HTMLButtonElement;\n\t\tconst nameInput = document.getElementById('nuclen-optin-name') as HTMLInputElement;\n\t\tconst emailInput = document.getElementById('nuclen-optin-email') as HTMLInputElement;\n\t\t\n\t\tconst name = nameInput.value.trim();\n\t\tconst email = emailInput.value.trim();\n\t\t\n\t\t// Clear previous error states\n\t\tnameInput.classList.remove('nuclen-error');\n\t\temailInput.classList.remove('nuclen-error');\n\t\t\n\t\t// Validation\n\t\tif (!name) {\n\t\t\tnameInput.classList.add('nuclen-error');\n\t\t\tnameInput.focus();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (!isValidEmail(email)) {\n\t\t\temailInput.classList.add('nuclen-error');\n\t\t\temailInput.focus();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Disable button and show loading state\n\t\tsubmitBtn.disabled = true;\n\t\tconst originalText = submitBtn.textContent;\n\t\tsubmitBtn.textContent = 'Submitting...';\n\t\t\n\t\ttry {\n\t\t\tawait storeOptinLocally(name, email, window.location.href, ctx);\n\t\t\tawait submitToWebhook(name, email, ctx);\n\t\t\tonComplete();\n\t\t} catch (error) {\n\t\t\t\n\t\t\t// Show user-friendly error message\n\t\t\tconst errorMsg = document.createElement('div');\n\t\t\terrorMsg.className = 'nuclen-error-message';\n\t\t\terrorMsg.textContent = 'Unable to submit. Please check your connection and try again.';\n\t\t\tsubmitBtn.parentElement?.appendChild(errorMsg);\n\t\t\t\n\t\t\t// Remove error message after 5 seconds\n\t\t\tsetTimeout(() => errorMsg.remove(), 5000);\n\t\t\t\n\t\t\t// Re-enable button\n\t\t\tsubmitBtn.disabled = false;\n\t\t\tsubmitBtn.textContent = originalText || ctx.submitLabel;\n\t\t}\n\t});\n\n\tdocument.getElementById('nuclen-optin-skip')?.addEventListener('click', (e) => {\n\t\te.preventDefault();\n\t\tonSkip();\n\t});\n}\n\nexport function attachInlineOptinHandlers(ctx: OptinContext): void {\n\tdocument.getElementById('nuclen-optin-submit')?.addEventListener('click', async () => {\n\t\tconst submitBtn = document.getElementById('nuclen-optin-submit') as HTMLButtonElement;\n\t\tconst nameInput = document.getElementById('nuclen-optin-name') as HTMLInputElement;\n\t\tconst emailInput = document.getElementById('nuclen-optin-email') as HTMLInputElement;\n\t\t\n\t\tconst name = nameInput.value.trim();\n\t\tconst email = emailInput.value.trim();\n\t\t\n\t\t// Clear previous error states\n\t\tnameInput.classList.remove('nuclen-error');\n\t\temailInput.classList.remove('nuclen-error');\n\t\t\n\t\t// Validation\n\t\tif (!name) {\n\t\t\tnameInput.classList.add('nuclen-error');\n\t\t\tnameInput.focus();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tif (!isValidEmail(email)) {\n\t\t\temailInput.classList.add('nuclen-error');\n\t\t\temailInput.focus();\n\t\t\treturn;\n\t\t}\n\t\t\n\t\t// Disable button and show loading state\n\t\tsubmitBtn.disabled = true;\n\t\tconst originalText = submitBtn.textContent;\n\t\tsubmitBtn.textContent = 'Submitting...';\n\t\t\n\t\ttry {\n\t\t\tawait storeOptinLocally(name, email, window.location.href, ctx);\n\t\t\tawait submitToWebhook(name, email, ctx);\n\t\t\t\n\t\t\t// Show success message if configured\n\t\t\tif (window.NuclenOptinSuccessMessage) {\n\t\t\t\tconst successMsg = document.createElement('div');\n\t\t\t\tsuccessMsg.className = 'nuclen-success-message';\n\t\t\t\tsuccessMsg.textContent = window.NuclenOptinSuccessMessage;\n\t\t\t\tsubmitBtn.parentElement?.appendChild(successMsg);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t\n\t\t\t// Show user-friendly error message\n\t\t\tconst errorMsg = document.createElement('div');\n\t\t\terrorMsg.className = 'nuclen-error-message';\n\t\t\terrorMsg.textContent = 'Unable to submit. Please check your connection and try again.';\n\t\t\tsubmitBtn.parentElement?.appendChild(errorMsg);\n\t\t\t\n\t\t\t// Remove error message after 5 seconds\n\t\t\tsetTimeout(() => errorMsg.remove(), 5000);\n\t\t\t\n\t\t\t// Re-enable button\n\t\t\tsubmitBtn.disabled = false;\n\t\t\tsubmitBtn.textContent = originalText || ctx.submitLabel;\n\t\t}\n\t});\n}\n\n"],"names":["buildOptinInlineHTML","ctx","mountOptinBeforeResults","container","onComplete","onSkip","_a","submitBtn","nameInput","emailInput","name","email","isValidEmail","originalText","storeOptinLocally","submitToWebhook","errorMsg","_b","attachInlineOptinHandlers","successMsg"],"mappings":"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"}