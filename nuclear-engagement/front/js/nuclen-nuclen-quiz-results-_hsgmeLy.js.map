{"version":3,"mappings":"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","names":["buildResultsHtml","optin","questions","state","html","buildOptinInlineHTML","__vitePreload","comment","_","i","_a","registerShowDetailsHandler","idx","q","ua","escapeHtml","el","registerRetakeHandler","finalContainer","progBar","questionCount","renderQuestion","renderOptinBeforeResultsFlow","ui","onFinal","qContainer","aContainer","explContainer","nextBtn","mountOptinBeforeResults","renderFinal","attachInlineOptinHandlers"],"ignoreList":[],"sources":["../../../src/front/ts/nuclen-quiz-results.ts"],"sourcesContent":["// ─────────────────────────────────────────────────────────────\n// File: src/front/ts/nuclen-quiz-results.ts\n// -----------------------------------------------------------------------------\nimport type { QuizQuestion, OptinContext } from './nuclen-quiz-types';\n// Opt-in functions will be imported dynamically when needed\nimport { escapeHtml } from './nuclen-quiz-utils';\n\n// Globals injected by wp_localize_script\ndeclare const NuclenStrings: {\n\tretake_test: string;\n\tyour_score: string;\n\tperfect: string;\n\twell_done: string;\n\tretake_prompt: string;\n\tcorrect: string;\n\tyour_answer: string;\n};\n\ndeclare function gtag(...args: unknown[]): void;\n\ndeclare global {\n\tinterface Window {\n\tnuclearEngagementShowQuizQuestionDetails?: (idx: number) => void;\n\tnuclearEngagementRetakeQuiz?: () => void;\n\t}\n}\n\nexport interface QuizUIRefs {\n\tqContainer: HTMLElement;\n\taContainer: HTMLElement;\n\texplContainer: HTMLElement;\n\tnextBtn: HTMLElement;\n\tfinalContainer: HTMLElement;\n\tprogBar: HTMLElement;\n}\n\nexport interface QuizState {\n        currIdx: number;\n        score: number;\n        userAnswers: number[];\n}\n\nasync function buildResultsHtml(\n\toptin: OptinContext,\n\tquestions: QuizQuestion[],\n\tstate: QuizState,\n): Promise<string> {\n\tlet html = '';\n\tif (optin.enabled && optin.position === 'with_results') {\n\t\tconst { buildOptinInlineHTML } = await import('./nuclen-quiz-optin');\n\t\thtml += buildOptinInlineHTML(optin);\n\t}\n\n\thtml += `\n<div id=\"nuclen-quiz-results-title\" class=\"nuclen-fg\">${NuclenStrings.your_score}</div>\n<div id=\"nuclen-quiz-results-score\" class=\"nuclen-fg\" aria-live=\"polite\" aria-atomic=\"true\">\n${state.score} / ${questions.length}\n</div>`;\n\tconst comment =\n\t\tstate.score === questions.length\n\t\t\t? NuclenStrings.perfect\n\t\t\t: state.score > questions.length / 2\n\t\t\t\t? NuclenStrings.well_done\n\t\t\t\t: NuclenStrings.retake_prompt;\n\thtml += `<div id=\"nuclen-quiz-score-comment\" aria-live=\"polite\">${comment}</div>`;\n\n\thtml += '<div id=\"nuclen-quiz-result-tabs-container\">';\n\tquestions.forEach((_, i) => {\n\t\thtml += `\n<button class=\"nuclen-quiz-result-tab\" onclick=\"nuclearEngagementShowQuizQuestionDetails(${i})\">${i + 1}</button>`;\n\t});\n\thtml += '</div><div id=\"nuclen-quiz-result-details-container\" class=\"nuclen-fg dashboard-box\"></div>';\n\n\tif (window.NuclenCustomQuizHtmlAfter?.trim()) {\n\t\thtml += `\n<div id=\"nuclen-quiz-end-message\" class=\"nuclen-fg\">\n${window.NuclenCustomQuizHtmlAfter}\n</div>`;\n\t}\n\n\thtml += `\n<button id=\"nuclen-quiz-retake-button\" onclick=\"nuclearEngagementRetakeQuiz()\">${NuclenStrings.retake_test}</button>`;\n\n\treturn html;\n}\n\nfunction registerShowDetailsHandler(\n\tquestions: QuizQuestion[],\n\tstate: QuizState,\n): void {\n\t// Clean up any existing handler before assigning new one\n\tif (window.nuclearEngagementShowQuizQuestionDetails) {\n\t\tdelete window.nuclearEngagementShowQuizQuestionDetails;\n\t}\n\t\n\twindow.nuclearEngagementShowQuizQuestionDetails = (idx: number): void => {\n\t\tconst q = questions[idx];\n\t\tconst ua = state.userAnswers[idx];\n\t\t(document.getElementById('nuclen-quiz-result-details-container') as HTMLElement).innerHTML = `\n<p class=\"nuclen-quiz-detail-question\">${escapeHtml(q.question)}</p>\n<p class=\"nuclen-quiz-detail-correct\"><strong>${NuclenStrings.correct}</strong> ${escapeHtml(q.answers[0])}</p>\n${\n\tua === 0\n\t\t? `<p class=\"nuclen-quiz-detail-chosen\"><strong>${NuclenStrings.your_answer}</strong> ${escapeHtml(q.answers[0])} <span class=\"nuclen-quiz-checkmark\">✔️</span></p>`\n\t\t: `<p class=\"nuclen-quiz-detail-chosen\"><strong>${NuclenStrings.your_answer}</strong> ${escapeHtml(q.answers[ua] ?? '[No data]')}</p>`\n}\n<p class=\"nuclen-quiz-detail-explanation\">${escapeHtml(q.explanation)}</p>`;\n\t\tArray.from(document.getElementsByClassName('nuclen-quiz-result-tab')).forEach((el) =>\n\t\t\tel.classList.remove('nuclen-quiz-result-active-tab'),\n\t\t);\n\t\tdocument\n\t\t\t.getElementsByClassName('nuclen-quiz-result-tab')[idx]?.classList.add(\n\t\t\t\t'nuclen-quiz-result-active-tab',\n\t\t\t);\n\t};\n\twindow.nuclearEngagementShowQuizQuestionDetails(0);\n}\n\nfunction registerRetakeHandler(\n\tstate: QuizState,\n\tfinalContainer: HTMLElement,\n\tprogBar: HTMLElement,\n\tquestionCount: number,\n\trenderQuestion: () => void,\n): void {\n\t// Clean up any existing handler before assigning new one\n\tif (window.nuclearEngagementRetakeQuiz) {\n\t\tdelete window.nuclearEngagementRetakeQuiz;\n\t}\n\t\n\twindow.nuclearEngagementRetakeQuiz = (): void => {\n\t\tstate.currIdx = 0;\n\t\tstate.score = 0;\n\t\tstate.userAnswers.length = 0;\n\t\tfinalContainer.innerHTML = '';\n\t\tfinalContainer.classList.add('nuclen-quiz-hidden');\n\t\tprogBar.style.width = `${(1 / questionCount) * 100}%`;\n\t\trenderQuestion();\n\t};\n}\n\nexport async function renderOptinBeforeResultsFlow(\n\tui: QuizUIRefs,\n\toptin: OptinContext,\n\tonFinal: () => void,\n): Promise<void> {\n\tconst { qContainer, aContainer, explContainer, nextBtn, finalContainer } = ui;\n\tqContainer.innerHTML = '';\n\taContainer.innerHTML = '';\n\texplContainer.innerHTML = '';\n\tnextBtn.classList.add('nuclen-quiz-hidden');\n\n\tconst { mountOptinBeforeResults } = await import('./nuclen-quiz-optin');\n\tmountOptinBeforeResults(finalContainer, optin, onFinal, onFinal);\n}\n\nexport async function renderFinal(\n\tui: QuizUIRefs,\n\toptin: OptinContext,\n\tquestions: QuizQuestion[],\n\tstate: QuizState,\n\trenderQuestion: () => void,\n): Promise<void> {\n\tconst { qContainer, aContainer, explContainer, nextBtn, finalContainer, progBar } = ui;\n\tqContainer.innerHTML = '';\n\taContainer.innerHTML = '';\n\texplContainer.innerHTML = '';\n\tnextBtn.classList.add('nuclen-quiz-hidden');\n\tfinalContainer.classList.remove('nuclen-quiz-hidden');\n\tfinalContainer.innerHTML = await buildResultsHtml(optin, questions, state);\n\tfinalContainer.setAttribute('aria-live', 'polite');\n\n\tif (optin.enabled && optin.position === 'with_results') {\n\t\tconst { attachInlineOptinHandlers } = await import('./nuclen-quiz-optin');\n\t\tattachInlineOptinHandlers(optin);\n\t}\n\n\tregisterShowDetailsHandler(questions, state);\n\tregisterRetakeHandler(state, finalContainer, progBar, questions.length, renderQuestion);\n\n\tif (typeof gtag === 'function') {\n\t\tgtag('event', 'nuclen_quiz_end');\n\t}\n}\n"],"file":"front/js/nuclen-nuclen-quiz-results-_hsgmeLy.js"}