{"version":3,"file":"nuclen-nuclen-quiz-optin-D_vGzvuK.js","sources":["../../../src/front/ts/nuclen-quiz-optin.ts"],"sourcesContent":["\r\n// ─────────────────────────────────────────────────────────────\r\n// File: src/front/ts/nuclen-quiz-optin.ts\r\n// -----------------------------------------------------------------------------\r\nimport type { OptinContext } from './nuclen-quiz-types';\r\nimport { isValidEmail, storeOptinLocally, submitToWebhook } from './nuclen-quiz-utils';\r\n\r\nexport const buildOptinInlineHTML = (ctx: OptinContext): string => `\r\n\t<div id=\"nuclen-optin-container\" class=\"nuclen-optin-with-results\">\r\n\t<p class=\"nuclen-fg\"><strong>${ctx.promptText}</strong></p>\r\n\t<label for=\"nuclen-optin-name\"  class=\"nuclen-fg\">Name</label>\r\n\t<input  type=\"text\"  id=\"nuclen-optin-name\">\r\n\t<label for=\"nuclen-optin-email\" class=\"nuclen-fg\">Email</label>\r\n\t<input  type=\"email\" id=\"nuclen-optin-email\" required>\r\n\t<button type=\"button\" id=\"nuclen-optin-submit\">${ctx.submitLabel}</button>\r\n\t</div>`;\r\n\r\nexport function mountOptinBeforeResults(\r\n\tcontainer: HTMLElement,\r\n\tctx: OptinContext,\r\n\tonComplete: () => void,\r\n\tonSkip: () => void\r\n): void {\r\n\tcontainer.innerHTML = `\r\n\t<div id=\"nuclen-optin-container\">\r\n\t\t<p class=\"nuclen-fg\"><strong>${ctx.promptText}</strong></p>\r\n\t\t<label for=\"nuclen-optin-name\"  class=\"nuclen-fg\">Name</label>\r\n\t\t<input  type=\"text\"  id=\"nuclen-optin-name\">\r\n\t\t<label for=\"nuclen-optin-email\" class=\"nuclen-fg\">Email *</label>\r\n\t\t<input  type=\"email\" id=\"nuclen-optin-email\" required>\r\n\t\t<div class=\"nuclen-optin-btn-row\">\r\n\t\t<button type=\"button\" id=\"nuclen-optin-submit\">${ctx.submitLabel}</button>\r\n\t\t</div>\r\n\t\t${\r\n\tctx.mandatory\r\n\t\t? ''\r\n\t\t: '<div class=\"nuclen-optin-skip\"><a href=\"#\" id=\"nuclen-optin-skip\">Skip &amp; view results</a></div>'\r\n}\r\n\t</div>`;\r\n\r\n\tdocument.getElementById('nuclen-optin-submit')?.addEventListener('click', async () => {\r\n\t\tconst submitBtn = document.getElementById('nuclen-optin-submit') as HTMLButtonElement;\r\n\t\tconst nameInput = document.getElementById('nuclen-optin-name') as HTMLInputElement;\r\n\t\tconst emailInput = document.getElementById('nuclen-optin-email') as HTMLInputElement;\r\n\t\t\r\n\t\tconst name = nameInput.value.trim();\r\n\t\tconst email = emailInput.value.trim();\r\n\t\t\r\n\t\t// Clear previous error states\r\n\t\tnameInput.classList.remove('nuclen-error');\r\n\t\temailInput.classList.remove('nuclen-error');\r\n\t\t\r\n\t\t// Validation\r\n\t\tif (!name) {\r\n\t\t\tnameInput.classList.add('nuclen-error');\r\n\t\t\tnameInput.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (!isValidEmail(email)) {\r\n\t\t\temailInput.classList.add('nuclen-error');\r\n\t\t\temailInput.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// Disable button and show loading state\r\n\t\tsubmitBtn.disabled = true;\r\n\t\tconst originalText = submitBtn.textContent;\r\n\t\tsubmitBtn.textContent = 'Submitting...';\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait storeOptinLocally(name, email, window.location.href, ctx);\r\n\t\t\tawait submitToWebhook(name, email, ctx);\r\n\t\t\tonComplete();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[Optin] Submission error:', error);\r\n\t\t\t\r\n\t\t\t// Show user-friendly error message\r\n\t\t\tconst errorMsg = document.createElement('div');\r\n\t\t\terrorMsg.className = 'nuclen-error-message';\r\n\t\t\terrorMsg.textContent = 'Unable to submit. Please check your connection and try again.';\r\n\t\t\tsubmitBtn.parentElement?.appendChild(errorMsg);\r\n\t\t\t\r\n\t\t\t// Remove error message after 5 seconds\r\n\t\t\tsetTimeout(() => errorMsg.remove(), 5000);\r\n\t\t\t\r\n\t\t\t// Re-enable button\r\n\t\t\tsubmitBtn.disabled = false;\r\n\t\t\tsubmitBtn.textContent = originalText || ctx.submitLabel;\r\n\t\t}\r\n\t});\r\n\r\n\tdocument.getElementById('nuclen-optin-skip')?.addEventListener('click', (e) => {\r\n\t\te.preventDefault();\r\n\t\tonSkip();\r\n\t});\r\n}\r\n\r\nexport function attachInlineOptinHandlers(ctx: OptinContext): void {\r\n\tdocument.getElementById('nuclen-optin-submit')?.addEventListener('click', async () => {\r\n\t\tconst submitBtn = document.getElementById('nuclen-optin-submit') as HTMLButtonElement;\r\n\t\tconst nameInput = document.getElementById('nuclen-optin-name') as HTMLInputElement;\r\n\t\tconst emailInput = document.getElementById('nuclen-optin-email') as HTMLInputElement;\r\n\t\t\r\n\t\tconst name = nameInput.value.trim();\r\n\t\tconst email = emailInput.value.trim();\r\n\t\t\r\n\t\t// Clear previous error states\r\n\t\tnameInput.classList.remove('nuclen-error');\r\n\t\temailInput.classList.remove('nuclen-error');\r\n\t\t\r\n\t\t// Validation\r\n\t\tif (!name) {\r\n\t\t\tnameInput.classList.add('nuclen-error');\r\n\t\t\tnameInput.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tif (!isValidEmail(email)) {\r\n\t\t\temailInput.classList.add('nuclen-error');\r\n\t\t\temailInput.focus();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\t// Disable button and show loading state\r\n\t\tsubmitBtn.disabled = true;\r\n\t\tconst originalText = submitBtn.textContent;\r\n\t\tsubmitBtn.textContent = 'Submitting...';\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait storeOptinLocally(name, email, window.location.href, ctx);\r\n\t\t\tawait submitToWebhook(name, email, ctx);\r\n\t\t\t\r\n\t\t\t// Show success message if configured\r\n\t\t\tif (ctx.successMessage) {\r\n\t\t\t\tconst successMsg = document.createElement('div');\r\n\t\t\t\tsuccessMsg.className = 'nuclen-success-message';\r\n\t\t\t\tsuccessMsg.textContent = ctx.successMessage;\r\n\t\t\t\tsubmitBtn.parentElement?.appendChild(successMsg);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[Optin] Submission error:', error);\r\n\t\t\t\r\n\t\t\t// Show user-friendly error message\r\n\t\t\tconst errorMsg = document.createElement('div');\r\n\t\t\terrorMsg.className = 'nuclen-error-message';\r\n\t\t\terrorMsg.textContent = 'Unable to submit. Please check your connection and try again.';\r\n\t\t\tsubmitBtn.parentElement?.appendChild(errorMsg);\r\n\t\t\t\r\n\t\t\t// Remove error message after 5 seconds\r\n\t\t\tsetTimeout(() => errorMsg.remove(), 5000);\r\n\t\t\t\r\n\t\t\t// Re-enable button\r\n\t\t\tsubmitBtn.disabled = false;\r\n\t\t\tsubmitBtn.textContent = originalText || ctx.submitLabel;\r\n\t\t}\r\n\t});\r\n}\r\n\r\n"],"names":["buildOptinInlineHTML","ctx","mountOptinBeforeResults","container","onComplete","onSkip","_a","submitBtn","nameInput","emailInput","name","email","isValidEmail","originalText","storeOptinLocally","submitToWebhook","error","errorMsg","_b","attachInlineOptinHandlers","successMsg"],"mappings":"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"}